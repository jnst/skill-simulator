var nc;if(!nc){nc={}}if(!nc.bns){nc.bns={}}if(!nc.bns.training){nc.bns.training={}}(function($){nc.bns.training.util={};nc.bns.training.util.StringUtil={};nc.bns.training.util.ArrayUtil={};nc.bns.training.util.ObjectUtil={};nc.bns.training.util.CheckUtil={};nc.bns.training.util.ControlUtil={};nc.bns.training.util.SearchDataUtil={};nc.bns.training.util.StringUtil.trim=function(_str){return _str.replace(/^\s+/,"").replace(/\s+$/,"")};nc.bns.training.util.StringUtil.getFixedPostPositionStr=function($str,$postPositionStr){function getPostPositionStr($postPositionStr,flag_existFinalJamoStr){if($postPositionStr=="을"||$postPositionStr=="를"){return(flag_existFinalJamoStr?"을":"를")}if($postPositionStr=="이"||$postPositionStr=="가"){return(flag_existFinalJamoStr?"이":"가")}if($postPositionStr=="은"||$postPositionStr=="는"){return(flag_existFinalJamoStr?"은":"는")}if($postPositionStr=="과"||$postPositionStr=="와"){return(flag_existFinalJamoStr?"과":"와")}return $postPositionStr}if($str.length<=0)return"";if($postPositionStr.length<=0)return"";var lastStrUnicode=$str.charCodeAt($str.length-1);if(lastStrUnicode<44032||lastStrUnicode>55203){return $postPositionStr}if(((lastStrUnicode-44032)%28)!=0){return getPostPositionStr($postPositionStr,true)}else{return getPostPositionStr($postPositionStr,false)}};nc.bns.training.util.StringUtil.getInitialJamoStr=function(_oneCharacterStr){var valueArr=[];var unicode=_oneCharacterStr.charCodeAt();var initialValue;if(unicode>=44032&&unicode<=55203){initialValue=Math.floor((unicode-44032)/588);initialValue=String(nc.bns.training.Model.SORT_NAME_ARR[initialValue])}else if(unicode>=32&&unicode<=126){if(unicode==32){initialValue=" "}else if(unicode==92){}else{initialValue=String.fromCharCode(unicode)}}else{initialValue=String.fromCharCode(unicode)}return initialValue};nc.bns.training.util.ArrayUtil.indexOf=function($array,$targetObj){for(var i=0,max=$array.length;i<max;i++){if($array[i]===$targetObj)return i}return-1};nc.bns.training.util.ArrayUtil.getElement=function($array,$targetObj){for(var i=0,max=$array.length;i<max;i++){if($array[i]===$targetObj)return $targetObj}return null};nc.bns.training.util.ArrayUtil.getMaxNumberByArr=function(_array){_array.sort(function numberOrder(a,b){return a-b});return _array[_array.length-1]};nc.bns.training.util.ArrayUtil.removeElement=function($array,$element){var index=nc.bns.training.util.ArrayUtil.indexOf($array,$element);if(index>=0)$array.splice(index,1)};nc.bns.training.util.ObjectUtil.getSize=function($obj){var size=0,key;for(key in $obj){if($obj.hasOwnProperty(key))size++}return size};nc.bns.training.util.ObjectUtil.getElementKeyNameArr=function($obj){var key,elementNameArr=[];for(key in $obj){if($obj.hasOwnProperty(key))elementNameArr.push(key)}return elementNameArr};nc.bns.training.util.ObjectUtil.getElementArr=function($obj){var key,elementArr=[];for(key in $obj){if($obj.hasOwnProperty(key))elementArr.push($obj[key])}return elementArr};nc.bns.training.util.CheckUtil.available=function($object){var flag=true;if($object==null||$object==undefined)return false;return flag};nc.bns.training.util.ControlUtil.SimpleTimer=function(_gapTime,_callbackScope,_callbackFunc,_callbackFuncArgumentsArr){var _this=this;var gapTime=_gapTime;var callbackScope=_callbackScope;var callbackFunc=_callbackFunc;var callbackFuncArgumentsArr=_callbackFuncArgumentsArr;var _timer;var flag_protectRepeatTimeout=false;_this.destroy=function(){destroyInternalTimer();gapTime=null;callbackScope=null;callbackFunc=null;callbackFuncArgumentsArr=null};_this.start=function(){destroyInternalTimer();_timer=setTimeout(performTimeout,gapTime);flag_protectRepeatTimeout=true};_this.stop=function(){flag_protectRepeatTimeout=false;destroyInternalTimer()};function performTimeout(){if(!callbackFuncArgumentsArr){_callbackFunc.call(callbackScope)}else{_callbackFunc.apply(callbackScope,callbackFuncArgumentsArr)}repeatTimeout()}function repeatTimeout(){if(!flag_protectRepeatTimeout)return;destroyInternalTimer();_timer=setTimeout(performTimeout,gapTime)}function destroyInternalTimer(){if(_timer){clearTimeout(_timer);_timer=null}}return _this};nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationId=function($skillId,$variationId){var variationObjHasVariationId=null;var skillObj=nc.bns.training.Model.SLOT_OBJ_JSON[String($skillId)];var tmpSlotObj,tmpVariationObj,flag_break=false;for(var slotNo in skillObj){tmpSlotObj=skillObj[slotNo];for(var variationNo in tmpSlotObj){tmpVariationObj=tmpSlotObj[variationNo];if(tmpVariationObj.variation_id==$variationId){flag_break=true;variationObjHasVariationId=tmpVariationObj}}if(flag_break)break}return variationObjHasVariationId};nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias=function($skillId,$variationId,$alias){var variationObj=null;var skillObj=nc.bns.training.Model.SLOT_OBJ_JSON[String($skillId)];var tmpSlotObj,tmpVariationObj,flag_break=false;for(var slotNo in skillObj){tmpSlotObj=skillObj[slotNo];for(var variationNo in tmpSlotObj){tmpVariationObj=tmpSlotObj[variationNo];if(tmpVariationObj.variation_id==$variationId){if(tmpVariationObj.alias==$alias){flag_break=true;variationObj=tmpVariationObj}}}if(flag_break)break}return variationObj};nc.bns.training.util.SearchDataUtil.getCustomVariationObjHasSkillIdAndVariationId=function($treeId,$skillId,$variationId){var customVariationObj=null;var skillObj=nc.bns.training.Model.SLOT_OBJ_JSON[String($treeId)];var tmpSlotObj,tmpVariationObj,flag_break=false;for(var slotNo in skillObj){tmpSlotObj=skillObj[slotNo];for(var variationNo in tmpSlotObj){tmpVariationObj=tmpSlotObj[variationNo];if(tmpVariationObj.skill_id==$skillId){if(tmpVariationObj.variation_id==$variationId){flag_break=true;customVariationObj={slotNo:slotNo,tree_id:tmpVariationObj.tree_id,skill_id:$skillId,alias:tmpVariationObj.alias,variation_id:$variationId};break}}}if(flag_break)break}return customVariationObj};nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr=function($skillId){var _skillListObj=null;for(var i=0,max=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR.length;i<max;i++){_skillListObj=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR[i];if(String(_skillListObj.skill_id)==$skillId){return _skillListObj}}return null};nc.bns.training.util.SearchDataUtil.getAcquisitionSkillListObjFromCustomGlobalModelArrByTreeId=function($treeId){var acquisitionSkillListArr=[];var _skillListObj;for(var i=0,max=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR.length;i<max;i++){_skillListObj=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR[i];if(_skillListObj.skillType!=nc.bns.training.Model.SKILL_TYPE_ACQUISITION)continue;if(_skillListObj.tree_id==$treeId){if(_skillListObj.tree_id!=_skillListObj.skill_id){acquisitionSkillListArr.push(_skillListObj)}}}return acquisitionSkillListArr};nc.bns.training.util.SearchDataUtil.getShareSkillListObjFromCustomGlobalModelArrByTreeId=function($treeId){var shareSkillListArr=[];var _skillListObj;for(var i=0,max=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR.length;i<max;i++){_skillListObj=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR[i];if(_skillListObj.skillType!=nc.bns.training.Model.SKILL_TYPE_SHARE)continue;if(_skillListObj.tree_id==$treeId){if(_skillListObj.tree_id!=_skillListObj.skill_id){shareSkillListArr.push(_skillListObj)}}}return shareSkillListArr};nc.bns.training.util.SearchDataUtil.getShareSkillListObjArrFromCustomGlobalModelArr=function(){var shareSkillListArr=[];var _skillListObj;for(var i=0,max=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR.length;i<max;i++){_skillListObj=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR[i];if(_skillListObj.skillType!=nc.bns.training.Model.SKILL_TYPE_SHARE)continue;shareSkillListArr.push(_skillListObj)}return shareSkillListArr};nc.bns.training.util.SearchDataUtil.getVariationObjFromSkillSlotDataByAlias=function($skillSlotData,$alias){var flag_exist=false;var slotObj,variationObj;for(var slotNo in $skillSlotData){slotObj=$skillSlotData[slotNo];for(var variationNo in slotObj){variationObj=slotObj[variationNo];if(variationObj.alias==$alias){flag_exist=true;break}}if(flag_exist)break}if(flag_exist)return variationObj;return null};nc.bns.training.util.SearchDataUtil.getConsumedSkillPoint=function($slotObjData,$variationId,$alias){var consumedPoint=0,consumedPointArr=[],prevTrainAliasStr="";var funcObj={};funcObj.makeConsumedPointArr=function($funcObj,$flag_findUseAliasStr){var break_func=false,flag_find=false;var slotObj,variationObj;for(var slotNo in $slotObjData){slotObj=$slotObjData[slotNo];for(var variationIndex in slotObj){variationObj=slotObj[variationIndex];if($flag_findUseAliasStr){if(variationObj.alias==prevTrainAliasStr){prevTrainAliasStr=variationObj.prev_train["0"];consumedPointArr.unshift(variationObj.max_variation_level);flag_find=true;break_func=true;break}}else{if(variationObj.variation_id==$variationId){if(variationObj.alias==$alias){prevTrainAliasStr=variationObj.prev_train["0"];consumedPointArr.unshift(parseInt(variationIndex));flag_find=true;break_func=true}break}}}if(break_func)break}if(flag_find)$funcObj.makeConsumedPointArr($funcObj,true)};funcObj.makeConsumedPointArr(funcObj,false);var skillPoint;for(var i=0,max=consumedPointArr.length;i<max;i++){skillPoint=parseInt(consumedPointArr[i]);if(skillPoint==0){skillPoint=1}consumedPoint+=skillPoint}return consumedPoint};nc.bns.training.util.SearchDataUtil.getConsumedSkillPointTotal=function($slotObjData,$variationId,$alias){var consumedPoint=0,consumedPointArr=[],prevTrainAliasStr="";var funcObj={};funcObj.makeConsumedPointArr=function($funcObj,$flag_findUseAliasStr){var break_func=false,flag_find=false;var slotObj,variationObj;for(var slotNo in $slotObjData){slotObj=$slotObjData[slotNo];for(var variationIndex in slotObj){variationObj=slotObj[variationIndex];if($flag_findUseAliasStr){if(variationObj.alias==prevTrainAliasStr){prevTrainAliasStr=variationObj.prev_train["0"];consumedPointArr.unshift(variationObj.max_variation_level);flag_find=true;break_func=true;break}}else{if(variationObj.variation_id==$variationId){if(variationObj.alias==$alias){prevTrainAliasStr=variationObj.prev_train["0"];consumedPointArr.unshift(variationObj.max_variation_level);flag_find=true;break_func=true}break}}}if(break_func)break}if(flag_find)$funcObj.makeConsumedPointArr($funcObj,true)};funcObj.makeConsumedPointArr(funcObj,false);var skillPoint;for(var i=0,max=consumedPointArr.length;i<max;i++){skillPoint=parseInt(consumedPointArr[i]);if(skillPoint==0){skillPoint=1}consumedPoint+=skillPoint}return consumedPoint};nc.bns.training.util.SearchDataUtil.getPrevTrainedAllSkillId=function($slotObjData,$alias){var trainSkillIdArr=[];var funcObj={};funcObj.makeTrainSkillIdArr=function($funcObj,$flag_findUseAliasStr){var break_func=false,flag_find=false;var slotObj,variationObj,tmpTrainSkillId;for(var slotNo in $slotObjData){slotObj=$slotObjData[slotNo];for(var variationIndex in slotObj){variationObj=slotObj[variationIndex];if($flag_findUseAliasStr){if(variationObj.alias==prevTrainAliasStr){prevTrainAliasStr=variationObj.prev_train["0"];for(var index in variationObj.train_skill_id){tmpTrainSkillId=variationObj.train_skill_id[index];if(tmpTrainSkillId){trainSkillIdArr.push(tmpTrainSkillId)}}flag_find=true;break_func=true;break}}else{if(variationObj.alias==$alias){prevTrainAliasStr=variationObj.prev_train["0"];for(var index in variationObj.train_skill_id){tmpTrainSkillId=variationObj.train_skill_id[index];if(tmpTrainSkillId){trainSkillIdArr.push(tmpTrainSkillId)}}flag_find=true;break_func=true;break}}}if(break_func)break}if(flag_find)$funcObj.makeTrainSkillIdArr($funcObj,true)};funcObj.makeTrainSkillIdArr(funcObj,false);return trainSkillIdArr};nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs=function($slotObjData,$alias){var trainSkillVariationobjArr=[];var funcObj={};funcObj.makeTrainSkillVariationObjArr=function($funcObj,$flag_findUseAliasStr){var break_func=false,flag_find=false;var slotObj,variationObj,tmpTrainSkillId;for(var slotNo in $slotObjData){slotObj=$slotObjData[slotNo];for(var variationIndex in slotObj){variationObj=slotObj[variationIndex];if($flag_findUseAliasStr){if(variationObj.alias==prevTrainAliasStr){prevTrainAliasStr=variationObj.prev_train["0"];trainSkillVariationobjArr.push(variationObj);flag_find=true;break_func=true;break}}else{if(variationObj.alias==$alias){prevTrainAliasStr=variationObj.prev_train["0"];trainSkillVariationobjArr.push(variationObj);flag_find=true;break_func=true;break}}}if(break_func)break}if(flag_find)$funcObj.makeTrainSkillVariationObjArr($funcObj,true)};funcObj.makeTrainSkillVariationObjArr(funcObj,false);return trainSkillVariationobjArr};nc.bns.training.util.SearchDataUtil.getPrevTrainedAllSkillVariationObjs=function($slotObjData,$tooltipAlias){var trainSkillVariationobjArr=[];var funcObj={};funcObj.makeTrainSkillVariationObjArr=function($funcObj,$flag_findUseAliasStr){var break_func=false,flag_find=false;var slotObj,variationObj,tmpTrainSkillId;for(var slotNo in $slotObjData){slotObj=$slotObjData[slotNo];var variationCount=0;for(var variationIndex in slotObj){variationObj=slotObj[variationIndex];variationCount++;if($flag_findUseAliasStr){if(variationObj.alias==prevTrainAliasStr){prevTrainAliasStr=variationObj.prev_train["0"];var tmpArr=[];for(var index in slotObj){tmpArr.push(slotObj[index])}for(var i=tmpArr.length-1;i>=0;i--){trainSkillVariationobjArr.unshift(tmpArr[i])}flag_find=true;break_func=true;break}}else{if(variationObj.tooltip_alias==$tooltipAlias){prevTrainAliasStr=variationObj.prev_train["0"];if(variationCount>1){var tmpArr=[];for(var index in slotObj){tmpArr.push(slotObj[index]);if(index==variationIndex){for(var i=tmpArr.length-1;i>=0;i--){trainSkillVariationobjArr.unshift(tmpArr[i])}break}}}else{trainSkillVariationobjArr.unshift(variationObj)}flag_find=true;break_func=true;break}}}if(break_func)break}if(flag_find)$funcObj.makeTrainSkillVariationObjArr($funcObj,true)};funcObj.makeTrainSkillVariationObjArr(funcObj,false);return trainSkillVariationobjArr};nc.bns.training.Training={};nc.bns.training.category={};nc.bns.training.tree={};nc.bns.training.tooltip={};nc.bns.training.select={};nc.bns.training.Model={};nc.bns.training.Model.SORT_INPUT_ARR=["LB","RB","F","TAB","1","2","3","4","Z","X","C","V","Q","E","W","S","NONE"];nc.bns.training.Model.SORT_INPUT_OBJ={"LB":{category:"LB",value:"LB"},"RB":{category:"RB",value:"RB"},"F":{category:"F",value:"F"},"TAB":{category:"TAB",value:"TAB"},"1":{category:"1",value:"1"},"2":{category:"2",value:"2"},"3":{category:"3",value:"3"},"4":{category:"4",value:"4"},"Z":{category:"Z",value:"Z"},"X":{category:"X",value:"X"},"C":{category:"C",value:"C"},"V":{category:"V",value:"V"},"Q":{category:"Q",value:"Q"},"E":{category:"E",value:"E"},"W":{category:"W",value:"W"},"S":{category:"S",value:"S"},"NONE":{category:"없음",value:""}};nc.bns.training.Model.SORT_LEVEL_ARR=["5","10","15","20","25","30","35","40","45","50"];nc.bns.training.Model.SORT_POSE_OBJ={"AS":["妨害","潜伏","軽功"],"SU":["召喚","軽功"],"KF":["体術","軽功"],"FM":["気功","寒気","火気","軽功"],"DE":["破壊","軽功"],"BM":["剣術","御剣術","抜刀術","軽功"],"SM":["剣術","抜刀術","軽功"]};nc.bns.training.Model.SORT_NAME_ARR=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];nc.bns.training.Model.JOB_NAME_OBJ={"FM":"魔道士","BM":"剣術士","KF":"拳闘士","SU":"召喚士","DE":"滅砕士","AS":"暗殺者","SM":"燐剣術士"};nc.bns.training.Model.SKILL_IMG_URL_FRONT="http://static.plaync.co.kr/powerbook/bns/ui_resource/skill/";nc.bns.training.Model.NO_TRAINING_DESC="は修練がありません.";nc.bns.training.Model.NO_SEARCHED_TRAINING_DESC="修練がありません.";nc.bns.training.Model.CATEGORY_MOVE_POSY_PER_MOUSE_WHEEL=31;nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT=15;nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL=45;nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE=50;nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ={"45":"4","50":"10"};nc.bns.training.Model.SKILL_TYPE_NONE="SKILL_TYPE_NONE";nc.bns.training.Model.SKILL_TYPE_ACQUISITION="SKILL_TYPE_ACQUISITION";nc.bns.training.Model.SKILL_TYPE_SHARE="SKILL_TYPE_SHARE";nc.bns.training.Model.SLOT_ACQUISITION="SLOT_ACQUISITION";nc.bns.training.Model.SLOT_REPLACE="SLOT_REPLACE";nc.bns.training.Model.CATEGORY_OBJ_ARR=[];nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR=[];nc.bns.training.Model.SLOT_OBJ_JSON;nc.bns.training.Model.SKILL_OBJ_JSON;nc.bns.training.Model.DATA_SKILL_TOOLTIP_OBJ_JSON;nc.bns.training.Model.DATA_SKILL_TOOLTIP_ATTRIBUTE_OBJ_JSON;nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID={};nc.bns.training.Model.sortOptionIndex=1;nc.bns.training.Model.level=1;nc.bns.training.Model.masteryLevel=0;nc.bns.training.Model.job="";nc.bns.training.Model.masteryTitle="";nc.bns.training.Model.maxLevel=0;nc.bns.training.Model.editable=true;nc.bns.training.Model.skillPointTotal=0;nc.bns.training.Model.skillPointConsumed=0;nc.bns.training.Model.skillPointRemained=0;nc.bns.training.Model.lastSelectedSkillListSkillId="";nc.bns.training.Model.lastSelectedSkillType="";nc.bns.training.Model.lastSelectedSkillCategoryTitle="";nc.bns.training.Model.wheelScrollCategoryContainerPosY=0;nc.bns.training.Training=function(_options){var _this=this;_this.resetSelectedSkill=function(){var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(nc.bns.training.Model.lastSelectedSkillListSkillId);if(!skillListObj)return;var treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillListObj.tree_id);if(!treeSkillListObj)return;var skillId=skillListObj.skill_id;var treeSkillId=treeSkillListObj.tree_id;if(treeSkillListObj.learnedSkillVariationId!=""){var searchStr=_categoryContents.getSearchInputSearchStr();var consumedSkillPoint=treeSkillListObj.consumedSkillPoint;var currentSkillName=treeSkillListObj.name2_refine;var initSkillName=treeSkillListObj.initName2Refine;var flag_changeSkillName=false;if(currentSkillName!=initSkillName)flag_changeSkillName=true;treeSkillListObj.consumedSkillPoint=0;treeSkillListObj.learnedSkillVariationId="";treeSkillListObj.learnedSkillTooltipAlias="";treeSkillListObj.learnedSkillAlias="";treeSkillListObj.name2_refine=initSkillName;treeSkillListObj.initJamoStr=nc.bns.training.util.StringUtil.getInitialJamoStr(initSkillName.charAt(0));nc.bns.training.Model.skillPointConsumed=nc.bns.training.Model.skillPointConsumed-consumedSkillPoint;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;var acquisitionSkillListArr=nc.bns.training.util.SearchDataUtil.getAcquisitionSkillListObjFromCustomGlobalModelArrByTreeId(treeSkillId);var skillList;for(var i=0,max=acquisitionSkillListArr.length;i<max;i++){skillList=acquisitionSkillListArr[i];skillList.consumedSkillPoint=0}var shareSkillListArr=nc.bns.training.util.SearchDataUtil.getShareSkillListObjFromCustomGlobalModelArrByTreeId(treeSkillId);for(var i=0,max=shareSkillListArr.length;i<max;i++){skillList=shareSkillListArr[i];skillList.consumedSkillPoint=0}_categoryContents.reset();_categoryContents.activateCategoryFirstSkillListBySkillId(skillId);resetTreeContentsAndTooltipContentsBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);_treeContents.resetSkillTreeBySkillId(treeSkillId);_treeContents.displaySkillPointConsumedByExternal(String(nc.bns.training.Model.skillPointConsumed));_tooltipContents.setSkillToolTip(skillId);if(flag_changeSkillName){var categoryContainerPosY=_categoryContents.getSkillListPosYInCategoryContainer(skillId);_categoryContents.setCategoryContainerPosY(-categoryContainerPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=-categoryContainerPosY}else{_categoryContents.setCategoryContainerPosY(nc.bns.training.Model.wheelScrollCategoryContainerPosY)}if(searchStr){_categoryContents.arrangeCategoryContainerByExistingSearchStr();var flag_sortedListArrHasSkillList=_categoryContents.getFlagSortedListArrHasSkillListByExternal(nc.bns.training.Model.lastSelectedSkillListSkillId);if(flag_sortedListArrHasSkillList){var categoryContainerPosY=_categoryContents.getSkillListPosYInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId);_categoryContents.setCategoryContainerPosY(-categoryContainerPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=-categoryContainerPosY}}}else{return}};_this.resetAllSkill=function(){var lastSelectedSkillListSkillId=nc.bns.training.Model.lastSelectedSkillListSkillId;var lastSelectedSkillType=nc.bns.training.Model.lastSelectedSkillType;var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(nc.bns.training.Model.lastSelectedSkillListSkillId);if(!skillListObj)return;if(skillListObj.skillType!=nc.bns.training.Model.SKILL_TYPE_NONE){var treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillListObj.tree_id);var skillId=skillListObj.skill_id;var treeSkillId=treeSkillListObj.tree_id;init(true);_categoryContents.activateCategoryFirstSkillListBySkillId(skillId);_treeContents.resetSkillTreeBySkillId(treeSkillId);_tooltipContents.setSkillToolTip(skillId)}else{init(true);_categoryContents.activateCategoryFirstSkillListBySkillId(lastSelectedSkillListSkillId);_treeContents.resetSkillTreeBySkillId(lastSelectedSkillListSkillId);_tooltipContents.setSkillToolTip(lastSelectedSkillListSkillId)}nc.bns.training.Model.lastSelectedSkillListSkillId=lastSelectedSkillListSkillId;nc.bns.training.Model.lastSelectedSkillType=lastSelectedSkillType;nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.wheelScrollCategoryContainerPosY=0};_this.getSendDataObj=function(){function getTransformedTrainAllSkillData(){var objArr=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR;var jsonData={};function getPrevTrainedAllSkillVariation($slotObjData,$variationId,$alias){var trainSkillVariationArr=[];var funcObj={};funcObj.makeTrainSkillVariationArr=function($funcObj,$flag_findUseAliasStr){var break_func=false,flag_find=false;var slotObj,variationObj,tmpTrainSkillId;for(var slotNo in $slotObjData){slotObj=$slotObjData[slotNo];for(var variationIndex in slotObj){if($flag_findUseAliasStr){variationObj=slotObj[variationIndex];if(variationObj.alias==prevTrainAliasStr){var maxVariationLevel=variationObj.max_variation_level;if(maxVariationLevel=="0")maxVariationLevel="1";var lastVariationObjInSlot=slotObj[maxVariationLevel];prevTrainAliasStr=lastVariationObjInSlot.prev_train["0"];trainSkillVariationArr.unshift(lastVariationObjInSlot);flag_find=true;break_func=true;break}}else{variationObj=slotObj[variationIndex];if(variationObj.alias==$alias){if(variationObj.variation_id==$variationId){prevTrainAliasStr=variationObj.prev_train["0"];trainSkillVariationArr.unshift(variationObj);flag_find=true;break_func=true;break}}}}if(break_func)break}if(flag_find)$funcObj.makeTrainSkillVariationArr($funcObj,true)};funcObj.makeTrainSkillVariationArr(funcObj,false);return trainSkillVariationArr}var _skillListObj,tmpVariationObj;for(var i=0,max=objArr.length;i<max;i++){_skillListObj=objArr[i];if(_skillListObj.learnedSkillVariationId!=""){switch(_skillListObj.skillType){case"":tmpVariationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias(String(_skillListObj.skill_id),String(_skillListObj.learnedSkillVariationId),String(_skillListObj.learnedSkillAlias));if(tmpVariationObj){if(tmpVariationObj.skill_id!=tmpVariationObj.tree_id){var prevTrainedAllSkillVariationArr=getPrevTrainedAllSkillVariation(nc.bns.training.Model.SLOT_OBJ_JSON[tmpVariationObj.tree_id],tmpVariationObj.variation_id,tmpVariationObj.alias);var variationObj;for(var j=0,length=prevTrainedAllSkillVariationArr.length;j<length;j++){variationObj=prevTrainedAllSkillVariationArr[j];jsonData[String(variationObj.skill_id)]=variationObj.variation_id;var tmpTrainSkillId;for(var skillIdKey in variationObj.train_skill_id){tmpTrainSkillId=variationObj.train_skill_id[skillIdKey];if(nc.bns.training.util.CheckUtil.available(tmpTrainSkillId)){if(tmpTrainSkillId==variationObj.skill_id){jsonData[String(tmpTrainSkillId)]=String(variationObj.variation_id)}else{jsonData[String(tmpTrainSkillId)]=String(variationObj.variation_id)}}}}}else{var prevTrainedAllSkillVariationArr=getPrevTrainedAllSkillVariation(nc.bns.training.Model.SLOT_OBJ_JSON[tmpVariationObj.tree_id],tmpVariationObj.variation_id,tmpVariationObj.alias);var variationObj;for(var j=0,length=prevTrainedAllSkillVariationArr.length;j<length;j++){variationObj=prevTrainedAllSkillVariationArr[j];jsonData[String(variationObj.skill_id)]=variationObj.variation_id;var tmpTrainSkillId;for(var skillIdKey in variationObj.train_skill_id){tmpTrainSkillId=variationObj.train_skill_id[skillIdKey];if(nc.bns.training.util.CheckUtil.available(tmpTrainSkillId)){if(tmpTrainSkillId==variationObj.skill_id){jsonData[String(tmpTrainSkillId)]=String(variationObj.variation_id)}else{jsonData[String(tmpTrainSkillId)]=String(variationObj.variation_id)}}}}}}else{}break}}else{}}return jsonData}var sendJsonDataTotal={"character_level":parseInt(nc.bns.training.Model.level),"character_mastery_level":parseInt(nc.bns.training.Model.masteryLevel),"character_job":String(nc.bns.training.Model.job),"json_slot_data":getTransformedTrainAllSkillData()};return sendJsonDataTotal};_this.loadGetJsonData=function($jsonStr){resettingByLoadJsonData($jsonStr);_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)};var options=_options;var _contents;var _categoryContents;var _treeContents;var _tooltipContents;var _selectLevel;var _selectMasteryLevel;var flag_canUseSelectMastery=true;init(true);function init($flag_initializeFirst,$jsonObj){if(!_contents)_contents=$(options.containerSelector).get(0);setBodyMouseInteractionForCloseMasteryLevelSelectUI(false);$(_contents).empty();if($flag_initializeFirst){nc.bns.training.Model.level=parseInt(options.level);nc.bns.training.Model.masteryLevel=parseInt(options.masteryLevel);if(nc.bns.training.Model.level<nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL){nc.bns.training.Model.masteryLevel=0;flag_canUseSelectMastery=false}else{flag_canUseSelectMastery=true}nc.bns.training.Model.job=String(options.job);nc.bns.training.Model.masteryTitle=String(options.masteryTitle);nc.bns.training.Model.maxLevel=parseInt(options.maxLevel);if(nc.bns.training.util.CheckUtil.available(options.editable)){nc.bns.training.Model.editable=options.editable}else{nc.bns.training.Model.editable=true}}else{nc.bns.training.Model.level=parseInt($jsonObj.character_level);nc.bns.training.Model.masteryLevel=parseInt($jsonObj.character_mastery_level);if(nc.bns.training.Model.level<nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL){nc.bns.training.Model.masteryLevel=0;flag_canUseSelectMastery=false}else{flag_canUseSelectMastery=true}nc.bns.training.Model.job=String($jsonObj.character_job)}if(nc.bns.training.Model.level<nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT){nc.bns.training.Model.skillPointTotal=0}else{nc.bns.training.Model.skillPointTotal=(nc.bns.training.Model.level-nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT+1)+nc.bns.training.Model.masteryLevel}nc.bns.training.Model.skillPointConsumed=0;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal;var category_data=eval("category_data_"+nc.bns.training.Model.job);var slot_data=eval("slot_data_"+nc.bns.training.Model.job);var skill_data=eval("skill_data_"+nc.bns.training.Model.job);nc.bns.training.Model.CATEGORY_OBJ_ARR=[];for(var obj in category_data){nc.bns.training.Model.CATEGORY_OBJ_ARR.push(category_data[obj])}nc.bns.training.Model.SLOT_OBJ_JSON=slot_data;nc.bns.training.Model.SKILL_OBJ_JSON=skill_data;var objArr=[];$.extend(true,objArr,nc.bns.training.Model.CATEGORY_OBJ_ARR);nc.bns.training.Model.DATA_SKILL_TOOLTIP_OBJ_JSON=data_skill_tooltip;nc.bns.training.Model.DATA_SKILL_TOOLTIP_ATTRIBUTE_OBJ_JSON=data_skill_tooltip_attribute;var _tmpObj,initialStr,initialJamo;for(var i=0,max=objArr.length;i<max;i++){_tmpObj=objArr[i];if(_tmpObj.name2_refine){initialStr=_tmpObj.name2_refine;initialJamo=nc.bns.training.util.StringUtil.getInitialJamoStr(initialStr);_tmpObj.initName2Refine=initialStr;_tmpObj.initJamoStr=initialJamo;_tmpObj.name2_refine=initialStr}_tmpObj.consumedSkillPoint=0;_tmpObj.learnedSkillVariationId="";_tmpObj.learnedSkillTooltipAlias="";_tmpObj.learnedSkillAlias="";_tmpObj.skillType="";if(!getFlagNoTrainingSkill(_tmpObj)){if(_tmpObj.skill_id!=_tmpObj.tree_id){var treeObj=nc.bns.training.Model.SLOT_OBJ_JSON[String(_tmpObj.tree_id)];var flag_break=false;var flag_acquisitionSkill=false;var _tmpVariationObj;var slotObj,variationObj;for(var slotNo in treeObj){slotObj=treeObj[slotNo];for(var variationNo in slotObj){variationObj=slotObj[variationNo];if(variationObj.name2_refine==_tmpObj.name2_refine){flag_break=true;if(variationObj.parent_train["0"]!=variationObj.skill_id){flag_acquisitionSkill=true}_tmpVariationObj=variationObj;break}}if(flag_break)break}if(flag_break){if(flag_acquisitionSkill){_tmpObj.skillType=nc.bns.training.Model.SKILL_TYPE_ACQUISITION}else{var flag_existTreeId=false;for(var index in variationObj.parent_train){if(variationObj.parent_train[index]==variationObj.tree_id){flag_existTreeId=true;break}}if(flag_existTreeId){_tmpObj.skillType=nc.bns.training.Model.SKILL_TYPE_SHARE}else{_tmpObj.skillType=nc.bns.training.Model.SKILL_TYPE_ACQUISITION}}}else{_tmpObj.skillType=nc.bns.training.Model.SKILL_TYPE_SHARE}}}else{_tmpObj.skillType=nc.bns.training.Model.SKILL_TYPE_NONE}}nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR=objArr;var tmpSkillObj,tmpSkillId,tmpSkillObjArr;for(var tooltipAliasTitle in skill_data){tmpSkillObj=skill_data[tooltipAliasTitle];tmpSkillObj.tooltipAlias=tooltipAliasTitle;if(!nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[String(tmpSkillObj.id)]){tmpSkillObjArr=[];tmpSkillObjArr.push(tmpSkillObj);nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[String(tmpSkillObj.id)]=tmpSkillObjArr}else{tmpSkillObjArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[String(tmpSkillObj.id)];tmpSkillObjArr.push(tmpSkillObj)}}$(_contents).append(getHeaderStr());var categoryWrapElementStr='<div class="categoryWrap"></div>';var treeWrapElementStr='<div class="treeWrap"></div>';var tooltipWrapElementStr='<div class="tooltipWrap"></div>';$(_contents).append(categoryWrapElementStr);$(_contents).append(treeWrapElementStr);$(_contents).append(tooltipWrapElementStr);destroyContents();_categoryContents=new nc.bns.training.category.Contents({container:$(".categoryWrap",_contents).get(0),objArr:nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR,sortOptionIndex:nc.bns.training.Model.sortOptionIndex});$(_categoryContents).bind(nc.bns.training.category.Contents.TRIGGER_SELECT_SKILL_LIST,categoryContentsEventHandler);$(_categoryContents).bind(nc.bns.training.category.Contents.TRIGGER_SELECT_SORT_MENU,categoryContentsEventHandler);$(_categoryContents).bind(nc.bns.training.category.Contents.TRIGGER_SEARCH_NO_SKILL_LIST,categoryContentsEventHandler);_treeContents=new nc.bns.training.tree.Contents({container:$(".treeWrap",_contents).get(0),objArr:nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR});$(_treeContents).bind(nc.bns.training.tree.Contents.CONSUME_SKILL_POINT,treeContentsEventHandler);$(_treeContents).bind(nc.bns.training.tree.Contents.CANCEL_SKILL_POINT,treeContentsEventHandler);$(_treeContents).bind(nc.bns.training.tree.Contents.MOUSEOVER_SLOT,treeContentsEventHandler);$(_treeContents).bind(nc.bns.training.tree.Contents.MOUSEOUT_SLOT,treeContentsEventHandler);_tooltipContents=new nc.bns.training.tooltip.Contents({container:$(".tooltipWrap",_contents).get(0)});_selectLevel=new nc.bns.training.select.SelectLevel({container:$(".level.select_level").get(0)});$(_selectLevel).bind(nc.bns.training.select.SelectLevel.SELECT_LEVEL,selectLevelEventHandler);$(_selectLevel).bind(nc.bns.training.select.SelectLevel.OPEN_SELECT_LEVEL,selectLevelEventHandler);_selectMasteryLevel=new nc.bns.training.select.SelectMasteryLevel({container:$(".mastery_level.select_level").get(0)});$(_selectMasteryLevel).bind(nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL,selectMasteryLevelEventHandler);$(_selectMasteryLevel).bind(nc.bns.training.select.SelectMasteryLevel.OPEN_MASTERY_SELECT_LEVEL,selectMasteryLevelEventHandler);if($flag_initializeFirst){var firstSortedSkillId=_categoryContents.getSkillIdOfFirstSkillList();_categoryContents.activateCategoryFirstSkillListBySkillId(firstSortedSkillId);_treeContents.setSkillTree(firstSortedSkillId);_tooltipContents.setSkillToolTip(firstSortedSkillId);nc.bns.training.Model.lastSelectedSkillListSkillId=firstSortedSkillId}else{_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);_treeContents.setSkillTree(nc.bns.training.Model.lastSelectedSkillListSkillId);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId)}nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId);if(flag_canUseSelectMastery){if(nc.bns.training.Model.level>=nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL&&nc.bns.training.Model.level<nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){bindMasterySelectLevelInteraction(true);_selectMasteryLevel.switchMasteryLevelRange(parseInt(nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ[String(nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL)]));_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel);_selectMasteryLevel.setMouseInteraction(true)}else if(nc.bns.training.Model.level>=nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){bindMasterySelectLevelInteraction(true);_selectMasteryLevel.switchMasteryLevelRange(parseInt(nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ[String(nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE)]));_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel);_selectMasteryLevel.setMouseInteraction(true)}}else{bindMasterySelectLevelInteraction(false);_selectMasteryLevel.setMouseInteraction(false)}_selectLevel.displayLevel(nc.bns.training.Model.level);_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel);function destroyContents(){if(_categoryContents){$(_categoryContents).unbind(nc.bns.training.category.Contents.TRIGGER_SELECT_SKILL_LIST,categoryContentsEventHandler);$(_categoryContents).unbind(nc.bns.training.category.Contents.TRIGGER_SELECT_SORT_MENU,categoryContentsEventHandler);$(_categoryContents).unbind(nc.bns.training.category.Contents.TRIGGER_SEARCH_NO_SKILL_LIST,categoryContentsEventHandler);_categoryContents.destroy();_categoryContents=null}if(_treeContents){$(_treeContents).unbind(nc.bns.training.tree.Contents.CONSUME_SKILL_POINT,treeContentsEventHandler);$(_treeContents).unbind(nc.bns.training.tree.Contents.CANCEL_SKILL_POINT,treeContentsEventHandler);$(_treeContents).unbind(nc.bns.training.tree.Contents.MOUSEOVER_SLOT,treeContentsEventHandler);$(_treeContents).unbind(nc.bns.training.tree.Contents.MOUSEOUT_SLOT,treeContentsEventHandler);_treeContents.destroy();_treeContents=null}if(_tooltipContents){_tooltipContents.destroy();_tooltipContents=null}if(_selectLevel){$(_selectLevel).unbind(nc.bns.training.select.SelectLevel.SELECT_LEVEL,selectLevelEventHandler);$(_selectLevel).unbind(nc.bns.training.select.SelectLevel.OPEN_SELECT_LEVEL,selectLevelEventHandler);_selectLevel.destroy();_selectLevel=null}if(_selectMasteryLevel){$(_selectMasteryLevel).unbind(nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL,selectMasteryLevelEventHandler);$(_selectMasteryLevel).unbind(nc.bns.training.select.SelectMasteryLevel.OPEN_MASTERY_SELECT_LEVEL,selectMasteryLevelEventHandler);_selectMasteryLevel.destroy();_selectMasteryLevel=null}}function getFlagNoTrainingSkill($categorySkillListObj){if(_tmpObj.tree_id=="1")return true;if(_tmpObj.tree_id==_tmpObj.skill_id){var skillSlotObj=nc.bns.training.Model.SLOT_OBJ_JSON[_tmpObj.skill_id];if(!skillSlotObj)return true}return false}function bindMasterySelectLevelInteraction($flag){if($flag){$(_selectMasteryLevel).unbind(nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL,selectMasteryLevelEventHandler);$(_selectMasteryLevel).bind(nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL,selectMasteryLevelEventHandler)}else{$(_selectMasteryLevel).unbind(nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL,selectMasteryLevelEventHandler)}}function selectLevelEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case nc.bns.training.select.SelectLevel.SELECT_LEVEL:var targetLevel=$evt.level;if(targetLevel==nc.bns.training.Model.level)return;if(targetLevel<nc.bns.training.Model.level){var jsonObj={"character_level":targetLevel,"character_mastery_level":0,"character_job":nc.bns.training.Model.job,"json_slot_data":{}};if(targetLevel<nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL){resettingByJsonDataObj(jsonObj)}else if(targetLevel>=nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL&&targetLevel<nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){resettingByJsonDataObj(jsonObj);_selectMasteryLevel.switchMasteryLevelRange(parseInt(nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ[String(nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL)]));_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel)}else if(targetLevel<=nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){resettingByJsonDataObj(jsonObj);_selectMasteryLevel.switchMasteryLevelRange(parseInt(nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ[String(nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE)]));_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel)}_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}else{var prevLevel=nc.bns.training.Model.level;var prevLevelRangeTypeStr;if(prevLevel<nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL){prevLevelRangeTypeStr="level45Under"}else if(prevLevel>=nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL&&prevLevel<nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){prevLevelRangeTypeStr="level45Over49Under"}else if(prevLevel>=nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){prevLevelRangeTypeStr="level50Over"}var searchStr=_categoryContents.getSearchInputSearchStr();switch(prevLevelRangeTypeStr){case"level45Under":nc.bns.training.Model.level=targetLevel;nc.bns.training.Model.masteryLevel=0;nc.bns.training.Model.skillPointTotal=(nc.bns.training.Model.level-nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT+1)+nc.bns.training.Model.masteryLevel;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;_categoryContents.sortListBySortOptionIndexByExternal();if(nc.bns.training.Model.lastSelectedSkillCategoryTitle!=""){_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}else{_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}resetTreeContentsAndTooltipContentsBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);_treeContents.displaySkillPointTotalByExternal(nc.bns.training.Model.skillPointTotal);if(targetLevel<nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL){}else if(targetLevel>=nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL&&targetLevel<nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){bindMasterySelectLevelInteraction(true);_selectMasteryLevel.switchMasteryLevelRange(parseInt(nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ[String(nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL)]));_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel);_selectMasteryLevel.setMouseInteraction(true)}else if(targetLevel>=nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){bindMasterySelectLevelInteraction(true);_selectMasteryLevel.switchMasteryLevelRange(parseInt(nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ[String(nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE)]));_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel);_selectMasteryLevel.setMouseInteraction(true)}break;case"level45Over49Under":if(targetLevel>=nc.bns.training.Model.MIN_LEVEL_CAN_USE_MASTERY_LEVEL&&targetLevel<nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){nc.bns.training.Model.level=targetLevel;nc.bns.training.Model.skillPointTotal=(nc.bns.training.Model.level-nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT+1)+nc.bns.training.Model.masteryLevel;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;_categoryContents.sortListBySortOptionIndexByExternal();if(nc.bns.training.Model.lastSelectedSkillCategoryTitle!=""){_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}else{_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}resetTreeContentsAndTooltipContentsBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);_treeContents.displaySkillPointTotalByExternal(nc.bns.training.Model.skillPointTotal);_selectMasteryLevel.setMouseInteraction(true)}else if(targetLevel>=nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){nc.bns.training.Model.level=targetLevel;nc.bns.training.Model.masteryLevel=0;nc.bns.training.Model.skillPointTotal=(nc.bns.training.Model.level-nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT+1)+nc.bns.training.Model.masteryLevel;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;_categoryContents.sortListBySortOptionIndexByExternal();if(nc.bns.training.Model.lastSelectedSkillCategoryTitle!=""){_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}else{_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}resetTreeContentsAndTooltipContentsBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);_treeContents.displaySkillPointTotalByExternal(nc.bns.training.Model.skillPointTotal);_selectMasteryLevel.switchMasteryLevelRange(parseInt(nc.bns.training.Model.MASTERY_LEVEL_RANGE_BY_LEVEL_OBJ[String(nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE)]));_selectMasteryLevel.displayMasteryLevel(nc.bns.training.Model.masteryLevel)}break;case"level50Over":if(targetLevel>=nc.bns.training.Model.LEVEL_SWITCH_MASTERY_LEVEL_RANGE){nc.bns.training.Model.level=targetLevel;nc.bns.training.Model.skillPointTotal=(nc.bns.training.Model.level-nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT+1)+nc.bns.training.Model.masteryLevel;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;_categoryContents.sortListBySortOptionIndexByExternal();if(nc.bns.training.Model.lastSelectedSkillCategoryTitle!=""){_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}else{_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}resetTreeContentsAndTooltipContentsBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);_treeContents.displaySkillPointTotalByExternal(nc.bns.training.Model.skillPointTotal)}break}_categoryContents.setCategoryContainerPosY(nc.bns.training.Model.wheelScrollCategoryContainerPosY);if(searchStr){_categoryContents.arrangeCategoryContainerByExistingSearchStr();var flag_sortedListArrHasSkillList=_categoryContents.getFlagSortedListArrHasSkillListByExternal(nc.bns.training.Model.lastSelectedSkillListSkillId);if(flag_sortedListArrHasSkillList){var categoryContainerPosY=_categoryContents.getSkillListPosYInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId);_categoryContents.setCategoryContainerPosY(-categoryContainerPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=-categoryContainerPosY}}}break;case nc.bns.training.select.SelectLevel.OPEN_SELECT_LEVEL:if(_selectMasteryLevel)_selectMasteryLevel.open(false);setBodyMouseInteractionForCloseMasteryLevelSelectUI(true);break}}function setBodyMouseInteractionForCloseMasteryLevelSelectUI($flag){if($flag){$("body").unbind("click",bodyMouseEventHandler);$("body").bind("click",bodyMouseEventHandler)}else{$("body").unbind("click",bodyMouseEventHandler)}}function bodyMouseEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case"click":if(_selectLevel)_selectLevel.open(false);if(_selectMasteryLevel)_selectMasteryLevel.open(false);setBodyMouseInteractionForCloseMasteryLevelSelectUI(false);break}}function selectMasteryLevelEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case nc.bns.training.select.SelectMasteryLevel.OPEN_MASTERY_SELECT_LEVEL:if(_selectLevel)_selectLevel.open(false);if(_selectMasteryLevel)_selectMasteryLevel.open(true);setBodyMouseInteractionForCloseMasteryLevelSelectUI(true);break;case nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL:var targetMasteryLevel=$evt.level;if(targetMasteryLevel==nc.bns.training.Model.masteryLevel)return;if(targetMasteryLevel<nc.bns.training.Model.masteryLevel){var jsonObj={"character_level":nc.bns.training.Model.level,"character_mastery_level":targetMasteryLevel,"character_job":nc.bns.training.Model.job,"json_slot_data":{}};resettingByJsonDataObj(jsonObj);_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}else{nc.bns.training.Model.level=nc.bns.training.Model.level;nc.bns.training.Model.masteryLevel=targetMasteryLevel;nc.bns.training.Model.skillPointTotal=(nc.bns.training.Model.level-nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT+1)+nc.bns.training.Model.masteryLevel;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;resetTreeContentsAndTooltipContentsBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);_treeContents.displaySkillPointTotalByExternal(nc.bns.training.Model.skillPointTotal);if(nc.bns.training.Model.lastSelectedSkillCategoryTitle!=""){_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}else{_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}}break}}function categoryContentsEventHandler($evt){$evt.preventDefault();switch($evt.type){case nc.bns.training.category.Contents.TRIGGER_SELECT_SKILL_LIST:setTreeContentsAndTooltipContentsBySkillId(String($evt.skillId));nc.bns.training.Model.lastSelectedSkillCategoryTitle=$evt.skillCategoryTitle;break;case nc.bns.training.category.Contents.TRIGGER_SELECT_SORT_MENU:var sortOptionIndex=$evt.sortOptionIndex;nc.bns.training.Model.sortOptionIndex=sortOptionIndex;_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.wheelScrollCategoryContainerPosY=0;break;case nc.bns.training.category.Contents.TRIGGER_SEARCH_NO_SKILL_LIST:_treeContents.displayNoSearchedSkillDescriptionByExternal();nc.bns.training.Model.lastSelectedSkillCategoryTitle="";break}}function treeContentsEventHandler($evt){$evt.preventDefault();switch($evt.type){case nc.bns.training.tree.Contents.MOUSEOVER_SLOT:_tooltipContents.displayDiffData($evt);break;case nc.bns.training.tree.Contents.MOUSEOUT_SLOT:_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);break;case nc.bns.training.tree.Contents.CONSUME_SKILL_POINT:var skillId=$evt.skillId;var treeId=$evt.treeId;var prevTrainSkillIdArr=$evt.prevTrainSkillIdArr;var skillType=$evt.skillType;var slotType=$evt.slotType;var switchSkillData=$evt.switchSkillData;var flag_changeSkillName=false;var controlScrollContainerPosYSkillId="";if(nc.bns.training.Model.skillPointConsumed>=nc.bns.training.Model.skillPointTotal)return;nc.bns.training.Model.skillPointConsumed++;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;switch(skillType){case"":switch(slotType){case nc.bns.training.Model.SLOT_ACQUISITION:_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=false;break;case"":_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=false;break;case nc.bns.training.Model.SLOT_REPLACE:if(!switchSkillData)return;_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_categoryContents.replaceSkillListInCategoryContainer(skillId,switchSkillData.variationId,switchSkillData.alias,switchSkillData.skillName);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=true;controlScrollContainerPosYSkillId=treeId;break}break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:switch(slotType){case nc.bns.training.Model.SLOT_ACQUISITION:_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=false;break;case"":_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=false;break;case nc.bns.training.Model.SLOT_REPLACE:if(!switchSkillData)return;_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_categoryContents.replaceSkillListInCategoryContainer(skillId,switchSkillData.variationId,switchSkillData.alias,switchSkillData.skillName);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=true;controlScrollContainerPosYSkillId=nc.bns.training.Model.lastSelectedSkillListSkillId;break}break;case nc.bns.training.Model.SKILL_TYPE_SHARE:switch(slotType){case nc.bns.training.Model.SLOT_ACQUISITION:_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=false;break;case"":_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=false;break;case nc.bns.training.Model.SLOT_REPLACE:if(!switchSkillData)return;_categoryContents.consumePointToSkillListInCategoryContainer(treeId);_categoryContents.replaceSkillListInCategoryContainer(skillId,switchSkillData.variationId,switchSkillData.alias,switchSkillData.skillName);_tooltipContents.setSkillToolTip(nc.bns.training.Model.lastSelectedSkillListSkillId);flag_changeSkillName=true;controlScrollContainerPosYSkillId=nc.bns.training.Model.lastSelectedSkillListSkillId;break}break}setCategoryTreeSkillListStatusToTrainSkillLists(treeId,prevTrainSkillIdArr);setCategoryTreeSkillListStatusToShareSkillLists(treeId);_treeContents.displaySkillPointConsumedByExternal(String(nc.bns.training.Model.skillPointConsumed));var searchStr=_categoryContents.getSearchInputSearchStr();if(flag_changeSkillName){if(searchStr){_categoryContents.arrangeCategoryContainerByExistingSearchStr();var flag_sortedListArrHasSkillList=_categoryContents.getFlagSortedListArrHasSkillListByExternal(controlScrollContainerPosYSkillId);if(flag_sortedListArrHasSkillList){var categoryContainerPosY=_categoryContents.getSkillListPosYInCategoryContainer(controlScrollContainerPosYSkillId);_categoryContents.setCategoryContainerPosY(-categoryContainerPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=-categoryContainerPosY}}else{var categoryContainerPosY=_categoryContents.getSkillListPosYInCategoryContainer(controlScrollContainerPosYSkillId);_categoryContents.setCategoryContainerPosY(-categoryContainerPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=-categoryContainerPosY;_categoryContents.activateCategoryFirstSkillListBySkillId(controlScrollContainerPosYSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}}else{if(searchStr){_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}else{_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}}break;case nc.bns.training.tree.Contents.CANCEL_SKILL_POINT:flag_changeSkillName=$evt.flag_changeSkillName;var searchStr=_categoryContents.getSearchInputSearchStr();var jsonData=getTrainAllSkillJsonData();var jsonDataTotal={"character_level":parseInt(nc.bns.training.Model.level),"character_mastery_level":parseInt(nc.bns.training.Model.masteryLevel),"character_job":String(nc.bns.training.Model.job),"json_slot_data":jsonData};resettingByJsonDataObj(jsonDataTotal);if(flag_changeSkillName){if(searchStr){_categoryContents.displaySearchInputSearchStr(searchStr);_categoryContents.arrangeCategoryContainerByInputSearchStrByExternal(searchStr);nc.bns.training.Model.wheelScrollCategoryContainerPosY=0;var flag_sortedListArrHasSkillList=_categoryContents.getFlagSortedListArrHasSkillListByExternal(nc.bns.training.Model.lastSelectedSkillListSkillId);if(flag_sortedListArrHasSkillList){var categoryContainerPosY=_categoryContents.getSkillListPosYInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId);_categoryContents.setCategoryContainerPosY(-categoryContainerPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=-categoryContainerPosY}}else{var categoryContainerPosY=_categoryContents.getSkillListPosYInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId);_categoryContents.setCategoryContainerPosY(-categoryContainerPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=-categoryContainerPosY;_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId)}}else{if(searchStr){_categoryContents.displaySearchInputSearchStr(searchStr);_categoryContents.arrangeCategoryContainerBySearchStrByExternal(searchStr);_categoryContents.setCategoryContainerPosY(nc.bns.training.Model.wheelScrollCategoryContainerPosY)}else{_categoryContents.setCategoryContainerPosY(nc.bns.training.Model.wheelScrollCategoryContainerPosY)}if(nc.bns.training.Model.lastSelectedSkillCategoryTitle!=""){_categoryContents.activateCategorySkillListBySkillIdAndCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle)}else{_categoryContents.activateCategoryFirstSkillListBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);nc.bns.training.Model.lastSelectedSkillCategoryTitle=_categoryContents.getFirstSkillListCategoryTitleInCategoryContainer(nc.bns.training.Model.lastSelectedSkillListSkillId)}}break}}function setCategoryTreeSkillListStatusToTrainSkillLists($treeId,$trainSkillIdArr){var trainSkillId;for(var i=0,max=$trainSkillIdArr.length;i<max;i++){trainSkillId=$trainSkillIdArr[i];if(trainSkillId!=$treeId){_categoryContents.setTreeSkillListStatusToAcquisitionSkillListByExternal($treeId,trainSkillId)}}}function setCategoryTreeSkillListStatusToShareSkillLists($treeId){var shareSkillListObjArr=nc.bns.training.util.SearchDataUtil.getShareSkillListObjFromCustomGlobalModelArrByTreeId($treeId);var shareSkillListObj;for(var i=0,max=shareSkillListObjArr.length;i<max;i++){shareSkillListObj=shareSkillListObjArr[i];_categoryContents.setTreeSkillListStatusToShareSkillListByExternal($treeId,shareSkillListObj.skill_id)}}function getHeaderStr(){var headerStr='<div class="header"><span class="job">'+nc.bns.training.Model.JOB_NAME_OBJ[nc.bns.training.Model.job]+'</span><span class="level select_level">レベル<span class="btn_level"></span><strong>'+nc.bns.training.Model.level+'</strong>'+'<ul class="ly_level"></ul></span>'+'<span class="mastery_level select_level">'+nc.bns.training.Model.masteryTitle+'<strong>'+nc.bns.training.Model.masteryLevel+'</strong>星<span class="btn_level"></span>'+'<ul class="ly_level"><li>0</li><li>1</li><li>2</li><li>3</li><li>4</li></ul></span></div>';return headerStr}}function getTrainAllSkillJsonData(){var objArr=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR;var jsonData={};var _tmpObj,tmpVariationObj;for(var i=0,max=objArr.length;i<max;i++){_tmpObj=objArr[i];if(_tmpObj.learnedSkillVariationId!=""){tmpVariationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias(String(_tmpObj.skill_id),String(_tmpObj.learnedSkillVariationId),String(_tmpObj.learnedSkillAlias));if(tmpVariationObj){var tmpTrainSkillId;for(var skillIdKey in tmpVariationObj.train_skill_id){tmpTrainSkillId=tmpVariationObj.train_skill_id[skillIdKey];if(nc.bns.training.util.CheckUtil.available(tmpTrainSkillId)){jsonData[String(tmpTrainSkillId)]=String(_tmpObj.learnedSkillVariationId)}}}}}return jsonData}function resetTreeContentsAndTooltipContentsBySkillId($skillId){var skillId=$skillId;var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillId);var treeSkillId;switch(skillListObj.skillType){case nc.bns.training.Model.SKILL_TYPE_NONE:nc.bns.training.Model.lastSelectedSkillType=nc.bns.training.Model.SKILL_TYPE_NONE;_treeContents.setSkillTree(skillId);_tooltipContents.setSkillToolTip(skillId);break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:nc.bns.training.Model.lastSelectedSkillType=nc.bns.training.Model.SKILL_TYPE_ACQUISITION;treeSkillId=String(skillListObj.tree_id);_treeContents.setTreeIdSkillTree(treeSkillId);_tooltipContents.setSkillToolTip(skillId);break;case nc.bns.training.Model.SKILL_TYPE_SHARE:nc.bns.training.Model.lastSelectedSkillType=nc.bns.training.Model.SKILL_TYPE_SHARE;treeSkillId=String(skillListObj.tree_id);_treeContents.setTreeIdSkillTree(treeSkillId);_tooltipContents.setSkillToolTip(skillId);break;default:nc.bns.training.Model.lastSelectedSkillType="";_treeContents.resetSkillTreeBySkillId(skillId);_tooltipContents.setSkillToolTip(skillId)}nc.bns.training.Model.lastSelectedSkillListSkillId=skillId}function setTreeContentsAndTooltipContentsBySkillId($skillId){var skillId=$skillId;var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillId);var treeSkillId;switch(skillListObj.skillType){case nc.bns.training.Model.SKILL_TYPE_NONE:nc.bns.training.Model.lastSelectedSkillType=nc.bns.training.Model.SKILL_TYPE_NONE;_treeContents.setSkillTree(skillId);_tooltipContents.setSkillToolTip(skillId);break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:nc.bns.training.Model.lastSelectedSkillType=nc.bns.training.Model.SKILL_TYPE_ACQUISITION;treeSkillId=String(skillListObj.tree_id);_treeContents.setTreeIdSkillTree(treeSkillId);_tooltipContents.setSkillToolTip(skillId);break;case nc.bns.training.Model.SKILL_TYPE_SHARE:nc.bns.training.Model.lastSelectedSkillType=nc.bns.training.Model.SKILL_TYPE_SHARE;treeSkillId=String(skillListObj.tree_id);_treeContents.setTreeIdSkillTree(treeSkillId);_tooltipContents.setSkillToolTip(skillId);break;default:nc.bns.training.Model.lastSelectedSkillType="";_treeContents.setSkillTree(skillId);_tooltipContents.setSkillToolTip(skillId)}nc.bns.training.Model.lastSelectedSkillListSkillId=skillId}function setSkillListStatusInCategoryByData($skillJsonObj){if(!$skillJsonObj)return;_categoryContents.setSkillListsStatusByExternal($skillJsonObj)}function resettingByJsonDataObj($resettingJsonDataObj){init(false,$resettingJsonDataObj);setSkillListStatusInCategoryByData($resettingJsonDataObj.json_slot_data);resetTreeContentsAndTooltipContentsBySkillId(nc.bns.training.Model.lastSelectedSkillListSkillId);var skillListObj,consumedSkillPointTotal=0;for(var i=0,max=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR.length;i<max;i++){skillListObj=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR[i];if(skillListObj.learnedSkillTooltipAlias!=""){if(skillListObj.skillType!="")continue;consumedSkillPointTotal+=parseInt(skillListObj.consumedSkillPoint)}}_treeContents.displaySkillPointConsumedByExternal(consumedSkillPointTotal);nc.bns.training.Model.skillPointConsumed=consumedSkillPointTotal;nc.bns.training.Model.skillPointRemained=nc.bns.training.Model.skillPointTotal-nc.bns.training.Model.skillPointConsumed;if(nc.bns.training.Model.skillPointRemained<=0){_treeContents.resetSkillTreeBySkillId(String(nc.bns.training.Model.lastSelectedSkillListSkillId))}}function resettingByLoadJsonData($jsonStr){var $jsonObj=$.parseJSON($jsonStr);if(!$jsonObj){return}nc.bns.training.Model.job=String($jsonObj.character_job);var slotData=$jsonObj.json_slot_data;var customVariationObjArr=[];var customObj;var _skillList,variationId,preTrainedVariationId;var preTrainedSlotNo,currentSlotNo,preTrainedSlotColumnNo,slotColumnNo;function checkEtcSkillProcess($skillId,$variationId){var customVariationObj;var etcSkillTreeId="",etcSkillVariationObj;var skillIdObj,slotObj,variationObj,flag_exist=false;for(var id in nc.bns.training.Model.SLOT_OBJ_JSON){skillIdObj=nc.bns.training.Model.SLOT_OBJ_JSON[id];for(var slotNo in skillIdObj){slotObj=skillIdObj[slotNo];for(var variationNo in slotObj){variationObj=slotObj[variationNo];if(variationObj.skill_id==$skillId){if(variationObj.variation_id==$variationId){customVariationObj={slotNo:slotNo,tree_id:String(variationObj.tree_id),skill_id:skillId,variation_id:String(variationObj.variation_id)};flag_exist=true}}if(flag_exist)break}if(flag_exist)break}if(flag_exist)break}if(flag_exist){var _tmpCustomVariationObj,flag_existPreTrain=false,_preTrainCustomObj;for(var i=0,max=customVariationObjArr.length;i<max;i++){_tmpCustomVariationObj=customVariationObjArr[i];if(_tmpCustomVariationObj.tree_id==customVariationObj.tree_id){_preTrainCustomObj=_tmpCustomVariationObj;flag_existPreTrain=true;break}}if(flag_existPreTrain){preTrainedSlotNo=String(_preTrainCustomObj.slotNo);currentSlotNo=String(customVariationObj.slotNo);preTrainedSlotColumnNo=parseInt(preTrainedSlotNo.charAt(0));slotColumnNo=parseInt(currentSlotNo.charAt(0));if(preTrainedSlotColumnNo<slotColumnNo){nc.bns.training.util.ArrayUtil.removeElement(customVariationObjArr,_preTrainCustomObj);customVariationObjArr.push(customVariationObj)}}else{customVariationObjArr.push(customVariationObj)}}else{}}for(var skillId in slotData){variationId=slotData[skillId];if(nc.bns.training.util.CheckUtil.available(nc.bns.training.Model.SLOT_OBJ_JSON[skillId])){var variationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationId(skillId,variationId);if(variationObj){_skillList=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillId);if(variationObj.tree_id!=variationObj.skill_id){}else{var customVariationObj=nc.bns.training.util.SearchDataUtil.getCustomVariationObjHasSkillIdAndVariationId(_skillList.tree_id,_skillList.skill_id,variationId);if(customVariationObj){var _tmpCustomVariationObj,flag_existPreTrain=false,_preTrainCustomObj;for(var i=0,max=customVariationObjArr.length;i<max;i++){_tmpCustomVariationObj=customVariationObjArr[i];if(_tmpCustomVariationObj.tree_id==customVariationObj.tree_id){_preTrainCustomObj=_tmpCustomVariationObj;flag_existPreTrain=true;break}}if(flag_existPreTrain){preTrainedSlotNo=String(_preTrainCustomObj.slotNo);currentSlotNo=String(customVariationObj.slotNo);preTrainedSlotColumnNo=parseInt(preTrainedSlotNo.charAt(0));slotColumnNo=parseInt(currentSlotNo.charAt(0));if(preTrainedSlotColumnNo<slotColumnNo){nc.bns.training.util.ArrayUtil.removeElement(customVariationObjArr,_preTrainCustomObj);customVariationObjArr.push(customVariationObj)}}else{customVariationObjArr.push(customVariationObj)}}else{}}}else{}}else{_skillList=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillId);if(_skillList){switch(_skillList.skillType){case"":break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:var customVariationObj=nc.bns.training.util.SearchDataUtil.getCustomVariationObjHasSkillIdAndVariationId(_skillList.tree_id,_skillList.skill_id,variationId);if(customVariationObj){var _tmpCustomVariationObj,flag_existPreTrain=false,_preTrainCustomObj;for(var i=0,max=customVariationObjArr.length;i<max;i++){_tmpCustomVariationObj=customVariationObjArr[i];if(_tmpCustomVariationObj.tree_id==customVariationObj.tree_id){_preTrainCustomObj=_tmpCustomVariationObj;flag_existPreTrain=true;break}}if(flag_existPreTrain){preTrainedSlotNo=String(_preTrainCustomObj.slotNo);currentSlotNo=String(customVariationObj.slotNo);preTrainedSlotColumnNo=parseInt(preTrainedSlotNo.charAt(0));slotColumnNo=parseInt(currentSlotNo.charAt(0));if(preTrainedSlotColumnNo<slotColumnNo){nc.bns.training.util.ArrayUtil.removeElement(customVariationObjArr,_preTrainCustomObj);customVariationObjArr.push(customVariationObj)}}else{customVariationObjArr.push(customVariationObj)}}else{}break;case nc.bns.training.Model.SKILL_TYPE_NONE:checkEtcSkillProcess(skillId,variationId);break}}else{checkEtcSkillProcess(skillId,variationId)}}}var customJsonSlotData={};for(var i=0,max=customVariationObjArr.length;i<max;i++){customObj=customVariationObjArr[i];customJsonSlotData[String(customObj.skill_id)]=customObj.variation_id}$jsonObj.json_slot_data=customJsonSlotData;resettingByJsonDataObj($jsonObj)}return _this};nc.bns.training.select.SelectLevel=function(_options){var _this=this;_this.destroy=function(){if(!_container)return;$(_container).unbind("click",containerMouseInteraction);var selectBtns=$("li",_container);var _liBtnElement;for(var i=0,max=btnLiArr.length;i<max;i++){_liBtnElement=btnLiArr[i];$(_liBtnElement).unbind("click",selectBtnMouseInteraction)}btnLiArr=[]};_this.displayLevel=function($level){_$titleElement.text(String($level))};_this.open=function($flag){displayBtnContainer($flag);flag_displaySelect=$flag};var _container=_options.container;var _$titleElement;var _btnContainer;var btnLiArr=[];var flag_displaySelect=false;init();function init(){_$titleElement=$("> strong",_container);_btnContainer=$(".ly_level",_container).get(0);displayBtnContainer(false);var _liBtnElement;for(var i=nc.bns.training.Model.MIN_LEVEL_CAN_USE_SKILL_POINT,max=nc.bns.training.Model.maxLevel;i<=max;i++){_liBtnElement=document.createElement("li");$(_liBtnElement).text(String(i));$(_liBtnElement).bind("click",selectBtnMouseInteraction);_btnContainer.appendChild(_liBtnElement);btnLiArr.push(_liBtnElement)}if(!nc.bns.training.Model.editable){$(_container).css("cursor","auto");return}$(_container).bind("click",containerMouseInteraction)}function containerMouseInteraction($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case"click":if(flag_displaySelect){displayBtnContainer(false);flag_displaySelect=false}else{displayBtnContainer(true);flag_displaySelect=true;$(_this).trigger({type:nc.bns.training.select.SelectLevel.OPEN_SELECT_LEVEL})}break}}function selectBtnMouseInteraction($evt){$evt.preventDefault();switch($evt.type){case"click":var _target=$evt.currentTarget;var str=$(_target).text();_$titleElement.text(str);$(_this).trigger({type:nc.bns.training.select.SelectLevel.SELECT_LEVEL,level:parseInt(str)});break}}function displayBtnContainer($flag){if(!_btnContainer)return;if($flag){_btnContainer.style.display="block"}else{_btnContainer.style.display="none"}}return _this};nc.bns.training.select.SelectLevel.SELECT_LEVEL="SELECT_LEVEL";nc.bns.training.select.SelectLevel.OPEN_SELECT_LEVEL="OPEN_SELECT_LEVEL";nc.bns.training.select.SelectMasteryLevel=function(_options){var _this=this;_this.destroy=function(){if(!_container)return;$(_container).unbind("click",containerMouseInteraction);var selectBtns=$("li",_container);var _tmpBtn;for(var i=0,max=selectBtns.size();i<max;i++){_tmpBtn=selectBtns[i];$(_tmpBtn).unbind("click",selectBtnMouseInteraction)}};_this.open=function($flag){displayBtnContainer($flag);flag_displaySelect=$flag};_this.switchMasteryLevelRange=function($levelRangeValue){$(_btnContainer).empty();var levelRange=parseInt($levelRangeValue);var _li;for(var i=0,max=levelRange;i<=max;i++){_li=document.createElement("li");$(_li).text(String(i));_btnContainer.appendChild(_li);$(_li).bind("click",selectBtnMouseInteraction)}};_this.displayMasteryLevel=function($level){_$titleElement.text(String($level))};_this.setMouseInteraction=function($flag){if(!nc.bns.training.Model.editable)return;$(_container).unbind("click",containerMouseInteraction);if($flag){$(_container).bind("click",containerMouseInteraction);$(_container).css("cursor","pointer")}else{$(_container).css("cursor","auto")}};var _container=_options.container;var _$titleElement;var _btnContainer;var flag_displaySelect=false;init();function init(){_$titleElement=$("> strong",_container);_btnContainer=$(".ly_level",_container).get(0);displayBtnContainer(false);if(!nc.bns.training.Model.editable){$(_container).css("cursor","auto")}}function containerMouseInteraction($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case"click":if(flag_displaySelect){displayBtnContainer(false);flag_displaySelect=false}else{displayBtnContainer(true);flag_displaySelect=true;$(_this).trigger({type:nc.bns.training.select.SelectMasteryLevel.OPEN_MASTERY_SELECT_LEVEL})}break}}function selectBtnMouseInteraction($evt){$evt.preventDefault();switch($evt.type){case"click":var _target=$evt.currentTarget;var str=$(_target).text();_$titleElement.text(str);$(_this).trigger({type:nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL,level:parseInt(str)});break}}function displayBtnContainer($flag){if(!_btnContainer)return;if($flag){_btnContainer.style.display="block"}else{_btnContainer.style.display="none"}}return _this};nc.bns.training.select.SelectMasteryLevel.SELECT_MASTERY_LEVEL="SELECT_MASTERY_LEVEL";nc.bns.training.select.SelectMasteryLevel.OPEN_MASTERY_SELECT_LEVEL="OPEN_MASTERY_SELECT_LEVEL";nc.bns.training.tooltip.Contents=function(_options){var _this=this;var ORIGINAL_LEVEL_STR="Lv1";var CHANGE_TITLE_TAG=document.createElement("span");$(CHANGE_TITLE_TAG).addClass("ui_skill_mod");var CHANGE_IMG_TAG='<img src="http://bns.damab.net/bnstr2/img/skill_ui_mod.png">';var ADD_TITLE_TAG=document.createElement("span");$(ADD_TITLE_TAG).addClass("ui_skill_add");var ADD_IMG_TAG='<img src="http://bns.damab.net/bnstr2/img/skill_ui_add.png" />';var DEL_TITLE_TAG=document.createElement("span");$(DEL_TITLE_TAG).addClass("ui_skill_del");var SPACE_STR="&#32";_this.destroy=function(){};_this.displayDiffData=function($evt){displayDiffData($evt)};function displayDiffData($evt){var variationData=$evt.variationData;var treeId=variationData.tree_id;var skillId=variationData.skill_id;var skillType=$evt.skillType;var slotType=$evt.slotType;var _treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var _skillListObj;var skillDataArr;var firstSkillObj;var originalTooltipData=null;var targetTooltipData=null;var originalSkillTooltipAliasLowerStr="";var targetTooltipAliasLowerStr="";function displayTooltipStanceConditionAcquireByVariationData($variationData){if($variationData.tooltip_stance_refine){_displaySkillStanceRefine.displaySkillInfo($variationData.tooltip_stance_refine);_displaySkillStanceRefine.displayStanceRefine(true)}else{_displaySkillStanceRefine.displayStanceRefine(false)}if($variationData.tooltip_condition_refine){_displaySkillUseCondition.displaySkillInfo($variationData.tooltip_condition_refine);_displaySkillUseCondition.displayUseCondition(true)}else{_displaySkillUseCondition.displayUseCondition(false)}displayTooltipQuestLegendByVariationData($variationData)}function displayTooltipStanceConditionBySelectedSkillListSkillId($skillId){var _skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);if(_skillListObj.tooltip_stance_refine){_displaySkillStanceRefine.displaySkillInfo(_skillListObj.tooltip_stance_refine);_displaySkillStanceRefine.displayStanceRefine(true)}else{_displaySkillStanceRefine.displayStanceRefine(false)}if(_skillListObj.tooltip_condition_refine){_displaySkillUseCondition.displaySkillInfo(_skillListObj.tooltip_condition_refine);_displaySkillUseCondition.displayUseCondition(true)}else{_displaySkillUseCondition.displayUseCondition(false)}}function displayTooltipQuestLegendByVariationData($variationData){if($variationData.complete_quest_name_refine){if($variationData.complete_quest_desc_refine){_displaySkillAcquire.setEliteSkillInfo(String($variationData.complete_quest_name_refine),String($variationData.complete_quest_desc_refine))}else{_displaySkillAcquire.setLegendSkillInfo(String($variationData.complete_quest_name_refine))}_displaySkillAcquire.displayAcquire(true)}else{_displaySkillAcquire.displayAcquire(false)}}function setDisplayTooltipDescDiff(){var targetSkillSlotData={};var originalSkillSlotData={};targetSkillSlotData=$.extend(true,targetSkillSlotData,nc.bns.training.Model.DATA_SKILL_TOOLTIP_OBJ_JSON[targetTooltipAliasLowerStr]);originalSkillSlotData=$.extend(true,originalSkillSlotData,nc.bns.training.Model.DATA_SKILL_TOOLTIP_OBJ_JSON[originalSkillTooltipAliasLowerStr]);var originalMainInfo1StrArr=(originalTooltipData.main_info1)?originalTooltipData.main_info1.split("<br/>"):[];var originalMainInfo2StrArr=(originalTooltipData.main_info2)?originalTooltipData.main_info2.split("<br/>"):[];var originalSubInfoStrArr=(originalTooltipData.sub_info)?originalTooltipData.sub_info.split("<br/>"):[];var infoObjs,obj;for(var group in originalSkillSlotData){infoObjs=originalSkillSlotData[group];switch(group){case"m1":for(var no in infoObjs){obj=infoObjs[no];obj.title=originalMainInfo1StrArr[parseInt(no)]}break;case"m2":for(var no in infoObjs){obj=infoObjs[no];obj.title=originalMainInfo2StrArr[parseInt(no)]}break;case"sub":for(var no in infoObjs){obj=infoObjs[no];obj.title=originalSubInfoStrArr[parseInt(no)]}break}}var targetMainInfo1StrArr=(targetTooltipData.main_info1)?targetTooltipData.main_info1.split("<br/>"):[];var targetMainInfo2StrArr=(targetTooltipData.main_info2)?targetTooltipData.main_info2.split("<br/>"):[];var targetSubInfoStrArr=(targetTooltipData.sub_info)?targetTooltipData.sub_info.split("<br/>"):[];var infoObjs,obj;for(var group in targetSkillSlotData){infoObjs=targetSkillSlotData[group];switch(group){case"m1":for(var no in infoObjs){obj=infoObjs[no];obj.title=targetMainInfo1StrArr[parseInt(no)]}break;case"m2":for(var no in infoObjs){obj=infoObjs[no];obj.title=targetMainInfo2StrArr[parseInt(no)]}break;case"sub":for(var no in infoObjs){obj=infoObjs[no];obj.title=targetSubInfoStrArr[parseInt(no)]}break}}var originalInfoObjArr=[];var groupObj,infoObj;for(var group in originalSkillSlotData){groupObj=originalSkillSlotData[group];for(var index in groupObj){infoObj=groupObj[index];if(infoObj["tooltip-group"]!="CONDITION"&&infoObj["tooltip-group"]!="STANCE"){originalInfoObjArr.push(infoObj)}}}var targetM1InfoObjArr=[];var targetM2InfoObjArr=[];var targetSubInfoObjArr=[];var targetInfoObjArr=[];var groupObj,infoObj;for(var group in targetSkillSlotData){groupObj=targetSkillSlotData[group];for(var index in groupObj){infoObj=groupObj[index];switch(String(infoObj["tooltip-group"]).toUpperCase()){case"M1":targetInfoObjArr.push(infoObj);targetM1InfoObjArr.push(infoObj);break;case"M2":targetInfoObjArr.push(infoObj);targetM2InfoObjArr.push(infoObj);break;case"SUB":targetInfoObjArr.push(infoObj);targetSubInfoObjArr.push(infoObj);break}}}var _dummyM1InfoDiv=document.createElement("div");var _dummyM2InfoDiv=document.createElement("div");var _dummySubInfoDiv=document.createElement("div");var allM1InfoElementArr=[];var allM2InfoElementArr=[];var allSubInfoElementArr=[];var _tmpTextNode;var _$changeElement;var _$deleteElement;var _$addElement;function getExistEqualDefaultTextSkill($originalInfoObj){var flag_existEqualSkill=false;var _tmpTargetInfoObj,_tmpOriginalInfoObj;for(var k=0,_max=targetSubInfoObjArr.length;k<_max;k++){_tmpTargetInfoObj=targetSubInfoObjArr[k];if($originalInfoObj["target-attribute"]!=_tmpTargetInfoObj["target-attribute"])continue;if($originalInfoObj["effect-attribute"]!=_tmpTargetInfoObj["effect-attribute"])continue;if($originalInfoObj["condition-attribute"]!=_tmpTargetInfoObj["condition-attribute"])continue;if($originalInfoObj["default-text"]!=_tmpTargetInfoObj["default-text"])continue;flag_existEqualSkill=true}return flag_existEqualSkill}function getExistEqualEffectArgsSkill($originalInfoObj){var flag_existEqualSkill=false;var _tmpTargetInfoObj,_tmpOriginalInfoObj;for(var k=0,_max=targetSubInfoObjArr.length;k<_max;k++){_tmpTargetInfoObj=targetSubInfoObjArr[k];if($originalInfoObj["target-attribute"]!=_tmpTargetInfoObj["target-attribute"])continue;if($originalInfoObj["effect-attribute"]!=_tmpTargetInfoObj["effect-attribute"])continue;if($originalInfoObj["condition-attribute"]!=_tmpTargetInfoObj["condition-attribute"])continue;if($originalInfoObj["effect-arg-1"]!=_tmpTargetInfoObj["effect-arg-1"])continue;if($originalInfoObj["effect-arg-2"]!=_tmpTargetInfoObj["effect-arg-2"])continue;if($originalInfoObj["effect-arg-3"]!=_tmpTargetInfoObj["effect-arg-3"])continue;if($originalInfoObj["effect-arg-4"]!=_tmpTargetInfoObj["effect-arg-4"])continue;flag_existEqualSkill=true}return flag_existEqualSkill}function getExistEqualConditionArgsSkill($originalInfoObj){var flag_existEqualSkill=false;var _tmpTargetInfoObj,_tmpOriginalInfoObj;for(var k=0,_max=targetSubInfoObjArr.length;k<_max;k++){_tmpTargetInfoObj=targetSubInfoObjArr[k];if($originalInfoObj["target-attribute"]!=_tmpTargetInfoObj["target-attribute"])continue;if($originalInfoObj["effect-attribute"]!=_tmpTargetInfoObj["effect-attribute"])continue;if($originalInfoObj["condition-attribute"]!=_tmpTargetInfoObj["condition-attribute"])continue;if($originalInfoObj["condition-arg-1"]!=_tmpTargetInfoObj["condition-arg-1"])continue;if($originalInfoObj["condition-arg-2"]!=_tmpTargetInfoObj["condition-arg-2"])continue;flag_existEqualSkill=true}return flag_existEqualSkill}function getIndexOfOriginalInfoMatchTargetInfo($targetInfoObj){var index=-1;var _originalInfoObj;for(var i=0,max=originalInfoObjArr.length;i<max;i++){_originalInfoObj=originalInfoObjArr[i];if(_originalInfoObj["default-text"]==$targetInfoObj["default-text"]){index=i;break}}return index}function setM1Info(){var funcObj={};funcObj.matchM1Info=function($funcObj){if(!targetM1InfoObjArr.length<0)return;var flag_differentEffectArg=false;var flag_differentConditionArg=false;var flag_rerun=false;var flag_existDetailDifference=false;var targetInfoObj,originalInfoObj;for(var i=0,max=targetM1InfoObjArr.length;i<max;i++){flag_differentEffectArg=false;flag_differentConditionArg=false;flag_rerun=false;targetInfoObj=targetM1InfoObjArr[i];if(!targetInfoObj["target-attribute"]&&!targetInfoObj["effect-attribute"]&&!targetInfoObj["condition-attribute"]){if(targetInfoObj["default-text"]){var matchObjIndexInOriginalInfoObjArr=getIndexOfOriginalInfoMatchTargetInfo(targetInfoObj);if(matchObjIndexInOriginalInfoObjArr>=0){_tmpTextNode=document.createTextNode(targetInfoObj.title);allM1InfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetM1InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObjArr[matchObjIndexInOriginalInfoObjArr]);flag_rerun=true}else{_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM1InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM1InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}}}if(flag_rerun)break;var originalInfoObj;for(var j=0,length=originalInfoObjArr.length;j<length;j++){originalInfoObj=originalInfoObjArr[j];if(originalInfoObj["target-attribute"]==targetInfoObj["target-attribute"]){if(originalInfoObj["effect-attribute"]==targetInfoObj["effect-attribute"]){if(originalInfoObj["condition-attribute"]==targetInfoObj["condition-attribute"]){if(originalInfoObj["effect-arg-1"]!=targetInfoObj["effect-arg-1"]||originalInfoObj["effect-arg-2"]!=targetInfoObj["effect-arg-2"]||originalInfoObj["effect-arg-3"]!=targetInfoObj["effect-arg-3"]||originalInfoObj["effect-arg-4"]!=targetInfoObj["effect-arg-4"]){var effectAttributeStr=originalInfoObj["effect-attribute"];var globalTooltipAttributeObj=nc.bns.training.Model.DATA_SKILL_TOOLTIP_ATTRIBUTE_OBJ_JSON[effectAttributeStr.toLowerCase()];var textAliasIndex=-1;for(var i=1;i<=4;i++){if(globalTooltipAttributeObj["arg-type-"+i]=="text-alias"){textAliasIndex=i;break}}if(textAliasIndex>=1){if(originalInfoObj["effect-arg-"+textAliasIndex]!=targetInfoObj["effect-arg-"+textAliasIndex]){continue}}if(getExistEqualEffectArgsSkill(originalInfoObj)){_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM1InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM1InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}else{_$changeElement=$(CHANGE_TITLE_TAG).clone();_$deleteElement=$(DEL_TITLE_TAG).clone();_$changeElement.html(targetInfoObj.title+SPACE_STR+CHANGE_IMG_TAG);_$deleteElement.html(originalInfoObj.title);allM1InfoElementArr.push(_$changeElement);allM1InfoElementArr.push(_$deleteElement);flag_differentEffectArg=true}}if(flag_rerun)break;if(originalInfoObj["condition-arg-1"]!=targetInfoObj["condition-arg-1"]||originalInfoObj["condition-arg-2"]!=targetInfoObj["condition-arg-2"]){if(getExistEqualConditionArgsSkill(originalInfoObj)){_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM1InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM1InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}else{var conditionAttribute=originalInfoObj["condition-attribute"];switch(conditionAttribute){case"C_during_skill":_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM1InfoElementArr.push(_$addElement);_$deleteElement=$(DEL_TITLE_TAG).clone();_$deleteElement.html(originalInfoObj.title);allM1InfoElementArr.push(_$deleteElement);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true;break;case"C_after_using_skill2":var flag_exist=false;var infoObj;for(var k=0,len=originalInfoObjArr.length;k<len;k++){infoObj=originalInfoObjArr[k];if(infoObj["condition-arg-1"]==targetInfoObj["condition-arg-1"]&&infoObj["condition-arg-2"]==targetInfoObj["condition-arg-2"]){originalInfoObj=infoObj;flag_exist=true;break}}if(flag_exist){_tmpTextNode=document.createTextNode(targetInfoObj.title);allM1InfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}break;default:_$changeElement=$(CHANGE_TITLE_TAG).clone();_$deleteElement=$(DEL_TITLE_TAG).clone();_$changeElement.html(targetInfoObj.title+SPACE_STR+CHANGE_IMG_TAG);_$deleteElement.html(originalInfoObj.title);allM1InfoElementArr.push(_$changeElement);allM1InfoElementArr.push(_$deleteElement);flag_differentConditionArg=true;break}}}if(flag_rerun)break;if(flag_differentEffectArg||flag_differentConditionArg){nc.bns.training.util.ArrayUtil.removeElement(targetM1InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}else{_tmpTextNode=document.createTextNode(targetInfoObj.title);allM1InfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetM1InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}if(flag_rerun)break}}}}if(flag_rerun)break;_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM1InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM1InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true;if(flag_rerun)break}if(flag_rerun){$funcObj.matchM1Info($funcObj)}};funcObj.matchM1Info(funcObj)}function setM2Info(){var funcObj={};funcObj.matchM2Info=function($funcObj){if(!targetM2InfoObjArr.length<0)return;var flag_differentEffectArg=false;var flag_differentConditionArg=false;var flag_rerun=false;var flag_existDetailDifference=false;var targetInfoObj,originalInfoObj;for(var i=0,max=targetM2InfoObjArr.length;i<max;i++){flag_differentEffectArg=false;flag_differentConditionArg=false;flag_rerun=false;targetInfoObj=targetM2InfoObjArr[i];if(!targetInfoObj["target-attribute"]&&!targetInfoObj["effect-attribute"]&&!targetInfoObj["condition-attribute"]){if(targetInfoObj["default-text"]){var matchObjIndexInOriginalInfoObjArr=getIndexOfOriginalInfoMatchTargetInfo(targetInfoObj);if(matchObjIndexInOriginalInfoObjArr>=0){_tmpTextNode=document.createTextNode(targetInfoObj.title);allM2InfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetM2InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObjArr[matchObjIndexInOriginalInfoObjArr]);flag_rerun=true}else{_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM2InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM2InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}}}if(flag_rerun)break;var originalInfoObj;for(var j=0,length=originalInfoObjArr.length;j<length;j++){originalInfoObj=originalInfoObjArr[j];if(originalInfoObj["target-attribute"]==targetInfoObj["target-attribute"]){if(originalInfoObj["effect-attribute"]==targetInfoObj["effect-attribute"]){if(originalInfoObj["condition-attribute"]==targetInfoObj["condition-attribute"]){if(originalInfoObj["effect-arg-1"]!=targetInfoObj["effect-arg-1"]||originalInfoObj["effect-arg-2"]!=targetInfoObj["effect-arg-2"]||originalInfoObj["effect-arg-3"]!=targetInfoObj["effect-arg-3"]||originalInfoObj["effect-arg-4"]!=targetInfoObj["effect-arg-4"]){var effectAttributeStr=originalInfoObj["effect-attribute"];var globalTooltipAttributeObj=nc.bns.training.Model.DATA_SKILL_TOOLTIP_ATTRIBUTE_OBJ_JSON[effectAttributeStr.toLowerCase()];var textAliasIndex=-1;for(var i=1;i<=4;i++){if(globalTooltipAttributeObj["arg-type-"+i]=="text-alias"){textAliasIndex=i;break}}if(textAliasIndex>=1){if(originalInfoObj["effect-arg-"+textAliasIndex]!=targetInfoObj["effect-arg-"+textAliasIndex]){continue}}if(getExistEqualEffectArgsSkill(originalInfoObj)){_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM2InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM2InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}else{_$changeElement=$(CHANGE_TITLE_TAG).clone();_$deleteElement=$(DEL_TITLE_TAG).clone();_$changeElement.html(targetInfoObj.title+SPACE_STR+CHANGE_IMG_TAG);_$deleteElement.html(originalInfoObj.title);allM2InfoElementArr.push(_$changeElement);allM2InfoElementArr.push(_$deleteElement);flag_differentEffectArg=true}}if(flag_rerun)break;if(originalInfoObj["condition-arg-1"]!=targetInfoObj["condition-arg-1"]||originalInfoObj["condition-arg-2"]!=targetInfoObj["condition-arg-2"]){if(getExistEqualConditionArgsSkill(originalInfoObj)){_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM2InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM2InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}else{var conditionAttribute=originalInfoObj["condition-attribute"];switch(conditionAttribute){case"C_during_skill":_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM2InfoElementArr.push(_$addElement);_$deleteElement=$(DEL_TITLE_TAG).clone();_$deleteElement.html(originalInfoObj.title);allM2InfoElementArr.push(_$deleteElement);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true;break;case"C_after_using_skill2":var flag_exist=false;var infoObj;for(var k=0,len=originalInfoObjArr.length;k<len;k++){infoObj=originalInfoObjArr[k];if(infoObj["condition-arg-1"]==targetInfoObj["condition-arg-1"]&&infoObj["condition-arg-2"]==targetInfoObj["condition-arg-2"]){originalInfoObj=infoObj;flag_exist=true;break}}if(flag_exist){_tmpTextNode=document.createTextNode(targetInfoObj.title);allM2InfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}break;default:_$changeElement=$(CHANGE_TITLE_TAG).clone();_$deleteElement=$(DEL_TITLE_TAG).clone();_$changeElement.html(targetInfoObj.title+SPACE_STR+CHANGE_IMG_TAG);_$deleteElement.html(originalInfoObj.title);allM2InfoElementArr.push(_$changeElement);allM2InfoElementArr.push(_$deleteElement);flag_differentConditionArg=true;break}}}if(flag_rerun)break;if(flag_differentEffectArg||flag_differentConditionArg){nc.bns.training.util.ArrayUtil.removeElement(targetM2InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}else{_tmpTextNode=document.createTextNode(targetInfoObj.title);allM2InfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetM2InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}if(flag_rerun)break}}}}if(flag_rerun)break;_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allM2InfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetM2InfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true;if(flag_rerun)break}if(flag_rerun){$funcObj.matchM2Info($funcObj)}};funcObj.matchM2Info(funcObj)}function setSubInfo(){var funcObj={};funcObj.matchSubInfo=function($funcObj){if(!targetSubInfoObjArr.length<0)return;var flag_differentEffectArg=false;var flag_differentConditionArg=false;var flag_rerun=false;var flag_existDetailDifference=false;var targetInfoObj,originalInfoObj;for(var i=0,max=targetSubInfoObjArr.length;i<max;i++){flag_differentEffectArg=false;flag_differentConditionArg=false;flag_rerun=false;targetInfoObj=targetSubInfoObjArr[i];if(!targetInfoObj["target-attribute"]&&!targetInfoObj["effect-attribute"]&&!targetInfoObj["condition-attribute"]){if(targetInfoObj["default-text"]){var matchObjIndexInOriginalInfoObjArr=getIndexOfOriginalInfoMatchTargetInfo(targetInfoObj);if(matchObjIndexInOriginalInfoObjArr>=0){_tmpTextNode=document.createTextNode(targetInfoObj.title);allSubInfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObjArr[matchObjIndexInOriginalInfoObjArr]);flag_rerun=true}else{_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allSubInfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}}}if(flag_rerun)break;var originalInfoObj;for(var j=0,length=originalInfoObjArr.length;j<length;j++){originalInfoObj=originalInfoObjArr[j];if(originalInfoObj["target-attribute"]==targetInfoObj["target-attribute"]){if(originalInfoObj["effect-attribute"]==targetInfoObj["effect-attribute"]){if(originalInfoObj["condition-attribute"]==targetInfoObj["condition-attribute"]){if(originalInfoObj["effect-arg-1"]!=targetInfoObj["effect-arg-1"]||originalInfoObj["effect-arg-2"]!=targetInfoObj["effect-arg-2"]||originalInfoObj["effect-arg-3"]!=targetInfoObj["effect-arg-3"]||originalInfoObj["effect-arg-4"]!=targetInfoObj["effect-arg-4"]){var effectAttributeStr=originalInfoObj["effect-attribute"];var globalTooltipAttributeObj=nc.bns.training.Model.DATA_SKILL_TOOLTIP_ATTRIBUTE_OBJ_JSON[effectAttributeStr.toLowerCase()];var textAliasIndex=-1;for(var i=1;i<=4;i++){if(globalTooltipAttributeObj["arg-type-"+i]=="text-alias"){textAliasIndex=i;break}}if(textAliasIndex>=1){if(originalInfoObj["effect-arg-"+textAliasIndex]!=targetInfoObj["effect-arg-"+textAliasIndex]){continue}}if(getExistEqualEffectArgsSkill(originalInfoObj)){_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allSubInfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}else{_$changeElement=$(CHANGE_TITLE_TAG).clone();_$deleteElement=$(DEL_TITLE_TAG).clone();_$changeElement.html(targetInfoObj.title+SPACE_STR+CHANGE_IMG_TAG);_$deleteElement.html(originalInfoObj.title);allSubInfoElementArr.push(_$changeElement);allSubInfoElementArr.push(_$deleteElement);flag_differentEffectArg=true}}if(flag_rerun)break;if(originalInfoObj["condition-arg-1"]!=targetInfoObj["condition-arg-1"]||originalInfoObj["condition-arg-2"]!=targetInfoObj["condition-arg-2"]){if(getExistEqualConditionArgsSkill(originalInfoObj)){_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allSubInfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true}else{var conditionAttribute=originalInfoObj["condition-attribute"];switch(conditionAttribute){case"C_during_skill":_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allSubInfoElementArr.push(_$addElement);_$deleteElement=$(DEL_TITLE_TAG).clone();_$deleteElement.html(originalInfoObj.title);allSubInfoElementArr.push(_$deleteElement);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true;break;case"C_after_using_skill2":var flag_exist=false;var infoObj;for(var k=0,len=originalInfoObjArr.length;k<len;k++){infoObj=originalInfoObjArr[k];if(infoObj["condition-arg-1"]==targetInfoObj["condition-arg-1"]&&infoObj["condition-arg-2"]==targetInfoObj["condition-arg-2"]){originalInfoObj=infoObj;flag_exist=true;break}}if(flag_exist){_tmpTextNode=document.createTextNode(targetInfoObj.title);allSubInfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}break;default:_$changeElement=$(CHANGE_TITLE_TAG).clone();_$deleteElement=$(DEL_TITLE_TAG).clone();_$changeElement.html(targetInfoObj.title+SPACE_STR+CHANGE_IMG_TAG);_$deleteElement.html(originalInfoObj.title);allSubInfoElementArr.push(_$changeElement);allSubInfoElementArr.push(_$deleteElement);flag_differentConditionArg=true;break}}}if(flag_rerun)break;if(flag_differentEffectArg||flag_differentConditionArg){nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}else{_tmpTextNode=document.createTextNode(targetInfoObj.title);allSubInfoElementArr.push(_tmpTextNode);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj);flag_rerun=true}if(flag_rerun)break}}}}if(flag_rerun)break;_$addElement=$(ADD_TITLE_TAG).clone();_$addElement.html(targetInfoObj.title+SPACE_STR+ADD_IMG_TAG);allSubInfoElementArr.push(_$addElement);nc.bns.training.util.ArrayUtil.removeElement(targetSubInfoObjArr,targetInfoObj);nc.bns.training.util.ArrayUtil.removeElement(targetInfoObjArr,targetInfoObj);flag_rerun=true;if(flag_rerun)break}if(flag_rerun){$funcObj.matchSubInfo($funcObj)}};funcObj.matchSubInfo(funcObj)}function setRestOriginalM1Info(){var cloneOriginalInfoObjArr=originalInfoObjArr.concat();for(var i=0,max=cloneOriginalInfoObjArr.length;i<max;i++){originalInfoObj=cloneOriginalInfoObjArr[i];if(String(originalInfoObj["tooltip-group"]).toUpperCase()!="M1")continue;_$deleteElement=$(DEL_TITLE_TAG).clone();_$deleteElement.html(originalInfoObj.title);allM1InfoElementArr.push(_$deleteElement);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj)}}function setRestOriginalM2Info(){var cloneOriginalInfoObjArr=originalInfoObjArr.concat();for(var i=0,max=cloneOriginalInfoObjArr.length;i<max;i++){originalInfoObj=cloneOriginalInfoObjArr[i];if(String(originalInfoObj["tooltip-group"]).toUpperCase()!="M2")continue;_$deleteElement=$(DEL_TITLE_TAG).clone();_$deleteElement.html(originalInfoObj.title);allM2InfoElementArr.push(_$deleteElement);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj)}}function setRestOriginalSubInfo(){var cloneOriginalInfoObjArr=originalInfoObjArr.concat();for(var i=0,max=cloneOriginalInfoObjArr.length;i<max;i++){originalInfoObj=cloneOriginalInfoObjArr[i];if(String(originalInfoObj["tooltip-group"]).toUpperCase()!="SUB")continue;_$deleteElement=$(DEL_TITLE_TAG).clone();_$deleteElement.html(originalInfoObj.title);allSubInfoElementArr.push(_$deleteElement);nc.bns.training.util.ArrayUtil.removeElement(originalInfoObjArr,originalInfoObj)}}function setM1InfoElements(){var _element;for(var i=0,max=allM1InfoElementArr.length;i<max;i++){_element=allM1InfoElementArr[i];$(_dummyM1InfoDiv).append(_element);if(i<max)$(_dummyM1InfoDiv).append(document.createElement("br"))}}function setM2InfoElements(){var _element;for(var i=0,max=allM2InfoElementArr.length;i<max;i++){_element=allM2InfoElementArr[i];$(_dummyM2InfoDiv).append(_element);if(i<max)$(_dummyM2InfoDiv).append(document.createElement("br"))}}function setSubInfoElements(){var _element;for(var i=0,max=allSubInfoElementArr.length;i<max;i++){_element=allSubInfoElementArr[i];$(_dummySubInfoDiv).append(_element);if(i<max)$(_dummySubInfoDiv).append(document.createElement("br"))}}if(targetM1InfoObjArr.length>0)setM1Info();if(targetM2InfoObjArr.length>0)setM2Info();if(targetSubInfoObjArr.length>0)setSubInfo();setRestOriginalM1Info();setM1InfoElements();setRestOriginalM2Info();setM2InfoElements();setRestOriginalSubInfo();setSubInfoElements();_displayTooltipDesc.setAllInfoByExternal(_dummyM1InfoDiv.innerHTML,_dummyM2InfoDiv.innerHTML,_dummySubInfoDiv.innerHTML);_displayTooltipDesc.setSkillNameByExternal(targetTooltipData);_displayTooltipDesc.setSkillThumbnailByExternal(targetTooltipData);_displayTooltipDesc.setSkillMatrixByExternal(variationData.matrix_name);_displayTooltipDesc.setHealPointChangeDescByExternal(originalTooltipData,targetTooltipData);_displaySkillInfo.displaySkillInfoDiff(originalTooltipData,targetTooltipData)}function setDisplayTooltipDescDiffBySkillIdAndVariationData($skillId,$variationData){skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[$skillId];firstSkillObj=skillDataArr[0];originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[getTransformedLv1SlotTooltipAliasStr(firstSkillObj.tooltipAlias)];if(!originalTooltipData){originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[firstSkillObj.tooltipAlias]}targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[$variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,$variationData)}function setDisplayTooltipDescDiffByVariationData($originalTooltipData,$targetTooltipData,$variationData){originalSkillTooltipAliasLowerStr=String($originalTooltipData.tooltipAlias).toLowerCase();targetTooltipAliasLowerStr=String($targetTooltipData.tooltipAlias).toLowerCase();setDisplayTooltipDescDiff();displayTooltipStanceConditionAcquireByVariationData($variationData)}function setDisplayTooltipDescDiffBySkillId($originalTooltipData,$targetTooltipData,$skillId){originalSkillTooltipAliasLowerStr=String($originalTooltipData.tooltipAlias).toLowerCase();targetTooltipAliasLowerStr=String($targetTooltipData.tooltipAlias).toLowerCase();setDisplayTooltipDescDiff();displayTooltipStanceConditionBySelectedSkillListSkillId($skillId)}if(_treeSkillListObj.learnedSkillVariationId!=""){_skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(nc.bns.training.Model.lastSelectedSkillListSkillId);switch(_skillListObj.skillType){case"":switch(slotType){case"":skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var flag_exist=false;var _tmpSkillData;for(var i=0,max=skillDataArr.length;i<max;i++){_tmpSkillData=skillDataArr[i];if(_tmpSkillData.tooltipAlias==_treeSkillListObj.learnedSkillTooltipAlias){originalTooltipData=_tmpSkillData;flag_exist=true;break}}if(flag_exist){}else{var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],_treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id!=treeId){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){originalTooltipData=skillDataArr[0]}else{var lastSelectedNormalSkillVariationObj=prevTrainSkillVariationObjArr[0];originalTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(lastSelectedNormalSkillVariationObj.tooltip_alias,skillDataArr);if(!originalTooltipData){originalTooltipData=skillDataArr[0]}}}targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData);break;case nc.bns.training.Model.SLOT_REPLACE:skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[_treeSkillListObj.learnedSkillTooltipAlias];targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData);break;case nc.bns.training.Model.SLOT_ACQUISITION:skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var flag_exist=false;var _tmpSkillData;for(var i=0,max=skillDataArr.length;i<max;i++){_tmpSkillData=skillDataArr[i];if(_tmpSkillData.tooltipAlias==_treeSkillListObj.learnedSkillTooltipAlias){originalTooltipData=_tmpSkillData;flag_exist=true;break}}if(flag_exist){setDisplayTooltipDescDiffBySkillIdAndVariationData(skillId,variationData)}else{var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],_treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id==treeId){prevTrainSkillVariationObjArr.splice(i,1)}}skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[skillId];if(prevTrainSkillVariationObjArr.length<=0){originalTooltipData=skillDataArr[0]}else{var lastSelectedAcquisitionSkillVariationObj=prevTrainSkillVariationObjArr[0];originalTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(lastSelectedAcquisitionSkillVariationObj.tooltip_alias,skillDataArr)}if(!originalTooltipData){if(variationData.skill_id!=lastSelectedAcquisitionSkillVariationObj.skill_id){skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[variationData.skill_id];originalTooltipData=skillDataArr[0]}}}targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData);break}break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:switch(slotType){case"":skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var flag_exist=false;var _tmpSkillData;for(var i=0,max=skillDataArr.length;i<max;i++){_tmpSkillData=skillDataArr[i];if(_tmpSkillData.tooltipAlias==_treeSkillListObj.learnedSkillTooltipAlias){originalTooltipData=_tmpSkillData;flag_exist=true;break}}if(flag_exist){targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias]}else{var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],_treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id!=treeId){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){originalTooltipData=skillDataArr[0]}else{var lastSelectedNormalSkillVariationObj=prevTrainSkillVariationObjArr[0];originalTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(lastSelectedNormalSkillVariationObj.tooltip_alias,skillDataArr);if(!originalTooltipData){originalTooltipData=skillDataArr[0]}}targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias]}setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData);break;case nc.bns.training.Model.SLOT_REPLACE:skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[_treeSkillListObj.learnedSkillTooltipAlias];targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData);break;case nc.bns.training.Model.SLOT_ACQUISITION:if(_skillListObj.skill_id!=variationData.skill_id){var flag_exist=false;skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[_skillListObj.skill_id];var checkObj,trainSkillAliasStr;for(var no in variationData.train_skill_alias){trainSkillAliasStr=variationData.train_skill_alias[no];if(!trainSkillAliasStr)continue;for(var j=0,length=skillDataArr.length;j<length;j++){checkObj=skillDataArr[j];if(checkObj.tooltipAlias==trainSkillAliasStr){originalTooltipData=checkObj;flag_exist=true;break}}if(flag_exist)break}if(flag_exist){var _treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],_treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id==treeId){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){originalTooltipData=skillDataArr[0]}else{var lastSelectedAcquisitionSkillVariationObj=prevTrainSkillVariationObjArr[0];originalTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(lastSelectedAcquisitionSkillVariationObj.tooltip_alias,skillDataArr);if(!originalTooltipData){originalTooltipData=skillDataArr[0]}}targetTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(variationData.tooltip_alias,skillDataArr);setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,targetTooltipData.id);if(variationData.skill_id!=targetTooltipData.id){_displaySkillAcquire.displayAcquire(false)}else{displayTooltipQuestLegendByVariationData(variationData)}}else{skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[skillId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],_treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id==treeId){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){originalTooltipData=skillDataArr[0]}else{var flag_exist=false;var variationObj,checkObj;for(var i=0,max=prevTrainSkillVariationObjArr.length;i<max;i++){variationObj=prevTrainSkillVariationObjArr[i];for(var no in variationObj.train_skill_alias){trainSkillAliasStr=variationObj.train_skill_alias[no];if(!trainSkillAliasStr)continue;for(var j=0,length=skillDataArr.length;j<length;j++){checkObj=skillDataArr[j];if(checkObj.tooltipAlias==trainSkillAliasStr){originalTooltipData=checkObj;flag_exist=true;break}}if(flag_exist)break}if(flag_exist)break}if(!flag_exist)originalTooltipData=skillDataArr[0]}targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData)}}else{skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[skillId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],_treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id==treeId){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){originalTooltipData=skillDataArr[0]}else{var flag_exist=false;var variationObj,checkObj;for(var i=0,max=prevTrainSkillVariationObjArr.length;i<max;i++){variationObj=prevTrainSkillVariationObjArr[i];for(var no in variationObj.train_skill_alias){trainSkillAliasStr=variationObj.train_skill_alias[no];if(!trainSkillAliasStr)continue;for(var j=0,length=skillDataArr.length;j<length;j++){checkObj=skillDataArr[j];if(checkObj.tooltipAlias==trainSkillAliasStr){originalTooltipData=checkObj;flag_exist=true;break}}if(flag_exist)break}if(flag_exist)break}if(!flag_exist)originalTooltipData=skillDataArr[0]}targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData)}break}break;case nc.bns.training.Model.SKILL_TYPE_SHARE:switch(slotType){case"":var treeSkillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[_skillListObj.skill_id];if(treeSkillDataArr.length!=skillDataArr.length){skillDataArr=treeSkillDataArr;_treeSkillObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[_treeSkillListObj.learnedSkillTooltipAlias];targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData)}else{_treeSkillObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);originalTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(_treeSkillObj.learnedSkillTooltipAlias,skillDataArr);targetTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(variationData.tooltip_alias,skillDataArr);setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,_skillListObj.skill_id);displayTooltipQuestLegendByVariationData(variationData)}break;case nc.bns.training.Model.SLOT_REPLACE:var treeSkillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[_skillListObj.skill_id];if(treeSkillDataArr.length!=skillDataArr.length){skillDataArr=treeSkillDataArr;_treeSkillObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[_treeSkillListObj.learnedSkillTooltipAlias];targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData)}else{_treeSkillObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);originalTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(_treeSkillObj.learnedSkillTooltipAlias,skillDataArr);targetTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(variationData.tooltip_alias,skillDataArr);setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,_skillListObj.skill_id);displayTooltipQuestLegendByVariationData(variationData)}break;case nc.bns.training.Model.SLOT_ACQUISITION:skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[skillId];_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],_treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id==treeId){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){originalTooltipData=skillDataArr[0]}else{var lastSelectedShareSkillVariationObj=prevTrainSkillVariationObjArr[0];originalTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(lastSelectedShareSkillVariationObj.tooltip_alias,skillDataArr);if(!originalTooltipData){originalTooltipData=skillDataArr[0]}}targetTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[variationData.tooltip_alias];setDisplayTooltipDescDiffByVariationData(originalTooltipData,targetTooltipData,variationData);break}break}}else{_skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(nc.bns.training.Model.lastSelectedSkillListSkillId);switch(_skillListObj.skillType){case"":switch(slotType){case"":setDisplayTooltipDescDiffBySkillIdAndVariationData(treeId,variationData);break;case nc.bns.training.Model.SLOT_REPLACE:setDisplayTooltipDescDiffBySkillIdAndVariationData(treeId,variationData);break;case nc.bns.training.Model.SLOT_ACQUISITION:setDisplayTooltipDescDiffBySkillIdAndVariationData(skillId,variationData);break}break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:switch(slotType){case"":setDisplayTooltipDescDiffBySkillIdAndVariationData(treeId,variationData);break;case nc.bns.training.Model.SLOT_REPLACE:setDisplayTooltipDescDiffBySkillIdAndVariationData(treeId,variationData);break;case nc.bns.training.Model.SLOT_ACQUISITION:var displaySkillDataObj=null;if(_skillListObj.skill_id!=variationData.skill_id){skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[_skillListObj.skill_id];var flag_exist=false;var skillDataObj,trainSkillAliasStr;for(var no in variationData.train_skill_alias){trainSkillAliasStr=variationData.train_skill_alias[no];if(!trainSkillAliasStr)continue;for(var j=0,length=skillDataArr.length;j<length;j++){skillDataObj=skillDataArr[j];if(skillDataObj.tooltipAlias==trainSkillAliasStr){displaySkillDataObj=skillDataObj;flag_exist=true;break}}if(flag_exist)break}if(flag_exist){if(displaySkillDataObj!=skillDataArr[0]){skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[_skillListObj.skill_id];firstSkillObj=skillDataArr[0];originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[getTransformedLv1SlotTooltipAliasStr(firstSkillObj.tooltipAlias)];if(!originalTooltipData){originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[firstSkillObj.tooltipAlias]}targetTooltipData=displaySkillDataObj;setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,_skillListObj.skill_id);displayTooltipQuestLegendByVariationData(variationData)}else{originalTooltipData=skillDataArr[0];targetTooltipData=skillDataArr[0];setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,_skillListObj.skill_id);displayTooltipQuestLegendByVariationData(variationData)}}else{setDisplayTooltipDescDiffBySkillIdAndVariationData(variationData.skill_id,variationData)}}else{setDisplayTooltipDescDiffBySkillIdAndVariationData(skillId,variationData)}break}break;case nc.bns.training.Model.SKILL_TYPE_SHARE:switch(slotType){case"":var treeSkillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeId];skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[nc.bns.training.Model.lastSelectedSkillListSkillId];if(treeSkillDataArr.length!=skillDataArr.length){skillDataArr=treeSkillDataArr;firstSkillObj=skillDataArr[0];originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[getTransformedLv1SlotTooltipAliasStr(firstSkillObj.tooltipAlias)];if(!originalTooltipData){originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[firstSkillObj.tooltipAlias]}targetTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(variationData.tooltip_alias,skillDataArr);if(!targetTooltipData){targetTooltipData=skillDataArr[0]}setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,treeId);displayTooltipQuestLegendByVariationData(variationData)}else{firstSkillObj=skillDataArr[0];originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[getTransformedLv1SlotTooltipAliasStr(firstSkillObj.tooltipAlias)];if(!originalTooltipData){originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[firstSkillObj.tooltipAlias]}targetTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(variationData.tooltip_alias,skillDataArr);if(!targetTooltipData){targetTooltipData=skillDataArr[0]}setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,_skillListObj.skill_id);displayTooltipQuestLegendByVariationData(variationData)}break;case nc.bns.training.Model.SLOT_REPLACE:skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[_skillListObj.skill_id];firstSkillObj=skillDataArr[0];originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[getTransformedLv1SlotTooltipAliasStr(firstSkillObj.tooltipAlias)];if(!originalTooltipData){originalTooltipData=nc.bns.training.Model.SKILL_OBJ_JSON[firstSkillObj.tooltipAlias]}targetTooltipData=getSkillTooltipDataByTreeSkillTooltipAlias(variationData.tooltip_alias,skillDataArr);if(!targetTooltipData){targetTooltipData=skillDataArr[0]}setDisplayTooltipDescDiffBySkillId(originalTooltipData,targetTooltipData,_skillListObj.skill_id);displayTooltipQuestLegendByVariationData(variationData);break;case nc.bns.training.Model.SLOT_ACQUISITION:setDisplayTooltipDescDiffBySkillIdAndVariationData(skillId,variationData);break}break}}};_this.setSkillToolTip=function($skillId){function setFirstSlotStanceAndConditionDescs($skillListObj){if($skillListObj.tooltip_stance_refine){_displaySkillStanceRefine.displaySkillInfo($skillListObj.tooltip_stance_refine);_displaySkillStanceRefine.displayStanceRefine(true)}else{_displaySkillStanceRefine.displayStanceRefine(false)}if($skillListObj.tooltip_condition_refine){_displaySkillUseCondition.displaySkillInfo($skillListObj.tooltip_condition_refine);_displaySkillUseCondition.displayUseCondition(true)}else{_displaySkillUseCondition.displayUseCondition(false)}}function displayTooltipStanceConditionByVariationData($variationData){if($variationData.tooltip_stance_refine){_displaySkillStanceRefine.displaySkillInfo($variationData.tooltip_stance_refine);_displaySkillStanceRefine.displayStanceRefine(true)}else{_displaySkillStanceRefine.displayStanceRefine(false)}if($variationData.tooltip_condition_refine){_displaySkillUseCondition.displaySkillInfo($variationData.tooltip_condition_refine);_displaySkillUseCondition.displayUseCondition(true)}else{_displaySkillUseCondition.displayUseCondition(false)}}function displayTooltipQuestLegendByVariationData($variationData){if($variationData.complete_quest_name_refine){if($variationData.complete_quest_desc_refine){_displaySkillAcquire.setEliteSkillInfo(String($variationData.complete_quest_name_refine),String($variationData.complete_quest_desc_refine))}else{_displaySkillAcquire.setLegendSkillInfo(String($variationData.complete_quest_name_refine))}_displaySkillAcquire.displayAcquire(true)}else{_displaySkillAcquire.displayAcquire(false)}}function setTooltipOptionDescs($skillListObj,$displaySkillObj){_displayTooltipDesc.displayDesc($displaySkillObj);_displaySkillInfo.displaySkillInfo($displaySkillObj);var obj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias($skillListObj.skill_id,String($skillListObj.learnedSkillVariationId),String($skillListObj.learnedSkillAlias));if(!obj)return;if(obj.tooltip_stance_refine){_displaySkillStanceRefine.displaySkillInfo(obj.tooltip_stance_refine);_displaySkillStanceRefine.displayStanceRefine(true)}else{_displaySkillStanceRefine.displayStanceRefine(false)}if(obj.tooltip_condition_refine){_displaySkillUseCondition.displaySkillInfo(obj.tooltip_condition_refine);_displaySkillUseCondition.displayUseCondition(true)}else{_displaySkillUseCondition.displayUseCondition(false)}if(obj.complete_quest_name_refine){if(obj.complete_quest_desc_refine){_displaySkillAcquire.setEliteSkillInfo(String(obj.complete_quest_name_refine),String(obj.complete_quest_desc_refine))}else{_displaySkillAcquire.setLegendSkillInfo(String(obj.complete_quest_name_refine))}_displaySkillAcquire.displayAcquire(true)}else{_displaySkillAcquire.displayAcquire(false)}}var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);var displaySkillObj;var skillDataArr,variationObj;if(skillListObj.tree_id!=skillListObj.skill_id){if(skillListObj.skillType!=nc.bns.training.Model.SKILL_TYPE_NONE){var treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillListObj.tree_id);if(!treeSkillListObj)return;if(treeSkillListObj.learnedSkillTooltipAlias!=""){variationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias(treeSkillListObj.tree_id,treeSkillListObj.learnedSkillVariationId,treeSkillListObj.learnedSkillAlias);switch(skillListObj.skillType){case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:var treeId=skillListObj.tree_id;var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],treeSkillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id==treeId){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[$skillId];displaySkillObj=skillDataArr[0];_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal(variationObj.matrix_name);_displaySkillInfo.displaySkillInfo(displaySkillObj);setFirstSlotStanceAndConditionDescs(skillListObj);_displaySkillAcquire.displayAcquire(false)}else{skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[$skillId];var flag_exist=false;var variationObj,checkObj;for(var i=0,max=prevTrainSkillVariationObjArr.length;i<max;i++){variationObj=prevTrainSkillVariationObjArr[i];for(var no in variationObj.train_skill_alias){trainSkillAliasStr=variationObj.train_skill_alias[no];if(!trainSkillAliasStr)continue;for(var j=0,length=skillDataArr.length;j<length;j++){checkObj=skillDataArr[j];if(checkObj.tooltipAlias==trainSkillAliasStr){displaySkillObj=checkObj;flag_exist=true;break}}if(flag_exist)break}if(flag_exist)break}if(flag_exist){if(displaySkillObj!=skillDataArr[0]){_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal(variationObj.matrix_name);_displaySkillInfo.displaySkillInfo(displaySkillObj);displayTooltipStanceConditionByVariationData(variationObj);if(variationObj.complete_quest_name_refine){if(variationObj.complete_quest_desc_refine){_displaySkillAcquire.setEliteSkillInfo(String(variationObj.complete_quest_name_refine),String(variationObj.complete_quest_desc_refine))}else{_displaySkillAcquire.setLegendSkillInfo(String(variationObj.complete_quest_name_refine))}_displaySkillAcquire.displayAcquire(true)}else{_displaySkillAcquire.displayAcquire(false)}}else{_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal(variationObj.matrix_name);_displaySkillInfo.displaySkillInfo(displaySkillObj);setFirstSlotStanceAndConditionDescs(skillListObj);_displaySkillAcquire.displayAcquire(false)}}else{displaySkillObj=skillDataArr[0];_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal(variationObj.matrix_name);_displaySkillInfo.displaySkillInfo(displaySkillObj);setFirstSlotStanceAndConditionDescs(skillListObj);_displaySkillAcquire.displayAcquire(false)}}break;case nc.bns.training.Model.SKILL_TYPE_SHARE:skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[$skillId];var treeSkillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[treeSkillListObj.tree_id];if(skillDataArr.length!=treeSkillDataArr.length){if(variationObj.skill_id!=skillListObj.skill_id){skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[$skillId];displaySkillObj=skillDataArr[0];_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal(variationObj.matrix_name);_displaySkillInfo.displaySkillInfo(displaySkillObj);setFirstSlotStanceAndConditionDescs(skillListObj);_displaySkillAcquire.displayAcquire(false)}else{if(variationObj){displayTooltipStanceConditionByVariationData(variationObj);displayTooltipQuestLegendByVariationData(variationObj)}}}else{displaySkillObj=getSkillTooltipDataByTreeSkillTooltipAlias(treeSkillListObj.learnedSkillTooltipAlias,skillDataArr);if(!displaySkillObj){displaySkillObj=skillDataArr[0]}setTooltipOptionDescs(skillListObj,displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal(variationObj.matrix_name);var _skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);if(_skillListObj)setFirstSlotStanceAndConditionDescs(_skillListObj);if(variationObj)displayTooltipQuestLegendByVariationData(variationObj)}break}}else{skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[$skillId];displaySkillObj=skillDataArr[0];_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal("");_displaySkillInfo.displaySkillInfo(displaySkillObj);setFirstSlotStanceAndConditionDescs(skillListObj);_displaySkillAcquire.displayAcquire(false)}}else{var noTrainingDisplaySkillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[skillListObj.skill_id];displaySkillObj=noTrainingDisplaySkillDataArr[0];_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal("");_displaySkillInfo.displaySkillInfo(displaySkillObj);setFirstSlotStanceAndConditionDescs(skillListObj);_displaySkillAcquire.displayAcquire(false)}}else{skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[skillListObj.tree_id];var _displaySkillDataObj;if(skillListObj.learnedSkillTooltipAlias!=""){displaySkillObj=nc.bns.training.Model.SKILL_OBJ_JSON[skillListObj.learnedSkillTooltipAlias];variationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias(skillListObj.skill_id,skillListObj.learnedSkillVariationId,skillListObj.learnedSkillAlias);if(skillListObj.skill_id!=displaySkillObj.id){var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[skillListObj.tree_id],skillListObj.learnedSkillAlias);var _prevTrainSkillVariationObj;for(var i=prevTrainSkillVariationObjArr.length-1;i>=0;i--){_prevTrainSkillVariationObj=prevTrainSkillVariationObjArr[i];if(_prevTrainSkillVariationObj.skill_id!=skillListObj.tree_id){prevTrainSkillVariationObjArr.splice(i,1)}}if(prevTrainSkillVariationObjArr.length<=0){_displaySkillDataObj=skillDataArr[0]}else{var lastSelectedNormalSkillVariationObj=prevTrainSkillVariationObjArr[0];_displaySkillDataObj=getSkillTooltipDataByTreeSkillTooltipAlias(lastSelectedNormalSkillVariationObj.tooltip_alias,skillDataArr);if(!_displaySkillDataObj){_displaySkillDataObj=skillDataArr[0]}}}else{_displaySkillDataObj=getSkillTooltipDataByTreeSkillTooltipAlias(skillListObj.learnedSkillTooltipAlias,skillDataArr)}setTooltipOptionDescs(skillListObj,_displaySkillDataObj);_displayTooltipDesc.setSkillMatrixByExternal(variationObj.matrix_name)}else{skillDataArr=nc.bns.training.Model.COLLECTION_ARRAY_HAS_SKILL_OBJ_JSON_BY_SKILL_ID[$skillId];displaySkillObj=skillDataArr[0];_displayTooltipDesc.displayDesc(displaySkillObj);_displayTooltipDesc.setSkillMatrixByExternal("");_displaySkillInfo.displaySkillInfo(displaySkillObj);setFirstSlotStanceAndConditionDescs(skillListObj);_displaySkillAcquire.displayAcquire(false)}}};var _container=_options.container;var _displayTooltipDesc;var _displaySkillInfo;var _displaySkillStanceRefine;var _displaySkillUseCondition;var _displaySkillAcquire;init();function init(){var toolTipElementStr='<div class="tooltip"><section></section></div>';$(_container).append(toolTipElementStr);var _$sectionElement=$(".tooltip > section",_container);var displaySkillPointHealElementStr='<p class="consumed_sp"></p>';_$sectionElement.append(displaySkillPointHealElementStr);var skillDiffDescElementStr='<dl>'+'<dt class="name">スキル名<span class="matrix"></span></dt>'+'<dd class="thumb"><img src="" class="icon"><span class="frame"></span></dd>'+'<dd class="main_info"><p class="main_info1"></p><p class="main_info2"></p></dd>'+'<dd class="sub_info"></dd>'+'</dl>';_$sectionElement.append(skillDiffDescElementStr);var skillInfoDescElementStr='<div class="skill_info">'+'<ul>'+'<li class="meter"><em>거리</em><div>使用者中心</div></li>'+'<li class="range_0"><em>영역</em><div>3m</div></li>'+'<li class="casting_time"><em>詠唱</em><div>すぐに</div></li>'+'<li class="recycle_time"><em>再使用</em><div>24秒</div></li>'+'</ul></div>';_$sectionElement.append(skillInfoDescElementStr);var skillUseConditionElementStr='<div class="skill_acquire">'+'<dl><dt>使用条件</dt><dd>'+'</dd></dl>'+'</div>';_$sectionElement.append(skillUseConditionElementStr);var skillUseStanceRefineElementStr='<div class="skill_acquire">'+'<dl><dt>態勢変更</dt><dd>'+'</dd></dl>'+'</div>';_$sectionElement.append(skillUseStanceRefineElementStr);var skillAcquireElementStr='<div class="skill_acquire">'+'<strong class="elit_skill_name"></strong>'+'<dl><dt>獲得</dt><dd></dd></dl>'+'</div>';_$sectionElement.append(skillAcquireElementStr);var skillInfoFooterElementStr='<footer></footer>';_$sectionElement.append(skillInfoFooterElementStr);_displayTooltipDesc=new nc.bns.training.tooltip.DisplayTooltipDesc({container:_$sectionElement});_displaySkillInfo=new nc.bns.training.tooltip.DisplaySkillInfo({container:$(".skill_info",_container).get(0)});_displaySkillUseCondition=new nc.bns.training.tooltip.DisplaySkillUseCondition({container:$(".skill_acquire",_container).get(0)});_displaySkillStanceRefine=new nc.bns.training.tooltip.DisplaySkillStanceRefine({container:$(".skill_acquire",_container).get(1)});_displaySkillAcquire=new nc.bns.training.tooltip.DisplaySkillAcquire({container:$(".skill_acquire",_container).get(2)})}function getTransformedLv1SlotTooltipAliasStr($tooltipAliasStr){var tooltipSplitStrArr=$tooltipAliasStr.split("_");var str,levelNoIndex=-1;for(var i=0,max=tooltipSplitStrArr.length;i<max;i++){str=tooltipSplitStrArr[i];if(str.search(/^[0-9]+/)>=0){levelNoIndex=i;break}if(str.search(/^LV[0-9]+/i)>=0){levelNoIndex=i;break}}if(levelNoIndex>=0){tooltipSplitStrArr[levelNoIndex]=ORIGINAL_LEVEL_STR;var joinStr=tooltipSplitStrArr.join("_");return joinStr}return""}function getSkillTooltipDataByTreeSkillTooltipAlias($treeSkillListObjLearnedSkillTooltipAlias,$skillDataArr){var _tooltipData=null;var treeSkillNoStr=$treeSkillListObjLearnedSkillTooltipAlias.replace(/\D*/g,'');var tmpTooltipData,tmpTooltipAlias;for(var i=0,max=$skillDataArr.length;i<max;i++){tmpTooltipData=$skillDataArr[i];tmpTooltipAlias=tmpTooltipData.tooltipAlias.replace(/\D*/g,'');if(tmpTooltipAlias==treeSkillNoStr){_tooltipData=tmpTooltipData;break}}return _tooltipData}return _this};nc.bns.training.tooltip.DisplaySkillStanceRefine=function(_options){var _this=this;_this.destroy=function(){};_this.displayStanceRefine=function($flag){if($flag){$(_container).css("display","block")}else{$(_container).css("display","none")}};_this.displaySkillInfo=function($str){_$stanceContents.html($str)};var _container=_options.container;var _$stanceContents;init();function init(){_$stanceContents=$("> dl > dd",_container)}return _this};nc.bns.training.tooltip.DisplaySkillUseCondition=function(_options){var _this=this;_this.destroy=function(){};_this.displayUseCondition=function($flag){if($flag){$(_container).css("display","block")}else{$(_container).css("display","none")}};_this.displaySkillInfo=function($str){_$conditionContents.html($str)};var _container=_options.container;var _$conditionContents;init();function init(){_$conditionContents=$("> dl > dd",_container)}return _this};nc.bns.training.tooltip.DisplaySkillAcquire=function(_options){var _this=this;_this.destroy=function(){};_this.displayAcquire=function($flag){if($flag){$(_container).css("display","block")}else{$(_container).css("display","none")}};_this.setEliteSkillInfo=function($questNameRefineStr,$questDescRefineStr){_$titleElement.text(String($questNameRefineStr));_$acquireTitle.text(TITLE_ACQUIRE);var descRefineStr=$questDescRefineStr.split('&#92;').join('');_$acquireContents.empty();_$acquireContents.html(descRefineStr)};_this.setLegendSkillInfo=function($questNameRefineStr){_$titleElement.text(String($questNameRefineStr));_$acquireTitle.text("");_$acquireContents.empty()};var TITLE_ACQUIRE="獲得";var _container=_options.container;var _$titleElement;var _$acquireTitle;var _$acquireContents;init();function init(){_$titleElement=$(".elit_skill_name",_container);_$acquireTitle=$("> dl > dt",_container);_$acquireContents=$("> dl > dd",_container)}return _this};nc.bns.training.tooltip.DisplaySkillInfo=function(_options){var _this=this;_this.destroy=function(){};_this.displaySkillInfoDiff=function($originalSkillInfo,$targetSkillInfo){var originalSkillInfo=$originalSkillInfo["skill_info"];var originalInfoStrArr=[];if(originalSkillInfo){for(var key in originalSkillInfo){originalInfoStrArr.push(originalSkillInfo[key])}}var targetSkillInfo=$targetSkillInfo["skill_info"];var targetInfoStrArr=[];if(targetSkillInfo){for(var key in targetSkillInfo){targetInfoStrArr.push(targetSkillInfo[key])}}if(originalInfoStrArr.length<=0){if(targetInfoStrArr.length<=0){}else{}}else{if(targetInfoStrArr.length<=0){}else{if(String(originalInfoStrArr[0].value)!=String(targetInfoStrArr[0].value)||String(originalInfoStrArr[0].type)!=String(targetInfoStrArr[0].type)){var diffElementStr='<p class="range">'+getReplaceDiffDistanceDesc(String(originalInfoStrArr[0].value))+'</p>'+'<p class="diff_arrow">▼</p>'+'<p class="ui_skill_mod">'+getReplaceDiffDistanceDesc(String(targetInfoStrArr[0].value))+'</p>';setDistance(diffElementStr);_$distanceElement.addClass("diff")}else{setDistance(String(targetInfoStrArr[0].value))}if(String(originalInfoStrArr[1].value)!=String(targetInfoStrArr[1].value)||String(originalInfoStrArr[1].type)!=String(targetInfoStrArr[1].type)){var originalInfoStr=String(originalInfoStrArr[1].value);var targetInfoStr=String(targetInfoStrArr[1].value);if(getFlagZeroMeterOrTargetStr(originalInfoStr)&&getFlagZeroMeterOrTargetStr(targetInfoStr)){setRange(targetInfoStrArr[1]);_$rangeDetailElement.removeClass("diff")}else{_$rangeElement.removeClass();_$rangeDetailElement.addClass("diff");if(getFlagZeroMeterOrTargetStr(originalInfoStr))originalInfoStr=TARGET_STR;if(getFlagZeroMeterOrTargetStr(targetInfoStr))targetInfoStr=TARGET_STR;var diffElementStr='<p class="ui_skill_org">'+originalInfoStr+'</p>'+'<p class="diff_arrow">▼</p>'+'<p class="ui_skill_mod">'+targetInfoStr+'</p>';_$rangeDetailElement.html(diffElementStr);var originalInfoTypeStr=String(originalInfoStrArr[1].type);var targetInfoTypeStr=String(targetInfoStrArr[1].type);var _originalRangeElement=$(".ui_skill_org",_$rangeDetailElement).get(0);var _targetRangeElement=$(".ui_skill_mod",_$rangeDetailElement).get(0);if(originalInfoTypeStr!=targetInfoTypeStr){if(originalInfoStr!=TARGET_STR){$(_originalRangeElement).addClass("range");$(_originalRangeElement).addClass(originalInfoStrArr[1].type);$(_targetRangeElement).addClass("range");$(_targetRangeElement).addClass(targetInfoStrArr[1].type)}else{_$rangeElement.removeClass().addClass(targetInfoTypeStr)}}else{_$rangeElement.removeClass().addClass(originalInfoTypeStr)}}}else{setRange(targetInfoStrArr[1]);_$rangeDetailElement.removeClass("diff")}if(String(originalInfoStrArr[2].value)!=String(targetInfoStrArr[2].value)||String(originalInfoStrArr[2].type)!=String(targetInfoStrArr[2].type)){var diffElementStr='<p class="range">'+String(originalInfoStrArr[2].value)+'</p>'+'<p class="diff_arrow">▼</p>'+'<p class="ui_skill_mod">'+String(targetInfoStrArr[2].value)+'</p>';setCastingTime(diffElementStr);_$castingTimeElement.addClass("diff")}else{_$castingTimeElement.removeClass("diff");setCastingTime(String(targetInfoStrArr[2].value))}if(String(originalInfoStrArr[3].value)!=String(targetInfoStrArr[3].value)||String(originalInfoStrArr[3].type)!=String(targetInfoStrArr[3].type)){var diffElementStr='<p class="range">'+String(originalInfoStrArr[3].value)+'</p>'+'<p class="diff_arrow">▼</p>'+'<p class="ui_skill_mod">'+String(targetInfoStrArr[3].value)+'</p>';setRecycleTime(diffElementStr);_$recycleTimeElement.addClass("diff")}else{setRecycleTime(String(targetInfoStrArr[3].value))}}}};_this.displaySkillInfo=function($skillInfo){var skillInfo=$skillInfo["skill_info"];var infoStrArr=[];for(var key in skillInfo){infoStrArr.push(skillInfo[key])}if(infoStrArr.length<=0){displayInfoContainer(false)}else{setDistance(String(infoStrArr[0].value));setRange(infoStrArr[1]);setCastingTime(String(infoStrArr[2].value));setRecycleTime(String(infoStrArr[3].value));displayInfoContainer(true)}};var DISTANCE_REPLACE_DESC_OBJ_ARR={"詠唱者 中心":{"value":"詠唱者<br/>中心"}};var DIFF_DISTANCE_REPLACE_DESC_OBJ_ARR={"詠唱者 中心":{"value":"詠唱者中心"}};var ZERO_METER_STR="0m";var TARGET_STR="대상";var _container=_options.container;var _$distanceElement;var _$rangeElement;var _$rangeDetailElement;var _$castingTimeElement;var _$recycleTimeElement;init();function init(){_$distanceElement=$(".meter > div",_container);_$rangeElement=$(".range_0",_container);_$rangeDetailElement=$(".range_0 > div",_container);_$castingTimeElement=$(".casting_time > div",_container);_$recycleTimeElement=$(".recycle_time > div",_container)}function getFlagZeroMeterOrTargetStr($str){if($str==ZERO_METER_STR)return true;if($str==TARGET_STR)return true;return false}function displayInfoContainer($flag){if($flag){_container.style.display="block"}else{_container.style.display="none"}}function setDistance($infoStr){var str=($infoStr)?$infoStr:"";var replaceHtmlStr=getReplaceDistanceDesc(str);_$distanceElement.removeClass();_$distanceElement.html(replaceHtmlStr)}function setRange($infoObj){var type=$infoObj.type;var str=($infoObj.value)?$infoObj.value:"";if(getFlagZeroMeterOrTargetStr(str)){str=TARGET_STR;_$rangeElement.removeClass()}else{_$rangeElement.removeClass().addClass(type)}_$rangeDetailElement.removeClass();$("div",_$rangeElement).text(str)}function setCastingTime($infoStr){var str=($infoStr)?$infoStr:"";_$castingTimeElement.removeClass();_$castingTimeElement.html(str)}function setRecycleTime($infoStr){var str=($infoStr)?$infoStr:"";_$recycleTimeElement.removeClass();_$recycleTimeElement.html(str)}function getReplaceDiffDistanceDesc($text){var _title=$text;for(var text in DIFF_DISTANCE_REPLACE_DESC_OBJ_ARR){if(text==_title){_title=DIFF_DISTANCE_REPLACE_DESC_OBJ_ARR[text].value;break}}return _title}function getReplaceDistanceDesc($text){var _title=$text;for(var text in DISTANCE_REPLACE_DESC_OBJ_ARR){if(text==_title){_title=DISTANCE_REPLACE_DESC_OBJ_ARR[text].value;break}}return _title}return _this};nc.bns.training.tooltip.DisplayTooltipDesc=function(_options){var _this=this;_this.destroy=function(){};_this.setAllInfoByExternal=function($mainInfo1HtmlStr,$mainInfo2HtmlStr,$subInfoHtmlStr){setMainInfo1($mainInfo1HtmlStr);setMainInfo2($mainInfo2HtmlStr);setSubInfo($subInfoHtmlStr)};_this.setSkillNameByExternal=function($skillInfoObj){setNameDesc($skillInfoObj.name)};_this.setSkillMatrixByExternal=function($str){setMatrixDesc($str)};_this.setSkillThumbnailByExternal=function($skillInfoObj){setThumbnail(nc.bns.training.Model.SKILL_IMG_URL_FRONT+$skillInfoObj.icon)};_this.setHealPointChangeDescByExternal=function($originalSkillInfoObj,$targetSkillInfoObj){setHealPointChangeDesc($originalSkillInfoObj,$targetSkillInfoObj)};_this.displayDesc=function($skillInfoObj){setHealPointDesc($skillInfoObj);setNameDesc($skillInfoObj.name);setThumbnail(nc.bns.training.Model.SKILL_IMG_URL_FRONT+$skillInfoObj.icon);setMainInfo1($skillInfoObj.main_info1);setMainInfo2($skillInfoObj.main_info2);setSubInfo($skillInfoObj.sub_info)};var DESC_HEAL_SKILL_POINT="マナ回復 ";var DESC_CONSUME_SKILL_POINT="マナ消費 ";var DESC_CHANGE_ARROW=" ▶ ";var _container=_options.container;var _$healPointDescElement;var _nameElement;var _$matrixElement;var _thumbnailElement;var _$mainInfo_1Element;var _$mainInfo_2Element;var _$subInfoElement;init();function init(){_$healPointDescElement=$(".consumed_sp",_container);var _$nameElement=$(".name",_container);_nameElement=_$nameElement.contents().eq(0).get(0);_$matrixElement=$(".matrix",_$nameElement);_thumbnailElement=$(".thumb > img",_container).get(0);_$mainInfo_1Element=$(".main_info1",_container);_$mainInfo_2Element=$(".main_info2",_container);_$subInfoElement=$(".sub_info",_container)}function setHealPointChangeDesc($originalSkillInfoObj,$targetSkillInfoObj){_$healPointDescElement.text("");var originalHealValue=parseInt($originalSkillInfoObj.ui_sp_heal_value);var targetHealValue=parseInt($targetSkillInfoObj.ui_sp_heal_value);var originalConsumeValue=parseInt($originalSkillInfoObj.consume_sp);var targetConsumeValue=parseInt($targetSkillInfoObj.consume_sp);var originalHealPointType="NONE";if($originalSkillInfoObj.ui_sp_heal_value!=null){if(parseInt($originalSkillInfoObj.ui_sp_heal_value)>0){originalHealPointType="HEAL"}else{originalHealPointType="HEAL"}}if($originalSkillInfoObj.consume_sp!=null){if(parseInt($originalSkillInfoObj.consume_sp)>0){originalHealPointType="CONSUME"}else{originalHealPointType="CONSUME"}}var targetHealPointType="NONE";var targetDesc="";if($targetSkillInfoObj.ui_sp_heal_value!=null){if(parseInt($targetSkillInfoObj.ui_sp_heal_value)>0){targetDesc=DESC_HEAL_SKILL_POINT+$targetSkillInfoObj.ui_sp_heal_value;targetHealPointType="HEAL"}else{targetHealPointType="HEAL"}}if($targetSkillInfoObj.consume_sp!=null){if(parseInt($targetSkillInfoObj.consume_sp)>0){targetDesc=DESC_CONSUME_SKILL_POINT+$targetSkillInfoObj.consume_sp;targetHealPointType="CONSUME"}else{targetHealPointType="CONSUME"}}if(originalHealValue<=0&&originalConsumeValue>0)originalHealPointType="CONSUME";if(originalHealValue>0&&originalConsumeValue<=0)originalHealPointType="HEAL";if(targetHealValue<=0&&targetConsumeValue>0)targetHealPointType="CONSUME";if(targetHealValue>0&&targetConsumeValue<=0)targetHealPointType="HEAL";var desc="";switch(originalHealPointType){case"NONE":switch(targetHealPointType){case"HEAL":desc=DESC_HEAL_SKILL_POINT+targetHealValue;break;case"CONSUME":desc=DESC_CONSUME_SKILL_POINT+targetConsumeValue;break;case"NONE":desc="";break}break;case"HEAL":switch(targetHealPointType){case"HEAL":if(originalHealValue!=targetHealValue){desc=DESC_HEAL_SKILL_POINT+originalHealValue+DESC_CHANGE_ARROW+targetHealValue}else{if(targetHealValue<=0){desc=""}else{desc=DESC_HEAL_SKILL_POINT+targetHealValue}}break;case"CONSUME":desc=DESC_HEAL_SKILL_POINT+originalHealValue+DESC_CHANGE_ARROW+DESC_CONSUME_SKILL_POINT+targetConsumeValue;break;case"NONE":desc=DESC_HEAL_SKILL_POINT+originalHealValue+DESC_CHANGE_ARROW+"0";break}break;case"CONSUME":switch(targetHealPointType){case"HEAL":desc=DESC_CONSUME_SKILL_POINT+originalConsumeValue+DESC_CHANGE_ARROW+DESC_HEAL_SKILL_POINT+targetHealValue;break;case"CONSUME":if(originalConsumeValue!=targetConsumeValue){desc=DESC_CONSUME_SKILL_POINT+originalConsumeValue+DESC_CHANGE_ARROW+targetConsumeValue}else{if(targetConsumeValue<=0){desc=""}else{desc=DESC_CONSUME_SKILL_POINT+targetConsumeValue}}break;case"NONE":desc=DESC_CONSUME_SKILL_POINT+originalConsumeValue+DESC_CHANGE_ARROW+"0";break}break}_$healPointDescElement.text(desc)}function setHealPointDesc($skillInfoObj){_$healPointDescElement.text("");if($skillInfoObj.ui_sp_heal_value!=null){if(parseInt($skillInfoObj.ui_sp_heal_value)>0){_$healPointDescElement.text(DESC_HEAL_SKILL_POINT+$skillInfoObj.ui_sp_heal_value);return}else{_$healPointDescElement.text("")}}if($skillInfoObj.consume_sp!=null){if(parseInt($skillInfoObj.consume_sp)>0){_$healPointDescElement.text(DESC_CONSUME_SKILL_POINT+$skillInfoObj.consume_sp);return}else{_$healPointDescElement.text("")}}}function setNameDesc($str){var str=($str)?$str:"";_nameElement.nodeValue=str}function setMatrixDesc($str){var str=($str)?$str:"";_$matrixElement.text(str)}function setThumbnail($thumbnailPath){var str=($thumbnailPath)?$thumbnailPath:"";_thumbnailElement.src=str}function setMainInfo1($infoStr){var str=($infoStr)?$infoStr:"";_$mainInfo_1Element.html(str)}function setMainInfo2($infoStr){var str=($infoStr)?$infoStr:"";_$mainInfo_2Element.html(str)}function setSubInfo($infoStr){var str=($infoStr)?$infoStr:"";_$subInfoElement.html(str)}return _this};nc.bns.training.tree.Contents=function(_options){var _this=this;_this.destroy=function(){if(_skillTree){$(_skillTree).unbind(nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillTreeEventHandler);$(_skillTree).unbind(nc.bns.training.tree.SkillTree.CANCEL_SKILL_POINT,skillTreeEventHandler);_skillTree.destroy();_skillTree=null}};_this.displayNoSearchedSkillDescriptionByExternal=function(){_skillTree.emptySkillTree();_skillTree.displayNoSearchedSkillDescription()};_this.resetSkillTreeBySkillId=function($skillId){resetSkillTree($skillId)};_this.setSkillTree=function($skillId){setSkillTree($skillId)};_this.setTreeIdSkillTree=function($treeId){setTreeIdSkillTree($treeId)};_this.displaySkillPointConsumedByExternal=function($skillPointConsumedStr){displaySkillPointConsumed($skillPointConsumedStr)};_this.displaySkillPointTotalByExternal=function($skillPointTotalStr){displaySkillPointTotal($skillPointTotalStr)};var _container=_options.container;var objArr=_options.objArr;var _skillTree=null;var _$consumedTpElement=null;var _$totalTpElement=null;init();function init(){var treeTpElementStr='<div class="tree_tp">'+'<span class="consumed_tp">'+nc.bns.training.Model.skillPointConsumed+'</span> / <span class="total_tp">'+nc.bns.training.Model.skillPointTotal+'</span></div>'+'<p class="only"><em></em>は修練がありません.</p>';$(_container).append(treeTpElementStr);_$consumedTpElement=$(".consumed_tp",_container);_$totalTpElement=$(".total_tp",_container);var _skillTreeContainer=document.createElement("div");$(_container).append(_skillTreeContainer);var _displayNoTrainingContainer=$(".only").get(0);_skillTree=new nc.bns.training.tree.SkillTree({container:_skillTreeContainer,displayNoTrainingContainer:_displayNoTrainingContainer});$(_skillTree).bind(nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillTreeEventHandler);$(_skillTree).bind(nc.bns.training.tree.SkillTree.CANCEL_SKILL_POINT,skillTreeEventHandler);$(_skillTree).bind(nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,skillTreeEventHandler);$(_skillTree).bind(nc.bns.training.tree.SkillTree.MOUSEOUT_SLOT_ITEM,skillTreeEventHandler)}function skillTreeEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();var skillId,treeId,prevTrainSkillIdArr,skillType,slotType,switchSkillData;switch($evt.type){case nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT:skillId=$evt.skillId;treeId=$evt.treeId;prevTrainSkillIdArr=$evt.prevTrainSkillIdArr;skillType=$evt.skillType;slotType=$evt.slotType;swtichSkillData=$evt.switchSkillData;$(_this).trigger({type:nc.bns.training.tree.Contents.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:skillType,slotType:slotType,switchSkillData:swtichSkillData});break;case nc.bns.training.tree.SkillTree.CANCEL_SKILL_POINT:$(_this).trigger({type:nc.bns.training.tree.Contents.CANCEL_SKILL_POINT,controlScrollContainerPosYSkillId:$evt.controlScrollContainerPosYSkillId,flag_changeSkillName:$evt.flag_changeSkillName});break;case nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM:$(_this).trigger({type:nc.bns.training.tree.Contents.MOUSEOVER_SLOT,variationData:$evt.variationData,skillType:$evt.skillType,slotType:$evt.slotType});break;case nc.bns.training.tree.SkillTree.MOUSEOUT_SLOT_ITEM:$(_this).trigger({type:nc.bns.training.tree.Contents.MOUSEOUT_SLOT,variationData:$evt.variationData});break}}function displaySkillPointConsumed($skillPointConsumedStr){if(_$consumedTpElement)_$consumedTpElement.text($skillPointConsumedStr)}function displaySkillPointTotal($skillPointTotalStr){if(_$totalTpElement)_$totalTpElement.text($skillPointTotalStr)}function setTreeIdSkillTree($treeId){switch(nc.bns.training.Model.lastSelectedSkillType){case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:var skillSlotObj=nc.bns.training.Model.SLOT_OBJ_JSON[$treeId];_skillTree.resetSkillTree(skillSlotObj,$treeId);break;case nc.bns.training.Model.SKILL_TYPE_SHARE:var skillSlotObj=nc.bns.training.Model.SLOT_OBJ_JSON[$treeId];_skillTree.resetSkillTree(skillSlotObj,$treeId);break}}function setSkillTree($skillId){var skillSlotObj=nc.bns.training.Model.SLOT_OBJ_JSON[$skillId];if(skillSlotObj){_skillTree.setSkillTree(skillSlotObj,$skillId)}else{_skillTree.emptySkillTree();var skillName="",_tmpObj;for(var i=0,max=objArr.length;i<max;i++){tmpObj=objArr[i];if(tmpObj.skill_id==$skillId){skillName=tmpObj["name2_refine"];break}}_skillTree.displayNoSkillTreeDescription(skillName,$skillId)}}function resetSkillTree($skillId){var skillSlotObj=nc.bns.training.Model.SLOT_OBJ_JSON[$skillId];if(skillSlotObj){_skillTree.resetSkillTree(skillSlotObj,$skillId)}else{_skillTree.emptySkillTree();var skillName="",_tmpObj;for(var i=0,max=objArr.length;i<max;i++){tmpObj=objArr[i];if(tmpObj.skill_id==$skillId){skillName=tmpObj["name2_refine"];break}}_skillTree.displayNoSkillTreeDescription(skillName,$skillId)}}return _this};nc.bns.training.tree.Contents.CONSUME_SKILL_POINT="CONSUME_SKILL_POINT";nc.bns.training.tree.Contents.CANCEL_SKILL_POINT="CANCEL_SKILL_POINT";nc.bns.training.tree.Contents.MOUSEOVER_SLOT="MOUSEOVER_SLOT";nc.bns.training.tree.Contents.MOUSEOUT_SLOT="MOUSEOUT_SLOT";nc.bns.training.tree.SkillTree=function(_options){var _this=this;_this.destroy=function(){};_this.resetSkillTree=function($slotObj,$skillId){displayNoTrainingDesc(false);removeSkillTree();switchSkillTree($slotObj,$skillId);skillId=String($skillId)};_this.setSkillTree=function($slotObj,$skillId){if(skillId==String($skillId))return;displayNoTrainingDesc(false);removeSkillTree();switchSkillTree($slotObj,$skillId);skillId=String($skillId)};_this.emptySkillTree=function(){$(_container).empty();$(_container).removeClass()};_this.displayNoSkillTreeDescription=function(_skillNameStr,$skillId){removeSkillTree();skillId=$skillId;setNoTrainingDesc(_skillNameStr);displayNoTrainingDesc(true)};_this.displayNoSearchedSkillDescription=function(){removeSkillTree();skillId="";setNoSearchedTrainingDesc();displayNoTrainingDesc(true)};var FIRST_ITEM_SLOT_NO=11;var _container=_options.container;var _displayNoTrainingContainer=_options.displayNoTrainingContainer;var _$displayNoTrainingTitle=$("em",_displayNoTrainingContainer);var skillId="";var _arrowManager;var skillSlotItemArr=[];init();function init(){displayNoTrainingDesc(false)}function displayNoTrainingDesc(_flag){if(_flag){$(_displayNoTrainingContainer).css("display","block")}else{$(_displayNoTrainingContainer).css("display","none")}}function setNoSearchedTrainingDesc(){if(!_$displayNoTrainingTitle)return;_$displayNoTrainingTitle.text("");var _title=_$displayNoTrainingTitle.get(0);var _descElement=_title.nextSibling;_descElement.nodeValue=nc.bns.training.Model.NO_SEARCHED_TRAINING_DESC}function setNoTrainingDesc(_str){if(!_$displayNoTrainingTitle)return;_$displayNoTrainingTitle.text(_str);var postPositionStr=nc.bns.training.Model.NO_TRAINING_DESC.charAt(0);var fixedPostPositionStr=nc.bns.training.util.StringUtil.getFixedPostPositionStr(_str,postPositionStr);var _title=_$displayNoTrainingTitle.get(0);var _descElement=_title.nextSibling;var descStr=nc.bns.training.Model.NO_SEARCHED_TRAINING_DESC;var fixedDescStr=fixedPostPositionStr+" "+descStr;_descElement.nodeValue=fixedDescStr}function removeSkillTree(){$(_container).empty();$(_container).removeClass();if(_arrowManager){_arrowManager.destroy();_arrowManager=null}removeSkillSlotItems();skillSlotItemArr=[]}function removeSkillSlotItems(){var _tmpSkillSlotItem;for(var i=0,max=skillSlotItemArr.length;i<max;i++){_tmpSkillSlotItem=skillSlotItemArr[i];unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler);_tmpSkillSlotItem.destroy()}skillSlotItemArr=[]}function switchSkillTree($slotObj,$skillId){var skillSlotNoArr=nc.bns.training.util.ObjectUtil.getElementKeyNameArr($slotObj);var columnNoArr=[],rowNoArr=[],tmpNoStr;for(var i=0,max=skillSlotNoArr.length;i<max;i++){tmpNo=String(skillSlotNoArr[i]);columnNoArr.push(parseInt(tmpNo.charAt(0)));rowNoArr.push(parseInt(tmpNo.charAt(1)))}var columnNumMax=nc.bns.training.util.ArrayUtil.getMaxNumberByArr(columnNoArr);var rowNumMax=nc.bns.training.util.ArrayUtil.getMaxNumberByArr(rowNoArr);$(_container).addClass("tree_cols"+rowNumMax);var arrowContainerStr='<div class="tree_arrow"></div>';$(_container).append(arrowContainerStr);_arrowManager=nc.bns.training.tree.ArrowManager({container:$(".tree_arrow",_container).get(0),data:$slotObj});removeSkillSlotItems();skillSlotItemArr=[];var _skillSlotItem,skillSlotNo,_skillSlotElement;for(var i=0,max=skillSlotNoArr.length;i<max;i++){skillSlotNo=skillSlotNoArr[i];_skillSlotElement=document.createElement("div");$(_skillSlotElement).addClass("slot_"+skillSlotNo);$(_container).append(_skillSlotElement);_skillSlotItem=new nc.bns.training.tree.SkillSlotItem({container:_skillSlotElement,slotNo:skillSlotNo,data:$slotObj[skillSlotNo]});$(_skillSlotItem).bind(nc.bns.training.tree.SkillSlotItem.MOUSEOVER_SKILL_SLOT_ITEM,skillSlotItemDiffMouseEventHandler);$(_skillSlotItem).bind(nc.bns.training.tree.SkillSlotItem.MOUSEOUT_SKILL_SLOT_ITEM,skillSlotItemDiffMouseEventHandler);skillSlotItemArr.push(_skillSlotItem)}var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);if(skillListObj){if(skillListObj.learnedSkillVariationId!=""){if(getFlagRemainedSkillPoint()){var tmpDataObj,tmpVariationObj;for(var slotNo in $slotObj){tmpDataObj=$slotObj[slotNo];for(var variationKey in tmpDataObj){tmpVariationObj=tmpDataObj[variationKey];if(skillListObj.learnedSkillAlias!=tmpVariationObj.alias)continue;if(skillListObj.learnedSkillVariationId!=tmpVariationObj.variation_id)continue;var _lastLearnedSkillSlotItem=getSkillSlotItemBySlotNo(slotNo);var connectionArrTotal=_arrowManager.getConnectionArrTotal();var _tmpSkillSlotItem,tmpArr,tmpSkillSlotNo,flag_existLastSlotNoInArr=false;for(var i=0,max=connectionArrTotal.length;i<max;i++){tmpArr=connectionArrTotal[i];var lastSlotNoIndex=nc.bns.training.util.ArrayUtil.indexOf(tmpArr,_lastLearnedSkillSlotItem.getSlotNo());flag_existLastSlotNoInArr=(lastSlotNoIndex>=0)?true:false;if(flag_existLastSlotNoInArr){}else{for(var k=0,tmpArrLength=tmpArr.length;k<tmpArrLength;k++){tmpSkillSlotNo=tmpArr[k];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(tmpSkillSlotNo);if(_tmpSkillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_EXCLUSIVE)}else{_tmpSkillSlotItem.setMouseInteraction(false)}}}}var arrowInfoObjArr=_arrowManager.activateArrowsFromRootToSlotAndGetArrowInfoObj(slotNo);if(parseInt(variationKey)>=parseInt(tmpVariationObj.max_variation_level)){if(nc.bns.training.Model.editable)_arrowManager.activateArrowsFromSlotToChildSlots(slotNo);var nextSlotNoArr=_arrowManager.getNextSkillItemsBySelectedSlotNo(slotNo);var _skillSlotItem;for(var i=0,max=skillSlotItemArr.length;i<max;i++){_skillSlotItem=skillSlotItemArr[i];for(var j=0,nextSlotNoArrLength=nextSlotNoArr.length;j<nextSlotNoArrLength;j++){if(_skillSlotItem.getSlotNo()!=nextSlotNoArr[j])continue;if(_skillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){if(nc.bns.training.Model.editable)_skillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_PLUS);bindSkillSlotItemEventHandler(_skillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler)}else{_skillSlotItem.setMouseInteraction(false)}}}_lastLearnedSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE);bindSkillSlotItemEventHandler(_lastLearnedSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler)}else{_lastLearnedSkillSlotItem.setCurrentVariationStatus(parseInt(variationKey));_lastLearnedSkillSlotItem.displayVariationStatus(variationKey);_lastLearnedSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_PLUS_STEP);bindSkillSlotItemEventHandler(_lastLearnedSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler);bindSkillSlotItemEventHandler(_lastLearnedSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler)}var arrowInfoObj,_tmpSkillSlotItem;for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(arrowInfoObj.prevTrainSlotNo);_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE)}}}}else{var tmpDataObj,tmpVariationObj;for(var slotNo in $slotObj){tmpDataObj=$slotObj[slotNo];for(var variationKey in tmpDataObj){tmpVariationObj=tmpDataObj[variationKey];if(skillListObj.learnedSkillAlias!=tmpVariationObj.alias)continue;if(skillListObj.learnedSkillVariationId!=tmpVariationObj.variation_id)continue;var _lastLearnedSkillSlotItem=getSkillSlotItemBySlotNo(slotNo);var connectionArrTotal=_arrowManager.getConnectionArrTotal();var _tmpSkillSlotItem,tmpArr,tmpSkillSlotNo,flag_existLastSlotNoInArr=false;for(var i=0,max=connectionArrTotal.length;i<max;i++){tmpArr=connectionArrTotal[i];var lastSlotNoIndex=nc.bns.training.util.ArrayUtil.indexOf(tmpArr,_lastLearnedSkillSlotItem.getSlotNo());flag_existLastSlotNoInArr=(lastSlotNoIndex>=0)?true:false;if(flag_existLastSlotNoInArr){}else{for(var k=0,tmpArrLength=tmpArr.length;k<tmpArrLength;k++){tmpSkillSlotNo=tmpArr[k];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(tmpSkillSlotNo);if(_tmpSkillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_EXCLUSIVE)}else{_tmpSkillSlotItem.setMouseInteraction(false)}}}}var connectionArrTotal=_arrowManager.getConnectionArrTotal();var _tmpSkillSlotItem,tmpArr,tmpSkillSlotNo,flag_existLastSlotNoInArr=false;for(var i=0,max=connectionArrTotal.length;i<max;i++){tmpArr=connectionArrTotal[i];var lastSlotNoIndex=nc.bns.training.util.ArrayUtil.indexOf(tmpArr,_lastLearnedSkillSlotItem.getSlotNo());flag_existLastSlotNoInArr=(lastSlotNoIndex>=0)?true:false;if(flag_existLastSlotNoInArr){for(var k=0,tmpArrLength=tmpArr.length;k<tmpArrLength;k++){tmpSkillSlotNo=tmpArr[k];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(tmpSkillSlotNo);if(_tmpSkillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_IMPOSSIBLE)}else{_tmpSkillSlotItem.setMouseInteraction(false)}}}else{}}var arrowInfoObjArr=_arrowManager.activateArrowsFromRootToSlotAndGetArrowInfoObj(slotNo);if(parseInt(variationKey)>=parseInt(tmpVariationObj.max_variation_level)){_lastLearnedSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE);bindSkillSlotItemEventHandler(_lastLearnedSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler)}else{_lastLearnedSkillSlotItem.setCurrentVariationStatus(parseInt(variationKey));_lastLearnedSkillSlotItem.displayVariationStatus(variationKey);_lastLearnedSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_PLUS_STEP);bindSkillSlotItemEventHandler(_lastLearnedSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler);bindSkillSlotItemEventHandler(_lastLearnedSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler)}var arrowInfoObj,_tmpSkillSlotItem;for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(arrowInfoObj.prevTrainSlotNo);_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE)}}}}}else{if(getFlagRemainedSkillPoint()){var _firstSkillSlotItem=getSkillSlotItemBySlotNo(FIRST_ITEM_SLOT_NO);if(!_firstSkillSlotItem)return;if(nc.bns.training.Model.editable)_firstSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_PLUS);bindSkillSlotItemEventHandler(_firstSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler)}else{var _tmpSkillSlotItem;for(var i=0,max=skillSlotItemArr.length;i<max;i++){_tmpSkillSlotItem=skillSlotItemArr[i];switch(_tmpSkillSlotItem.getSlotFrameType()){case nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_NORMAL:_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_IMPOSSIBLE);break;case nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND:break;case nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_ELITE:_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_IMPOSSIBLE);break}}}}}}function bindSkillSlotItemEventHandler($skillSlotItem,$eventStr,$eventHandler){$($skillSlotItem).unbind($eventStr,$eventHandler);$($skillSlotItem).bind($eventStr,$eventHandler)}function unbindSkillSlotItemEventHandler($skillSlotItem,$eventStr,$eventHandler){$($skillSlotItem).unbind($eventStr,$eventHandler)}function getSkillSlotItemBySlotNo($slotNo){var _skillSlotItem=null;for(var i=0,max=skillSlotItemArr.length;i<max;i++){_skillSlotItem=skillSlotItemArr[i];if(_skillSlotItem.getSlotNo()==$slotNo)break}return _skillSlotItem}function skillSlotItemDiffMouseEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();var skillId="";var treeId="";var _targetSkillSlotItem=null;var variationData=null;switch($evt.type){case nc.bns.training.tree.SkillSlotItem.MOUSEOUT_SKILL_SLOT_ITEM:if(!$evt.variationData)return;variationData=$evt.variationData;$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOUT_SLOT_ITEM,variationData:variationData});break;case nc.bns.training.tree.SkillSlotItem.MOUSEOVER_SKILL_SLOT_ITEM:_targetSkillSlotItem=$evt.target;if(!_targetSkillSlotItem)return;if(!$evt.variationData)return;skillId=$evt.variationData.skill_id;treeId=$evt.variationData.tree_id;variationData=$evt.variationData;switch(nc.bns.training.Model.lastSelectedSkillType){case"":skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);if(skillId!=treeId){$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:"",slotType:nc.bns.training.Model.SLOT_ACQUISITION})}else{if(skillListObj.name2_refine!=$evt.variationData.name2_refine){$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:"",slotType:nc.bns.training.Model.SLOT_REPLACE})}else{$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:"",slotType:""})}}break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);if(skillId!=treeId){$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:nc.bns.training.Model.SKILL_TYPE_ACQUISITION,slotType:nc.bns.training.Model.SLOT_ACQUISITION})}else{if(skillListObj.name2_refine!=$evt.variationData.name2_refine){$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:nc.bns.training.Model.SKILL_TYPE_ACQUISITION,slotType:nc.bns.training.Model.SLOT_REPLACE,})}else{$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:nc.bns.training.Model.SKILL_TYPE_ACQUISITION,slotType:""})}}break;case nc.bns.training.Model.SKILL_TYPE_SHARE:skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);if(skillId!=treeId){$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:nc.bns.training.Model.SKILL_TYPE_SHARE,slotType:nc.bns.training.Model.SLOT_ACQUISITION})}else{if(skillListObj.name2_refine!=$evt.variationData.name2_refine){$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:nc.bns.training.Model.SKILL_TYPE_SHARE,slotType:nc.bns.training.Model.SLOT_REPLACE})}else{$(_this).trigger({type:nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM,variationData:variationData,skillType:nc.bns.training.Model.SKILL_TYPE_SHARE,slotType:""})}}break}break}}function skillSlotItemEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();var switchSkillData={type:null};var _targetSkillSlotItem=null;var targetSkillSlotNo="";var skillListObj=null;var skillId="";var treeId="";var variationData=null;switch($evt.type){case nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM:_targetSkillSlotItem=$evt.target;if(!_targetSkillSlotItem)return;if(nc.bns.training.Model.skillPointRemained<=0)return;targetSkillSlotNo=_targetSkillSlotItem.getSlotNo();skillId=$evt.variationData.skill_id;treeId=$evt.variationData.tree_id;variationData=$evt.variationData;switch(nc.bns.training.Model.lastSelectedSkillType){case"":var prevTrainSkillIdArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedAllSkillId(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],variationData.alias);skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);skillListObj.learnedSkillVariationId=String(variationData.variation_id);skillListObj.learnedSkillTooltipAlias=String(variationData.tooltip_alias);skillListObj.learnedSkillAlias=String(variationData.alias);var restSkillPoint=nc.bns.training.Model.skillPointRemained-1;if(restSkillPoint<=0){setSkillTreeWhenAllSkillPointConsumed()}else{setSkillTreeWhenSkillPointRemained()}if(skillId!=treeId){$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:"",slotType:nc.bns.training.Model.SLOT_ACQUISITION,switchSkillData:null})}else{if(skillListObj.name2_refine!=$evt.variationData.name2_refine){switchSkillData={variationId:skillListObj.learnedSkillVariationId,alias:skillListObj.learnedSkillAlias,skillName:variationData.name2_refine};$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:"",slotType:nc.bns.training.Model.SLOT_REPLACE,switchSkillData:switchSkillData})}else{$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:"",slotType:"",switchSkillData:null})}}break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:var prevTrainSkillIdArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedAllSkillId(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],variationData.alias);skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);skillListObj.learnedSkillVariationId=String(variationData.variation_id);skillListObj.learnedSkillTooltipAlias=String(variationData.tooltip_alias);skillListObj.learnedSkillAlias=String(variationData.alias);var restSkillPoint=nc.bns.training.Model.skillPointRemained-1;if(restSkillPoint<=0){setSkillTreeWhenAllSkillPointConsumed()}else{setSkillTreeWhenSkillPointRemained()}if(skillId!=treeId){$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:nc.bns.training.Model.SKILL_TYPE_ACQUISITION,slotType:nc.bns.training.Model.SLOT_ACQUISITION,switchSkillData:null})}else{if(skillListObj.name2_refine!=$evt.variationData.name2_refine){switchSkillData={variationId:skillListObj.learnedSkillVariationId,alias:skillListObj.learnedSkillAlias,skillName:variationData.name2_refine};$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:nc.bns.training.Model.SKILL_TYPE_ACQUISITION,slotType:nc.bns.training.Model.SLOT_REPLACE,switchSkillData:switchSkillData})}else{$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:nc.bns.training.Model.SKILL_TYPE_ACQUISITION,slotType:"",switchSkillData:null})}}break;case nc.bns.training.Model.SKILL_TYPE_SHARE:var prevTrainSkillIdArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedAllSkillId(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],variationData.alias);skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);skillListObj.learnedSkillVariationId=String($evt.variationData.variation_id);skillListObj.learnedSkillTooltipAlias=String($evt.variationData.tooltip_alias);skillListObj.learnedSkillAlias=String($evt.variationData.alias);var restSkillPoint=nc.bns.training.Model.skillPointRemained-1;if(restSkillPoint<=0){setSkillTreeWhenAllSkillPointConsumed()}else{setSkillTreeWhenSkillPointRemained()}if(skillId!=treeId){$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:nc.bns.training.Model.SKILL_TYPE_SHARE,slotType:nc.bns.training.Model.SLOT_ACQUISITION,switchSkillData:null})}else{if(skillListObj.name2_refine!=$evt.variationData.name2_refine){switchSkillData={variationId:skillListObj.learnedSkillVariationId,alias:skillListObj.learnedSkillAlias,skillName:variationData.name2_refine};$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:nc.bns.training.Model.SKILL_TYPE_SHARE,slotType:nc.bns.training.Model.SLOT_REPLACE,switchSkillData:switchSkillData})}else{$(_this).trigger({type:nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT,skillId:skillId,treeId:treeId,prevTrainSkillIdArr:prevTrainSkillIdArr,skillType:nc.bns.training.Model.SKILL_TYPE_SHARE,slotType:"",switchSkillData:null})}}break}break;case nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON:var _targetSkillSlotItem=$evt.target;if(!_targetSkillSlotItem)return;var targetSkillSlotNo=_targetSkillSlotItem.getSlotNo();var variationData=$evt.prevVariationData;skillId=variationData.skill_id;treeId=variationData.tree_id;var flag_changeSkillName=false;var controlScrollContainerPosYSkillId="";var slotDataObj;switch(nc.bns.training.Model.lastSelectedSkillType){case"":controlScrollContainerPosYSkillId=treeId;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:controlScrollContainerPosYSkillId=treeId;case nc.bns.training.Model.SKILL_TYPE_SHARE:controlScrollContainerPosYSkillId=treeId;slotDataObj=nc.bns.training.Model.SLOT_OBJ_JSON[treeId];skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);var trainedSkillVariationArr=getTrainedSkillVariationArr(treeId,skillListObj.learnedSkillAlias);if(trainedSkillVariationArr.length<=0){return}var tmpVariationObj,skillIndex=-1;for(var i=0,max=trainedSkillVariationArr.length;i<max;i++){tmpVariationObj=trainedSkillVariationArr[i];if(tmpVariationObj.variation_id==variationData.variation_id){if(tmpVariationObj.alias==variationData.alias){skillIndex=i;break}}}if(skillIndex<0){return}if(skillIndex==0){if(skillListObj.name2_refine!=skillListObj.initName2Refine){flag_changeSkillName=true}skillListObj.learnedSkillVariationId="";skillListObj.learnedSkillTooltipAlias="";skillListObj.learnedSkillAlias="";skillListObj.name2_refine=skillListObj.initName2Refine;skillListObj.initJamoStr=nc.bns.training.util.StringUtil.getInitialJamoStr(skillListObj.name2_refine.charAt(0));skillListObj.consumedSkillPoint=0}else{var targetVariation=trainedSkillVariationArr[skillIndex-1];if(skillListObj.name2_refine!=targetVariation.name2_refine){var checkSkillList=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(targetVariation.skill_id);if(checkSkillList.skillType!=""){flag_changeSkillName=false}else{flag_changeSkillName=true}}skillListObj.learnedSkillVariationId=String(targetVariation.variation_id);skillListObj.learnedSkillTooltipAlias=String(targetVariation.tooltip_alias);skillListObj.learnedSkillAlias=String(targetVariation.alias);skillListObj.name2_refine=targetVariation.name2_refine;skillListObj.initJamoStr=nc.bns.training.util.StringUtil.getInitialJamoStr(targetVariation.name2_refine.charAt(0));if(skillListObj.consumedSkillPoint<=0)return;skillListObj.consumedSkillPoint=skillListObj.consumedSkillPoint-1}break}$(_this).trigger({type:nc.bns.training.tree.SkillTree.CANCEL_SKILL_POINT,controlScrollContainerPosYSkillId:controlScrollContainerPosYSkillId,flag_changeSkillName:flag_changeSkillName});break}function setSkillTreeWhenSkillPointRemained(){var connectionArrTotal=_arrowManager.getConnectionArrTotal();var tmpArr,targetSlotNoIndex,flag_existLastSlotNoInArr=false;var tmpSkillSlotNo,_tmpSkillSlotItem;for(var i=0,max=connectionArrTotal.length;i<max;i++){tmpArr=connectionArrTotal[i];targetSlotNoIndex=nc.bns.training.util.ArrayUtil.indexOf(tmpArr,targetSkillSlotNo);flag_existLastSlotNoInArr=(targetSlotNoIndex>=0)?true:false;if(flag_existLastSlotNoInArr){var targetSkillSlotColumnNo=parseInt(targetSkillSlotNo.charAt(0));var tmpSlotColumnNo;for(var k=0,tmpArrLength=tmpArr.length;k<tmpArrLength;k++){tmpSkillSlotNo=tmpArr[k];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(tmpSkillSlotNo);tmpSlotColumnNo=parseInt(tmpSkillSlotNo.charAt(0));if(tmpSlotColumnNo<targetSkillSlotColumnNo){unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler)}}}else{for(var k=0,tmpArrLength=tmpArr.length;k<tmpArrLength;k++){tmpSkillSlotNo=tmpArr[k];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(tmpSkillSlotNo);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler);if(_tmpSkillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_EXCLUSIVE)}else{_tmpSkillSlotItem.setMouseInteraction(false)}}}}var arrowInfoObjArr=_arrowManager.activateArrowsFromRootToSlotAndGetArrowInfoObj(targetSkillSlotNo);_arrowManager.activateArrowsFromSlotToChildSlots(targetSkillSlotNo);_targetSkillSlotItem.addVariationStatusValue();learnSkillSlotItem(_targetSkillSlotItem);if(!_targetSkillSlotItem.getFlagRemainVariation()){var nextSlotNoArr=_arrowManager.getNextSkillItemsBySelectedSlotNo(targetSkillSlotNo);var _skillSlotItem;for(var i=0,max=skillSlotItemArr.length;i<max;i++){_skillSlotItem=skillSlotItemArr[i];for(var j=0,nextSlotNoArrLength=nextSlotNoArr.length;j<nextSlotNoArrLength;j++){if(_skillSlotItem.getSlotNo()!=nextSlotNoArr[j])continue;if(_skillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){_skillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_PLUS);bindSkillSlotItemEventHandler(_skillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler)}else{_skillSlotItem.setMouseInteraction(false)}}}}else{_arrowManager.deactivateArrowsFromSlotToChildSlots(targetSkillSlotNo)}var arrowInfoObj,_tmpSkillSlotItem;for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(arrowInfoObj.prevTrainSlotNo);_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE)}bindSkillSlotItemEventHandler(_targetSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler)}function setSkillTreeWhenAllSkillPointConsumed(){var connectionArrTotal=_arrowManager.getConnectionArrTotal();var tmpArr,lastSlotNoIndex,flag_existLastSlotNoInArr=false;var tmpSkillSlotNo,_tmpSkillSlotItem;for(var i=0,max=connectionArrTotal.length;i<max;i++){tmpArr=connectionArrTotal[i];lastSlotNoIndex=nc.bns.training.util.ArrayUtil.indexOf(tmpArr,_targetSkillSlotItem.getSlotNo());flag_existLastSlotNoInArr=(lastSlotNoIndex>=0)?true:false;if(flag_existLastSlotNoInArr){}else{for(var k=0,tmpArrLength=tmpArr.length;k<tmpArrLength;k++){tmpSkillSlotNo=tmpArr[k];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(tmpSkillSlotNo);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler);if(_tmpSkillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_EXCLUSIVE)}else{_tmpSkillSlotItem.setMouseInteraction(false)}}}}var tmpArr,lastSlotNoIndex,flag_existLastSlotNoInArr=false;for(var i=0,max=connectionArrTotal.length;i<max;i++){tmpArr=connectionArrTotal[i];lastSlotNoIndex=nc.bns.training.util.ArrayUtil.indexOf(tmpArr,_targetSkillSlotItem.getSlotNo());flag_existLastSlotNoInArr=(lastSlotNoIndex>=0)?true:false;if(flag_existLastSlotNoInArr){var tmpSkillSlotNo,_tmpSkillSlotItem;for(var k=0,tmpArrLength=tmpArr.length;k<tmpArrLength;k++){tmpSkillSlotNo=tmpArr[k];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(tmpSkillSlotNo);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler);unbindSkillSlotItemEventHandler(_tmpSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,skillSlotItemEventHandler);if(_tmpSkillSlotItem.getSlotFrameType()!=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND){_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_IMPOSSIBLE)}else{_tmpSkillSlotItem.setMouseInteraction(false)}}}else{}}var arrowInfoObjArr=_arrowManager.activateArrowsFromRootToSlotAndGetArrowInfoObj(targetSkillSlotNo);_arrowManager.activateArrowsFromSlotToChildSlots(targetSkillSlotNo);_targetSkillSlotItem.addVariationStatusValue();learnSkillSlotItem(_targetSkillSlotItem);if(!_targetSkillSlotItem.getFlagRemainVariation()){}else{_arrowManager.deactivateArrowsFromSlotToChildSlots(targetSkillSlotNo)}var arrowInfoObj,_tmpSkillSlotItem;for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];_tmpSkillSlotItem=getSkillSlotItemBySlotNo(arrowInfoObj.prevTrainSlotNo);_tmpSkillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE)}bindSkillSlotItemEventHandler(_targetSkillSlotItem,nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,skillSlotItemEventHandler)}}function learnSkillSlotItem($skillSlotItem){var _skillSlotItem=$skillSlotItem;_skillSlotItem.learnSkill();if(_skillSlotItem.getFlagRemainVariation()){_skillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_PLUS_STEP)}else{_skillSlotItem.setSlotStatus(nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE)}}function getTrainedSkillVariationArr($skillId,$alias){var variationArr=[];var skillSlotObj=nc.bns.training.Model.SLOT_OBJ_JSON[$skillId];var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);var lastLearnedVariationId=skillListObj.learnedSkillVariationId;var lastLearnedAlias=skillListObj.learnedSkillAlias;var flag_findVariation=false;var slotNoHasLastLearnedVariationId=-1;var _tmpSlotObj,_tmpVariation;for(var slotNo in skillSlotObj){_tmpSlotObj=skillSlotObj[slotNo];for(var variationNo in _tmpSlotObj){_tmpVariation=_tmpSlotObj[variationNo];if(_tmpVariation.variation_id==lastLearnedVariationId){if(_tmpVariation.alias==lastLearnedAlias){slotNoHasLastLearnedVariationId=slotNo;flag_findVariation=true}break}}if(flag_findVariation)break}if(slotNoHasLastLearnedVariationId<0)return;var connectionArrTotal=_arrowManager.getConnectionArrTotalBySkillId($skillId);var flag_findSlotNoHasLastLearnedVariationId=false;var connectionArr,tmpSlotNo;if(connectionArrTotal.length<=0){flag_findSlotNoHasLastLearnedVariationId=true;connectionArr=[];for(var slotNo in skillSlotObj){connectionArr.push(String(slotNo))}}else{for(var i=0,max=connectionArrTotal.length;i<max;i++){if(flag_findSlotNoHasLastLearnedVariationId)break;connectionArr=connectionArrTotal[i];for(var j=0,length=connectionArr.length;j<length;j++){tmpSlotNo=connectionArr[j];if(tmpSlotNo==slotNoHasLastLearnedVariationId){flag_findSlotNoHasLastLearnedVariationId=true;break}}}}var flag_findLastLearnedVariationId=false;var tmpSlotNo,tmpSlotObj,tmpVariationObj;for(var i=0,max=connectionArr.length;i<max;i++){if(flag_findLastLearnedVariationId)break;tmpSlotNo=connectionArr[i];tmpSlotObj=skillSlotObj[String(tmpSlotNo)];for(var varitationNo in tmpSlotObj){tmpVariationObj=tmpSlotObj[varitationNo];variationArr.push(tmpVariationObj);if(tmpVariationObj.variation_id==lastLearnedVariationId){if(tmpVariationObj.alias==lastLearnedAlias){flag_findLastLearnedVariationId=true}break}}}return variationArr}function getFlagRemainedSkillPoint(){var flag=false;if(nc.bns.training.Model.skillPointRemained>0)flag=true;return flag}return _this};nc.bns.training.tree.SkillTree.CONSUME_SKILL_POINT="CONSUME_SKILL_POINT";nc.bns.training.tree.SkillTree.CANCEL_SKILL_POINT="CANCEL_SKILL_POINT";nc.bns.training.tree.SkillTree.SWITCH_SKILL_TYPE_REPLACE="SWITCH_SKILL_TYPE_REPLACE";nc.bns.training.tree.SkillTree.MOUSEOVER_SLOT_ITEM="MOUSEOVER_SLOT_ITEM";nc.bns.training.tree.SkillTree.MOUSEOUT_SLOT_ITEM="MOUSEOUT_SLOT_ITEM";nc.bns.training.tree.ArrowManager=function(_options){var _this=this;_this.destroy=function(){$(_container).empty();arrowDataObjArr=[]};_this.getConnectionArrTotal=function(){return connectionArrTotal};_this.activateArrowsFromSlotToChildSlots=function($slotNo){var slotNo=$slotNo;var arrowInfoObj,arrowContainerArr=[];for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];if(arrowInfoObj.prevTrainSlotNo==slotNo)arrowContainerArr.push(arrowInfoObj.container)}var _arrowElement;for(var j=0,max=arrowContainerArr.length;j<max;j++){_arrowElement=arrowContainerArr[j];$(_arrowElement).addClass("able")}var flag_exist=false;var _infoObj;for(var i=0,max=arrowInfoObjArr.length;i<max;i++){_infoObj=arrowInfoObjArr[i];if(_infoObj.slotNo==$slotNo){flag_exist=true;break}}if(!flag_exist)return;arrowContainerArr=[];for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];if(arrowInfoObj.slotNo==$slotNo)continue;if(arrowInfoObj.prevTrainSlotNo==_infoObj.prevTrainSlotNo){arrowContainerArr.push(arrowInfoObj.container)}}for(var j=0,max=arrowContainerArr.length;j<max;j++){_arrowElement=arrowContainerArr[j];$(_arrowElement).removeClass("able")}};_this.deactivateArrowsFromSlotToChildSlots=function($slotNo){arrowContainerArr=[];var columnNoStr;for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];if(arrowInfoObj.prevTrainSlotNo==$slotNo){arrowContainerArr.push(arrowInfoObj.container)}}for(var j=0,max=arrowContainerArr.length;j<max;j++){_arrowElement=arrowContainerArr[j];$(_arrowElement).removeClass("able")}};_this.activateArrowsFromRootToSlotAndGetArrowInfoObj=function($slotNo){var slotNo=$slotNo;var infoObjArr=[];var loopFunctionObj={};loopFunctionObj.setArrowContainerArr=function($functionObj,$slotNo,$infoObjArr){var flag_existFindConnectionInfo=false;var arrowInfoObj;for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];if(arrowInfoObj.slotNo==$slotNo){flag_existFindConnectionInfo=true;$infoObjArr.push(arrowInfoObj);break}}if(flag_existFindConnectionInfo){var columnNo=parseInt(arrowInfoObj.prevTrainSlotNo.charAt(0));if(columnNo<=1)return}if($infoObjArr.length>0){var lastInfoObj=$infoObjArr[$infoObjArr.length-1];$functionObj.setArrowContainerArr($functionObj,lastInfoObj.prevTrainSlotNo,$infoObjArr)}};loopFunctionObj.setArrowContainerArr(loopFunctionObj,slotNo,infoObjArr);var _arrowElement;for(var j=0,max=infoObjArr.length;j<max;j++){_arrowElement=infoObjArr[j].container;$(_arrowElement).addClass("able")}return infoObjArr};_this.getNextSkillItemsBySelectedSlotNo=function($slotNo){var slotNo=$slotNo;var arrowInfoObj,slotNoArr=[];for(var i=0,max=arrowInfoObjArr.length;i<max;i++){arrowInfoObj=arrowInfoObjArr[i];if(arrowInfoObj.prevTrainSlotNo==slotNo){slotNoArr.push(arrowInfoObj.slotNo)}}return slotNoArr};_this.getConnectionArrTotal=function(){return connectionArrTotal};_this.getConnectionArrTotalBySkillId=function($skillId){var skillConnectionArrTotal=[];var skillSlotData=nc.bns.training.Model.SLOT_OBJ_JSON[String($skillId)];var slotNoArr=nc.bns.training.util.ObjectUtil.getElementKeyNameArr(skillSlotData);var slotDataArr=nc.bns.training.util.ObjectUtil.getElementArr(skillSlotData);var slotDataObjArr=[],_slotDataObj;for(var i=0,max=slotDataArr.length;i<max;i++){_slotDataObj=slotDataArr[i]["1"];_slotDataObj.slotNo=slotNoArr[i];slotDataObjArr.push(_slotDataObj)}var arrowInfoObjArr=[];var prevTrainAliasStr,prevTrainSlotNo,arrowInfoObj;for(var i=slotDataObjArr.length-1;i>=0;i--){_slotDataObj=slotDataObjArr[i];prevTrainAliasStr=_slotDataObj.prev_train["0"];if(prevTrainAliasStr){prevTrainSlotNo=getPrevTrainSlotNoHasAlias(skillSlotData,prevTrainAliasStr);arrowInfoObj={prevTrainSlotNo:String(prevTrainSlotNo),slotNo:String(_slotDataObj.slotNo)};arrowInfoObjArr.push(arrowInfoObj)}}var connectionArr=[];var functionObj={};functionObj.setArrowConnectionArr=function($functionObj,$cloneArrowInfoObjArr,$originalArrowInfoObjArr,flag_start){if(flag_start){if($cloneArrowInfoObjArr.length<=0)return;connectionArr=[];var _firstInfoObj=$cloneArrowInfoObjArr[0];connectionArr.unshift(_firstInfoObj.slotNo);connectionArr.unshift(_firstInfoObj.prevTrainSlotNo);$cloneArrowInfoObjArr.shift()}var flag_exist=false,firstSlotNo=connectionArr[0];var _infoObj,_cloneArrowInfoObj;for(var i=0,max=$originalArrowInfoObjArr.length;i<max;i++){_infoObj=$originalArrowInfoObjArr[i];if(firstSlotNo==_infoObj.slotNo){connectionArr.unshift(_infoObj.prevTrainSlotNo);flag_exist=true;if($cloneArrowInfoObjArr.length>0){for(var j=0,length=$cloneArrowInfoObjArr.length;j<length;j++){_cloneArrowInfoObj=$cloneArrowInfoObjArr[j];if(firstSlotNo==_cloneArrowInfoObj.slotNo){nc.bns.training.util.ArrayUtil.removeElement($cloneArrowInfoObjArr,_cloneArrowInfoObj);break}}}break}}if(flag_exist){$functionObj.setArrowConnectionArr($functionObj,$cloneArrowInfoObjArr,$originalArrowInfoObjArr,false)}else{skillConnectionArrTotal.push(connectionArr);$functionObj.setArrowConnectionArr($functionObj,$cloneArrowInfoObjArr,$originalArrowInfoObjArr,true)}};var cloneArrowInfoObjArr=[];cloneArrowInfoObjArr=$.extend(true,cloneArrowInfoObjArr,arrowInfoObjArr);functionObj.setArrowConnectionArr(functionObj,cloneArrowInfoObjArr,arrowInfoObjArr,true);return skillConnectionArrTotal};var BASE_POSX_ARROW_LINE=60;var BASE_POSY_ARROW_LINE=32;var GAPY_SLOT=75;var GAPX_SLOT=75;var GAP_BETWEEN_SLOT=25;var HEIGHT_END_ARROW=17;var HEIGHT_SLOT=50;var SKILL_TREE_ARROW_THICKNESS=5;var _container=_options.container;var data=_options.data;var arrowInfoObjArr=[];var slotDataObjArr=[];var connectionArrTotal=[];var connectionArr=[];init();function init(){var slotNoArr=nc.bns.training.util.ObjectUtil.getElementKeyNameArr(data);var slotDataArr=nc.bns.training.util.ObjectUtil.getElementArr(data);slotDataObjArr=[];var _slotDataObj;for(var i=0,max=slotDataArr.length;i<max;i++){_slotDataObj=slotDataArr[i]["1"];_slotDataObj.slotNo=slotNoArr[i];slotDataObjArr.push(_slotDataObj)}arrowInfoObjArr=[];var prevTrainAliasStr,prevTrainSlotNo,arrowInfoObj;for(var i=slotDataObjArr.length-1;i>=0;i--){_slotDataObj=slotDataObjArr[i];prevTrainAliasStr=_slotDataObj.prev_train["0"];if(prevTrainAliasStr){prevTrainSlotNo=getPrevTrainSlotNoHasAlias(data,prevTrainAliasStr);arrowInfoObj=setArrowAndGetArrowSettingInfoObj(_container,prevTrainSlotNo,_slotDataObj.slotNo);arrowInfoObjArr.push(arrowInfoObj)}}var cloneArrowInfoObjArr=[];cloneArrowInfoObjArr=$.extend(true,cloneArrowInfoObjArr,arrowInfoObjArr);setArrowConnectionArr(cloneArrowInfoObjArr,arrowInfoObjArr,true)}function setArrowConnectionArr($cloneArrowInfoObjArr,$originalArrowInfoObjArr,flag_start){if(flag_start){if($cloneArrowInfoObjArr.length<=0)return;connectionArr=[];var _firstInfoObj=$cloneArrowInfoObjArr[0];connectionArr.unshift(_firstInfoObj.slotNo);connectionArr.unshift(_firstInfoObj.prevTrainSlotNo);$cloneArrowInfoObjArr.shift()}var flag_exist=false,firstSlotNo=connectionArr[0];var _infoObj,_cloneArrowInfoObj;for(var i=0,max=$originalArrowInfoObjArr.length;i<max;i++){_infoObj=$originalArrowInfoObjArr[i];if(firstSlotNo==_infoObj.slotNo){connectionArr.unshift(_infoObj.prevTrainSlotNo);flag_exist=true;if($cloneArrowInfoObjArr.length>0){for(var j=0,length=$cloneArrowInfoObjArr.length;j<length;j++){_cloneArrowInfoObj=$cloneArrowInfoObjArr[j];if(firstSlotNo==_cloneArrowInfoObj.slotNo){nc.bns.training.util.ArrayUtil.removeElement($cloneArrowInfoObjArr,_cloneArrowInfoObj);break}}}break}}if(flag_exist){setArrowConnectionArr($cloneArrowInfoObjArr,$originalArrowInfoObjArr,false)}else{connectionArrTotal.push(connectionArr);setArrowConnectionArr($cloneArrowInfoObjArr,$originalArrowInfoObjArr,true)}}function setArrowAndGetArrowSettingInfoObj($container,$prevTrainSlotNo,$slotNo){var prevTrainSlotColumnNo=String($prevTrainSlotNo).charAt(0);var prevTrainSlotRowNo=String($prevTrainSlotNo).charAt(1);var slotColumnNo=String($slotNo).charAt(0);var slotRowNo=String($slotNo).charAt(1);var _arrowElement=document.createElement("span");$(_arrowElement).addClass("arrow");$($container).append(_arrowElement);$(_arrowElement).append('<span class="end"></span>'+'<span class="h"></span>'+'<span class="v"></span>');var _verticalLineSpan=$(".v",_arrowElement).get(0);var _horizontalLineSpan=$(".h",_arrowElement).get(0);var _endArrowSpan=$(".end",_arrowElement).get(0);var columnGap,rowGap,top,left,width,height;if(prevTrainSlotRowNo!=slotRowNo){columnGap=parseInt(slotColumnNo)-parseInt(prevTrainSlotColumnNo);rowGap=parseInt(slotRowNo)-parseInt(prevTrainSlotRowNo);var slotObjArr=[];var tmpSlotDataObj,prevTrainAliasStr,prevTrainSlotNo;for(var i=0,max=slotDataObjArr.length;i<max;i++){tmpSlotDataObj=slotDataObjArr[i];if(tmpSlotDataObj.slotNo!=$slotNo){prevTrainAliasStr=tmpSlotDataObj.prev_train["0"];if(!prevTrainAliasStr)continue;prevTrainSlotNo=getPrevTrainSlotNoHasAlias(data,prevTrainAliasStr);if(prevTrainSlotNo==$prevTrainSlotNo)slotObjArr.push(tmpSlotDataObj)}}if(slotObjArr.length>0){var otherSlotObj,tmpSlotRowNo;for(var i=0,max=slotObjArr.length;i<max;i++){otherSlotObj=slotObjArr[i];tmpSlotRowNo=String(otherSlotObj.slotNo).charAt(1);if(prevTrainSlotRowNo==tmpSlotRowNo)break}var otherSlotColumnNo=String(otherSlotObj.slotNo).charAt(0);if(parseInt(slotColumnNo)<=parseInt(otherSlotColumnNo)){top=(parseInt(prevTrainSlotColumnNo-1)*GAPY_SLOT)+BASE_POSX_ARROW_LINE;left=parseInt(prevTrainSlotRowNo-1)*GAPX_SLOT+BASE_POSY_ARROW_LINE;if(columnGap<=1){height=GAP_BETWEEN_SLOT-HEIGHT_END_ARROW}else{height=(columnGap*GAPY_SLOT)-HEIGHT_SLOT-HEIGHT_END_ARROW}_verticalLineSpan.style.top=top+"px";_verticalLineSpan.style.left=left+"px";_verticalLineSpan.style.width=SKILL_TREE_ARROW_THICKNESS+"px";_verticalLineSpan.style.height=height+"px";width=(rowGap*GAPX_SLOT);_horizontalLineSpan.style.height=SKILL_TREE_ARROW_THICKNESS+"px";_horizontalLineSpan.style.top=top+height+"px";_horizontalLineSpan.style.left=left+"px";_horizontalLineSpan.style.width=width+"px";_endArrowSpan.style.top=parseInt(_horizontalLineSpan.style.top)+"px";_endArrowSpan.style.left=(left+width-3)+"px"}else{var otherSlotBetweenPrevTrainSlotColumnGap=parseInt(otherSlotColumnNo)-prevTrainSlotColumnNo;top=(parseInt(prevTrainSlotColumnNo-1)*GAPY_SLOT)+BASE_POSX_ARROW_LINE;left=parseInt(prevTrainSlotRowNo-1)*GAPX_SLOT+BASE_POSY_ARROW_LINE;if(otherSlotBetweenPrevTrainSlotColumnGap<=1){height=GAP_BETWEEN_SLOT-HEIGHT_END_ARROW}else{height=(otherSlotBetweenPrevTrainSlotColumnGap*GAPY_SLOT)-HEIGHT_SLOT-HEIGHT_END_ARROW}_verticalLineSpan.style.top=top+"px";_verticalLineSpan.style.left=left+"px";_verticalLineSpan.style.width=SKILL_TREE_ARROW_THICKNESS+"px";_verticalLineSpan.style.height=height+"px";width=(rowGap*GAPX_SLOT);_horizontalLineSpan.style.height=SKILL_TREE_ARROW_THICKNESS+"px";_horizontalLineSpan.style.top=top+height+"px";_horizontalLineSpan.style.left=left+"px";_horizontalLineSpan.style.width=width+"px";var _secondVerticalLineSpan=document.createElement("span");$(_secondVerticalLineSpan).addClass("v");_arrowElement.appendChild(_secondVerticalLineSpan);var slotBetweenOtherSlotColumnGap=slotColumnNo-parseInt(otherSlotColumnNo);height=(slotBetweenOtherSlotColumnGap*GAPY_SLOT);_secondVerticalLineSpan.style.top=parseInt(_horizontalLineSpan.style.top)+"px";_secondVerticalLineSpan.style.left=left+width+"px";_secondVerticalLineSpan.style.width=SKILL_TREE_ARROW_THICKNESS+"px";_secondVerticalLineSpan.style.height=height+"px";_endArrowSpan.style.top=parseInt(_horizontalLineSpan.style.top)+height+"px";_endArrowSpan.style.left=(left+width-3)+"px"}}else{top=(parseInt(prevTrainSlotColumnNo-1)*GAPY_SLOT)+BASE_POSX_ARROW_LINE;left=parseInt(prevTrainSlotRowNo-1)*GAPX_SLOT+BASE_POSY_ARROW_LINE;if(columnGap<=1){height=GAP_BETWEEN_SLOT-HEIGHT_END_ARROW}else{height=(columnGap*GAPY_SLOT)-HEIGHT_SLOT-HEIGHT_END_ARROW}_verticalLineSpan.style.top=top+"px";_verticalLineSpan.style.left=left+"px";_verticalLineSpan.style.width=SKILL_TREE_ARROW_THICKNESS+"px";_verticalLineSpan.style.height=height+"px";width=(rowGap*GAPX_SLOT);_horizontalLineSpan.style.height=SKILL_TREE_ARROW_THICKNESS+"px";_horizontalLineSpan.style.top=top+height+"px";_horizontalLineSpan.style.left=left+"px";_horizontalLineSpan.style.width=width+"px";_endArrowSpan.style.top=parseInt(_horizontalLineSpan.style.top)+"px";_endArrowSpan.style.left=(left+width-3)+"px"}}else{columnGap=parseInt(slotColumnNo)-parseInt(prevTrainSlotColumnNo);top=(parseInt(prevTrainSlotColumnNo-1)*GAPY_SLOT)+BASE_POSX_ARROW_LINE;left=parseInt(prevTrainSlotRowNo-1)*GAPX_SLOT+BASE_POSY_ARROW_LINE;if(columnGap<=1){height=GAP_BETWEEN_SLOT-HEIGHT_END_ARROW}else{height=(columnGap*GAPY_SLOT)-HEIGHT_SLOT-HEIGHT_END_ARROW}_verticalLineSpan.style.top=top+"px";_verticalLineSpan.style.left=left+"px";_verticalLineSpan.style.width=SKILL_TREE_ARROW_THICKNESS+"px";_verticalLineSpan.style.height=height+"px";_horizontalLineSpan.style.display="none";_endArrowSpan.style.left=(left-3)+"px";_endArrowSpan.style.top=parseInt(_verticalLineSpan.style.top)+parseInt(_verticalLineSpan.style.height)+"px"}var arrowSettingInfoObj={container:_arrowElement,prevTrainSlotNo:String($prevTrainSlotNo),slotNo:String($slotNo)};return arrowSettingInfoObj}function getPrevTrainSlotNoHasAlias($slotDataObj,$aliasStr){var _slotDataObj,_variationDataObj;for(var key in $slotDataObj){_slotDataObj=$slotDataObj[key];for(var variationKey in _slotDataObj){_variationDataObj=_slotDataObj[variationKey];if(_variationDataObj.alias==$aliasStr){return key}}}return-1}return _this};nc.bns.training.tree.SkillSlotItem=function(_options){var _this=this;_this.destroy=function(){variationTotal=1;variationDataArr=[];currentVariationStatus=0;currentVariationData=null;typeFrameStr=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_NORMAL;typeFrameClassStr="slot"};_this.getSlotFrameType=function(){return typeFrameStr};_this.setSlotStatus=function(_slotStatusStr){setSlotStatus(_slotStatusStr)};_this.setFrameType=function(_slotFrameTypeStr){setFrameType(_slotFrameTypeStr)};_this.getSlotStatus=function(){return slotStatusStr};_this.setCurrentVariationStatus=function($variationStatusNumber){currentVariationStatus=parseInt($variationStatusNumber)};_this.getCurrentVariationStatus=function(){return currentVariationStatus};_this.displayVariationStatus=function($variationStatusNumberStr){displayVariationStatus($variationStatusNumberStr)};_this.getVariationTotal=function(){return variationTotal};_this.getSlotNo=function(){return slotNo};_this.setMouseInteraction=function(_flag){setSlotMouseInteraction(_flag)};_this.getFlagRemainVariation=function(){var flag=true;if(variationTotal<=currentVariationStatus)flag=false;return flag};_this.addVariationStatusValue=function(){if(variationTotal<=currentVariationStatus)return;currentVariationStatus++};_this.subtractVariationStatusValue=function(){if(currentVariationStatus<=0)return;currentVariationStatus--};_this.learnSkill=function(){if(variationTotal<=currentVariationStatus)return;displayVariationStatus(currentVariationStatus)};_this.cancelSkill=function(){if(currentVariationStatus<=0)return;displayVariationStatus(currentVariationStatus)};_this.getCurrentVariationPcLevel=function(){return parseInt(currentVariationData["pc_level"])};_this.getCurrentVariationName2Refine=function(){return currentVariationData["name2_refine"]};var _container=_options.container;var slotNo=_options.slotNo;var data=_options.data;var variationTotal=1;var currentVariationStatus=0;var variationDataArr=[];var currentVariationData=null;var _$slotElement=null;var slotStatusStr=nc.bns.training.tree.SkillSlotItem.STATUS_DEFAULT;var typeFrameStr=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_NORMAL;var typeFrameClassStr="slot";var mouseInteractionDisplayIconClassStr="";var flag_completeStatus=false;init();function init(){variationDataArr=nc.bns.training.util.ObjectUtil.getElementArr(data);var tmpImgURL="";var currentStatusData=variationDataArr[currentVariationStatus];if(currentStatusData){if(currentStatusData.training_icon){tmpImgURL=nc.bns.training.Model.SKILL_IMG_URL_FRONT+currentStatusData.training_icon}variationTotal=variationDataArr.length;currentVariationData=variationDataArr[currentVariationStatus];var slotElementStr='<div class="slot">'+'<span class="thumb"><img src="'+tmpImgURL+'"></span>'+'<span class="frame"></span>'+'<span class="hover"></span>'+'<span class="step">'+currentVariationStatus+'/'+variationTotal+'</span>'+'</div>';$(_container).append(slotElementStr);_$slotElement=$(".slot",_container);if(currentVariationData.complete_quest_name_refine){if(currentVariationData.complete_quest_desc_refine){typeFrameStr=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_ELITE;typeFrameClassStr="slot elite"}else{typeFrameStr=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND;typeFrameClassStr="slot elite_legend"}}setFrameType(typeFrameStr);setSlotDiffMouseEventHandler(true)}}function setSlotDiffMouseEventHandler($flag){_$slotElement.unbind("mouseover",slotDiffMouseEventHandler);_$slotElement.unbind("mouseout",slotDiffMouseEventHandler);if($flag){_$slotElement.bind("mouseover",slotDiffMouseEventHandler);_$slotElement.bind("mouseout",slotDiffMouseEventHandler)}}function slotDiffMouseEventHandler($evt){$evt.preventDefault();switch($evt.type){case"mouseover":triggerSlotMouseOverEvent();break;case"mouseout":if(variationDataArr.length>1){$(_this).trigger({type:nc.bns.training.tree.SkillSlotItem.MOUSEOUT_SKILL_SLOT_ITEM,variationData:variationDataArr[currentVariationStatus]})}else{$(_this).trigger({type:nc.bns.training.tree.SkillSlotItem.MOUSEOUT_SKILL_SLOT_ITEM,variationData:currentVariationData})}break}}function triggerSlotMouseOverEvent(){if(variationDataArr.length>1){var targetVariationData=variationDataArr[currentVariationStatus];if(!targetVariationData)targetVariationData=variationDataArr[variationDataArr.length-1];$(_this).trigger({type:nc.bns.training.tree.SkillSlotItem.MOUSEOVER_SKILL_SLOT_ITEM,variationData:targetVariationData})}else{$(_this).trigger({type:nc.bns.training.tree.SkillSlotItem.MOUSEOVER_SKILL_SLOT_ITEM,variationData:currentVariationData})}}function displayVariationStatus($variationStatus){var _$stepElement=$('.step',_$slotElement);_$stepElement.text($variationStatus+"/"+variationTotal)}function setSlotStatus(_slotStatusStr){switch(_slotStatusStr){case nc.bns.training.tree.SkillSlotItem.STATUS_DEFAULT:flag_completeStatus=false;break;case nc.bns.training.tree.SkillSlotItem.STATUS_PLUS:_$slotElement.removeClass().addClass(typeFrameClassStr).addClass("plus");setSlotMouseInteraction(true);flag_completeStatus=false;break;case nc.bns.training.tree.SkillSlotItem.STATUS_PLUS_STEP:_$slotElement.removeClass().addClass(typeFrameClassStr).addClass("plusstep");setSlotMouseInteraction(true);flag_completeStatus=false;break;case nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE:_$slotElement.removeClass().addClass(typeFrameClassStr).addClass("complete");setSlotMouseInteraction(true);currentVariationStatus=variationTotal;displayVariationStatus(currentVariationStatus);mouseInteractionDisplayIconClassStr="";flag_completeStatus=true;break;case nc.bns.training.tree.SkillSlotItem.STATUS_IMPOSSIBLE:_$slotElement.removeClass().addClass(typeFrameClassStr);setSlotMouseInteraction(true);mouseInteractionDisplayIconClassStr="impossible";flag_completeStatus=false;break;case nc.bns.training.tree.SkillSlotItem.STATUS_EXCLUSIVE:_$slotElement.removeClass().addClass(typeFrameClassStr);setSlotMouseInteraction(true);mouseInteractionDisplayIconClassStr="exclusive";flag_completeStatus=false;break}slotStatusStr=_slotStatusStr}function setFrameType($frameTypeStr){switch($frameTypeStr){case nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_NORMAL:typeFrameStr=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_NORMAL;typeFrameClassStr="slot";break;case nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND:_$slotElement.addClass("elite_legend");typeFrameStr=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND;typeFrameClassStr="slot elite_legend";break;case nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_ELITE:_$slotElement.addClass("elite");typeFrameStr=nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_ELITE;typeFrameClassStr="slot elite";break}}function setSlotMouseInteraction(_flag){if(!nc.bns.training.Model.editable)return;_$slotElement.css("cursor","auto");_$slotElement.unbind("mouseover",slotMouseEventHandler);_$slotElement.unbind("mouseout",slotMouseEventHandler);_$slotElement.unbind("mousedown",slotMouseEventHandler);_$slotElement.unbind("click",slotMouseEventHandler);_$slotElement.unbind("contextmenu",slotMouseEventHandler);if(_flag){_$slotElement.css("cursor","pointer");_$slotElement.bind("mouseover",slotMouseEventHandler);_$slotElement.bind("mouseout",slotMouseEventHandler);_$slotElement.bind("mousedown",slotMouseEventHandler);_$slotElement.bind("click",slotMouseEventHandler);_$slotElement.bind("contextmenu",slotMouseEventHandler)}}function slotMouseEventHandler($evt){$evt.preventDefault();switch($evt.type){case"mouseover":if(!mouseInteractionDisplayIconClassStr)return;_$slotElement.addClass(mouseInteractionDisplayIconClassStr);break;case"mouseout":if(!mouseInteractionDisplayIconClassStr)return;_$slotElement.removeClass(mouseInteractionDisplayIconClassStr);break;case"mousedown":break;case"click":if(flag_completeStatus)return;if(nc.bns.training.Model.skillPointRemained<=0)return;currentVariationData=variationDataArr[currentVariationStatus];$(_this).trigger({type:nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM,variationData:currentVariationData});triggerSlotMouseOverEvent();break;case"contextmenu":if(currentVariationStatus<=0){return}var prevVaritaionDataStatusIndex=currentVariationStatus-1;if(prevVaritaionDataStatusIndex<=0)prevVaritaionDataStatusIndex=0;var prevVariationData=variationDataArr[prevVaritaionDataStatusIndex];$(_this).trigger({type:nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON,prevVariationData:prevVariationData});break}}return _this};nc.bns.training.tree.SkillSlotItem.STATUS_DEFAULT="STATUS_DEFAULT";nc.bns.training.tree.SkillSlotItem.STATUS_PLUS="STATUS_PLUS";nc.bns.training.tree.SkillSlotItem.STATUS_PLUS_STEP="STATUS_PLUS_STEP";nc.bns.training.tree.SkillSlotItem.STATUS_COMPLETE="STATUS_COMPLETE";nc.bns.training.tree.SkillSlotItem.STATUS_IMPOSSIBLE="STATUS_IMPOSSIBLE";nc.bns.training.tree.SkillSlotItem.STATUS_EXCLUSIVE="STATUS_EXCLUSIVE";nc.bns.training.tree.SkillSlotItem.CLICK_SKILL_SLOT_ITEM="CLICK_SKILL_SLOT_ITEM";nc.bns.training.tree.SkillSlotItem.CLICK_MOUSE_RIGHT_BUTTON="CLICK_MOUSE_RIGHT_BUTTON";nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_LEGEND="TYPE_FRAME_LEGEND";nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_ELITE="TYPE_FRAME_ELITE";nc.bns.training.tree.SkillSlotItem.TYPE_FRAME_NORMAL="TYPE_FRAME_NORMAL";nc.bns.training.tree.SkillSlotItem.MOUSEOVER_SKILL_SLOT_ITEM="MOUSEOVER_SKILL_SLOT_ITEM";nc.bns.training.tree.SkillSlotItem.MOUSEOUT_SKILL_SLOT_ITEM="MOUSEOUT_SKILL_SLOT_ITEM";nc.bns.training.category.Contents=function(_options){var _this=this;_this.destroy=function(){$(_container).empty();if(_searchInput){$(_searchInput).unbind(nc.bns.training.category.SearchInput.TRIGGER_INPUT_TEXT,searchInputEventHandler);_searchInput.destroy();_searchInput=null}if(_categoryContainer){$(_categoryContainer).unbind(nc.bns.training.category.CategoryContainer.SELECT_SKILL_LIST,categoryContainerEventHandler);_categoryContainer.destroy();_categoryContainer=null}if(_sortMenu){$(_sortMenu).unbind(nc.bns.training.category.SortMenu.CLICK_SORT_MENU,sortMenuEventHandler);_sortMenu.destroy();_sortMenu=null}};_this.reset=function(){rearrangeCustomCategoryObjArr();sortedListArr=getSortedListArr(sortOptionIndex);_categoryContainer.sortListBySortOptionIndex(sortedListArr,sortOptionIndex)};_this.getSearchInputSearchStr=function(){return searchSkillListStr};_this.displaySearchInputSearchStr=function($str){if(!_searchInput)return;_searchInput.setSearchStr($str)};_this.arrangeCategoryContainerBySearchStrByExternal=function($searchStr){searchSkillListStr=$searchStr;arrangeCategoryContainerBySearchStr($searchStr,sortOptionIndex)};_this.arrangeCategoryContainerByInputSearchStrByExternal=function($searchStr){searchSkillListStr=$searchStr;arrangeCategoryContainerByInputSearchStr(searchSkillListStr,sortOptionIndex)};_this.arrangeCategoryContainerByExistingSearchStr=function(){arrangeCategoryContainerByInputSearchStr(searchSkillListStr,sortOptionIndex)};_this.getFlagSortedListArrHasSkillListByExternal=function($skillId){return getFlagSortedListArrHasSkillList(sortedListArr,$skillId)};_this.setCategoryContainerPosY=function($categoryContainerTopPosition){if(_categoryContainer)_categoryContainer.setContainerPosYByExternal($categoryContainerTopPosition)};_this.getSkillIdOfFirstSkillList=function(){var sortedObjArr=getSortedListArr(sortOptionIndex);var firstArr=sortedObjArr[0];var firstObj=firstArr[0];return String(firstObj.skill_id)};_this.sortListBySortOptionIndexByExternal=function(){sortedListArr=getSortedListArr(sortOptionIndex);_categoryContainer.sortListBySortOptionIndex(sortedListArr,sortOptionIndex)};_this.setSkillListsStatusByExternal=function($externalSkillJsonObj){if(!$externalSkillJsonObj)return;var funcObj={};funcObj.setPrevTrainVariationObj=function($funcObj,$skillSlotData,$variationObj,$returnVariable){var flag_complete=false;var _prevTrainVariationObj=null;var prevTrainSkillAlias=$variationObj.prev_train["0"];if(prevTrainSkillAlias){_prevTrainVariationObj=nc.bns.training.util.SearchDataUtil.getVariationObjFromSkillSlotDataByAlias($skillSlotData,prevTrainSkillAlias);if(_prevTrainVariationObj.tree_id!=_prevTrainVariationObj.skill_id){flag_complete=false}else{flag_complete=true;$returnVariable=_prevTrainVariationObj}}else{_prevTrainVariationObj=$variationObj;if(_prevTrainVariationObj.tree_id!=_prevTrainVariationObj.skill_id){flag_complete=true;$returnVariable=null}else{flag_complete=true;$returnVariable=_prevTrainVariationObj}}if(!flag_complete)funcObj.setPrevTrainVariationObj($funcObj,$skillSlotData,_prevTrainVariationObj,$returnVariable)};function checkEtcSkillListProcess($skillId,$variationId){var etcSkillTreeId="";var etcSkillVariationObj;var skillIdObj,slotObj,variationObj,flag_exist=false;for(var id in nc.bns.training.Model.SLOT_OBJ_JSON){skillIdObj=nc.bns.training.Model.SLOT_OBJ_JSON[id];for(var slotNo in skillIdObj){slotObj=skillIdObj[slotNo];for(var variationNo in slotObj){variationObj=slotObj[variationNo];if(variationObj.skill_id==$skillId){if(variationObj.variation_id==$variationId){etcSkillTreeId=variationObj.tree_id;etcSkillVariationObj=variationObj;flag_exist=true}}if(flag_exist)break}if(flag_exist)break}if(flag_exist)break}if(etcSkillVariationObj){var _etcSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(etcSkillTreeId);var etcSkillTreeSlotData=nc.bns.training.Model.SLOT_OBJ_JSON[etcSkillTreeId];if(_etcSkillListObj){_etcSkillListObj.learnedSkillVariationId=etcSkillVariationObj.variation_id;_etcSkillListObj.learnedSkillAlias=etcSkillVariationObj.alias;_etcSkillListObj.learnedSkillTooltipAlias=etcSkillVariationObj.tooltip_alias;var prevTrainVariationObj=null;funcObj.setPrevTrainVariationObj(funcObj,etcSkillTreeSlotData,etcSkillVariationObj,prevTrainVariationObj);if(prevTrainVariationObj){if(_etcSkillListObj.name2_refine!=prevTrainVariationObj.name2_refine){_etcSkillListObj.name2_refine=prevTrainVariationObj.name2_refine;_etcSkillListObj.initJamostr=nc.bns.training.util.StringUtil.getInitialJamoStr(_treeSkillListObj.name2_refine.charAt(0))}}else{}_etcSkillListObj.consumedSkillPoint=nc.bns.training.util.SearchDataUtil.getConsumedSkillPointTotal(etcSkillTreeSlotData,variationId,etcSkillVariationObj.alias)}}}var skillObjArr=[];var acquisitionSkillVariationObjArr=[];var variationId,variationDataHasVariationId,skillObjHasLastLearnedVariationId,_skillListObj,_treeSkillListObj;for(var skillId in $externalSkillJsonObj){if(nc.bns.training.util.CheckUtil.available(nc.bns.training.Model.SLOT_OBJ_JSON[skillId])){variationId=$externalSkillJsonObj[skillId];variationDataHasVariationId=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationId(skillId,variationId);skillObjHasLastLearnedVariationId={};skillObjHasLastLearnedVariationId.skillId=String(skillId);skillObjHasLastLearnedVariationId.learnedSkillVariationId=String(variationId);skillObjHasLastLearnedVariationId.learnedSkillAlias=variationDataHasVariationId.alias;skillObjHasLastLearnedVariationId.learnedSkillTooltipAlias=variationDataHasVariationId.tooltip_alias;skillObjHasLastLearnedVariationId.name2_refine=variationDataHasVariationId.name2_refine;skillObjHasLastLearnedVariationId.consumedSkillPoint=nc.bns.training.util.SearchDataUtil.getConsumedSkillPoint(nc.bns.training.Model.SLOT_OBJ_JSON[skillId],variationId,variationDataHasVariationId.alias);skillObjArr.push(skillObjHasLastLearnedVariationId)}else{variationId=$externalSkillJsonObj[skillId];_skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(skillId);if(_skillListObj){switch(_skillListObj.skillType){case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:_treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(_skillListObj.tree_id);var treeSlotData=nc.bns.training.Model.SLOT_OBJ_JSON[String(_skillListObj.tree_id)];var slotObj,variationObj,flag_exist=false;for(var slotNo in treeSlotData){slotObj=treeSlotData[slotNo];for(var variationNo in slotObj){variationObj=slotObj[variationNo];if(variationObj.skill_id==_skillListObj.skill_id){if(variationObj.variation_id==variationId){flag_exist=true;break}}}if(flag_exist)break}if(flag_exist){acquisitionSkillVariationObjArr.push(variationObj);_treeSkillListObj.learnedSkillVariationId=variationObj.variation_id;_treeSkillListObj.learnedSkillAlias=variationObj.alias;_treeSkillListObj.learnedSkillTooltipAlias=variationObj.tooltip_alias;var prevTrainVariationObj=null;funcObj.setPrevTrainVariationObj(funcObj,treeSlotData,variationObj,prevTrainVariationObj);if(prevTrainVariationObj){if(_treeSkillListObj.name2_refine!=prevTrainVariationObj.name2_refine){_treeSkillListObj.name2_refine=prevTrainVariationObj.name2_refine;_treeSkillListObj.initJamostr=nc.bns.training.util.StringUtil.getInitialJamoStr(_treeSkillListObj.name2_refine.charAt(0))}}else{}_treeSkillListObj.consumedSkillPoint=nc.bns.training.util.SearchDataUtil.getConsumedSkillPointTotal(treeSlotData,variationId,variationObj.alias)}break;case nc.bns.training.Model.SKILL_TYPE_NONE:checkEtcSkillListProcess(skillId,variationId);break}}else{checkEtcSkillListProcess(skillId,variationId)}}}var skillListObjArr=[];var tmpSkillObj,skillListObj;for(var i=0,max=skillObjArr.length;i<max;i++){tmpSkillObj=skillObjArr[i];for(var j=0,length=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR.length;j<length;j++){skillListObj=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR[j];if(skillListObj.skill_id!=tmpSkillObj.skillId)continue;skillListObj.skill_id=tmpSkillObj.skillId;skillListObj.learnedSkillVariationId=tmpSkillObj.learnedSkillVariationId;skillListObj.learnedSkillAlias=tmpSkillObj.learnedSkillAlias;skillListObj.learnedSkillTooltipAlias=tmpSkillObj.learnedSkillTooltipAlias;skillListObj.name2_refine=tmpSkillObj.name2_refine;skillListObj.initJamoStr=nc.bns.training.util.StringUtil.getInitialJamoStr(tmpSkillObj.name2_refine.charAt(0));skillListObj.consumedSkillPoint=tmpSkillObj.consumedSkillPoint;skillListObjArr.push(skillListObj)}}if(!_categoryContainer)return;rearrangeCustomCategoryObjArr();sortedListArr=getSortedListArr(sortOptionIndex);_categoryContainer.sortListBySortOptionIndex(sortedListArr,sortOptionIndex);var shareSkillListArr=nc.bns.training.util.SearchDataUtil.getShareSkillListObjArrFromCustomGlobalModelArr();var treeSkillListObj,shareSkillListObj;for(var i=0,max=skillObjArr.length;i<max;i++){treeSkillListObj=skillObjArr[i];for(var j=0,length=shareSkillListArr.length;j<length;j++){shareSkillListObj=shareSkillListArr[j];if(shareSkillListObj.tree_id!=treeSkillListObj.skillId)continue;setTreeSkillListStatusToShareSkillList(treeSkillListObj.skillId,shareSkillListObj.skill_id)}}var acquisitionSkillObj,prevTrainSkillIdArr,trainSkillId,acquisitionSkillTreeId;for(var i=0,max=acquisitionSkillVariationObjArr.length;i<max;i++){acquisitionSkillObj=acquisitionSkillVariationObjArr[i];acquisitionSkillTreeId=acquisitionSkillObj.tree_id;prevTrainSkillIdArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedAllSkillId(nc.bns.training.Model.SLOT_OBJ_JSON[acquisitionSkillObj.tree_id],acquisitionSkillObj.alias);for(var j=0,length=prevTrainSkillIdArr.length;j<length;j++){trainSkillId=prevTrainSkillIdArr[j];if(trainSkillId!=acquisitionSkillTreeId){setTreeSkillListStatusToAcquisitionSkillList(acquisitionSkillTreeId,trainSkillId)}}}var skillListObj,variationObj,prevTrainSkillIdArr,trainSkillId;for(var i=0,max=skillListObjArr.length;i<max;i++){skillListObj=skillListObjArr[i];variationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias(skillListObj.skill_id,skillListObj.learnedSkillVariationId,skillListObj.learnedSkillAlias);prevTrainSkillIdArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedAllSkillId(nc.bns.training.Model.SLOT_OBJ_JSON[variationObj.tree_id],variationObj.alias);for(var j=0,length=prevTrainSkillIdArr.length;j<length;j++){trainSkillId=prevTrainSkillIdArr[j];if(trainSkillId!=skillListObj.tree_id){setTreeSkillListStatusToAcquisitionSkillList(skillListObj.tree_id,trainSkillId)}}}_categoryContainer.activateSkillListBySkillIdByExternal(nc.bns.training.Model.lastSelectedSkillListSkillId)};_this.setTreeSkillListStatusToShareSkillListByExternal=function($treeSkillId,$shareSkillId){setTreeSkillListStatusToShareSkillList($treeSkillId,$shareSkillId)};_this.setTreeSkillListStatusToAcquisitionSkillListByExternal=function($treeSkillId,$acquisitionSkillId){setTreeSkillListStatusToAcquisitionSkillList($treeSkillId,$acquisitionSkillId)};_this.consumePointToSkillListInCategoryContainer=function($skillId){var globalSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);if(!globalSkillListObj)return;globalSkillListObj.consumedSkillPoint++;_categoryContainer.setConsumePointToSkillList($skillId,globalSkillListObj.consumedSkillPoint)};_this.cancelPointToSkillListInCategoryContainer=function($skillId){var globalSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);if(!globalSkillListObj)return;globalSkillListObj.consumedSkillPoint--;if(globalSkillListObj.consumedSkillPoint<=0)globalSkillListObj.consumedSkillPoint=0;_categoryContainer.setConsumePointToSkillList($skillId,globalSkillListObj.consumedSkillPoint)};_this.activateCategoryFirstSkillListBySkillId=function($skillId){_categoryContainer.activateFirstSkillListBySkillIdByExternal($skillId)};_this.activateCategorySkillListBySkillIdAndCategoryTitle=function($skillId,$skillCategoryTitle){_categoryContainer.activateCategorySkillListBySkillIdAndCategoryTitleByExternal($skillId,$skillCategoryTitle)};_this.getFirstSkillListCategoryTitleInCategoryContainer=function($skillId){return _categoryContainer.getFirstSkillListCategoryTitle($skillId)};_this.replaceSkillListInCategoryContainer=function($skillId,$variationId,$variationAlias,$variationSkillName){replaceSkillList($skillId,$variationId,$variationAlias,$variationSkillName)};_this.getSkillListPosYInCategoryContainer=function($skillId){var containerPosY=_categoryContainer.getSkillListPosYByExternal($skillId);return containerPosY};function setTreeSkillListStatusToShareSkillList($treeSkillId,$shareSkillId){var treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($treeSkillId);var shareSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($shareSkillId);if(!treeSkillListObj||!shareSkillListObj)return;if(shareSkillListObj.skillType==nc.bns.training.Model.SKILL_TYPE_NONE)return;shareSkillListObj.consumedSkillPoint=treeSkillListObj.consumedSkillPoint;_categoryContainer.setConsumePointToSkillList(shareSkillListObj.skill_id,treeSkillListObj.consumedSkillPoint);_categoryContainer.setSkillListTypeStatus(shareSkillListObj.skill_id,"")}function setTreeSkillListStatusToAcquisitionSkillList($treeSkillId,$acquisitionSkillId){var treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($treeSkillId);var acquisitionSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($acquisitionSkillId);if(!treeSkillListObj||!acquisitionSkillListObj)return;if(acquisitionSkillListObj.skillType==nc.bns.training.Model.SKILL_TYPE_NONE)return;acquisitionSkillListObj.consumedSkillPoint=treeSkillListObj.consumedSkillPoint;_categoryContainer.setConsumePointToSkillList(acquisitionSkillListObj.skill_id,treeSkillListObj.consumedSkillPoint);_categoryContainer.setSkillListTypeStatus(acquisitionSkillListObj.skill_id,"")}function replaceSkillList($skillId,$variationId,$variationAlias,$skillName){var skillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr($skillId);var variationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationIdAndAlias($skillId,$variationId,$variationAlias);skillListObj.name2_refine=$skillName;skillListObj.initJamoStr=nc.bns.training.util.StringUtil.getInitialJamoStr($skillName.charAt(0));skillListObj.learnedSkillVariationId=variationObj.variation_id;skillListObj.learnedSkillTooltipAlias=variationObj.tooltip_alias;skillListObj.learnedSkillAlias=variationObj.alias;var imgURL="";if(skillListObj.skill_icon)imgURL=nc.bns.training.Model.SKILL_IMG_URL_FRONT+skillListObj.skill_icon[String($variationId)];rearrangeCustomCategoryObjArr();sortedListArr=getSortedListArr(sortOptionIndex);_categoryContainer.sortListBySortOptionIndex(sortedListArr,sortOptionIndex);_categoryContainer.setSkillListThumbnail($skillId,imgURL);_categoryContainer.activateSkillListBySkillIdByExternal($skillId)}var _container=_options.container;var objArr=_options.objArr;var sortOptionIndex=_options.sortOptionIndex;var sortedListArr=null;var searchSkillListStr="";var _searchInput=null;var _categoryContainer=null;var _sortMenu=null;var sortedObjArrByInput;var sortedListArrByInputKey;var sortedObjArrByLevel;var sortedListArrByLevel;var sortedListArrByStance;var sortedListArrByName;$(_container).empty();rearrangeCustomCategoryObjArr();sortedListArr=getSortedListArr(sortOptionIndex);var trSearchWrapElementStr='<div class="trSearchWrap">'+'<span class="placeholder">検索</span>'+'<input type="text" id="searchInputText" />'+'<span class="del"></span>'+'</div>';var bgtElementStr='<div class="bgt"></div>';var categoryBodyElementStr='<div class="categoryBody"><div class="scrollCategoryBody"></div></div>';var bgbElementStr='<div class="bgb"></div>';var menuWrapElementStr='<div class="menuWrap">';$(_container).append(trSearchWrapElementStr+bgtElementStr+categoryBodyElementStr+bgbElementStr+menuWrapElementStr);_searchInput=new nc.bns.training.category.SearchInput({container:$(".trSearchWrap",_container).get(0)});$(_searchInput).bind(nc.bns.training.category.SearchInput.TRIGGER_INPUT_TEXT,searchInputEventHandler);_categoryContainer=new nc.bns.training.category.CategoryContainer({containerWrap:$(".categoryBody",_container).get(0),container:$(".categoryBody .scrollCategoryBody",_container).get(0),skillObjArr:objArr,sortedListArr:sortedListArr,sortOptionIndex:sortOptionIndex});$(_categoryContainer).bind(nc.bns.training.category.CategoryContainer.SELECT_SKILL_LIST,categoryContainerEventHandler);_sortMenu=new nc.bns.training.category.SortMenu({container:$(".menuWrap",_container).get(0)});$(_sortMenu).bind(nc.bns.training.category.SortMenu.CLICK_SORT_MENU,sortMenuEventHandler);_sortMenu.activateMenu(sortOptionIndex);function rearrangeCustomCategoryObjArr(){objArr=nc.bns.training.Model.CUSTOM_CATEGORY_OBJ_ARR;sortedObjArrByInput=sortArrByObjInput(objArr);sortedListArrByInputKey=getSortedListArrsByObjInputKey(sortedObjArrByInput);sortedObjArrByLevel=sortArrByObjLevel(objArr);sortedListArrByLevel=getSortedListArrsByObjLevel(sortedObjArrByLevel);sortedListArrByStance=getSortedListArrsByObjStance(objArr,nc.bns.training.Model.job);sortedListArrByName=getSortedListArrsByObjName(objArr)}function searchInputEventHandler($evt){$evt.stopPropagation();switch($evt.type){case nc.bns.training.category.SearchInput.TRIGGER_INPUT_TEXT:searchSkillListStr=String($evt.text);arrangeCategoryContainerByInputSearchStr(searchSkillListStr,sortOptionIndex);break}}function arrangeCategoryContainerBySearchStr($str,$sortOptionIndex){sortedListArr=getSortedListArrBySearchStr($str,$sortOptionIndex);_categoryContainer.sortListBySearchStrByExternal(sortedListArr,$sortOptionIndex)}function arrangeCategoryContainerByInputSearchStr($str,$sortOptionIndex){arrangeCategoryContainerBySearchStr($str,$sortOptionIndex);var _firstSkillList=getFirstSkillList(sortedListArr);if(_firstSkillList){var skillCategoryTitle="";var flag_sortedListArrHasLastSelectedSkill=getFlagSortedListArrHasSkillList(sortedListArr,nc.bns.training.Model.lastSelectedSkillListSkillId);if(flag_sortedListArrHasLastSelectedSkill){if(nc.bns.training.Model.lastSelectedSkillCategoryTitle!=""){_categoryContainer.activateCategorySkillListBySkillIdAndCategoryTitleByExternal(nc.bns.training.Model.lastSelectedSkillListSkillId,nc.bns.training.Model.lastSelectedSkillCategoryTitle);skillCategoryTitle=nc.bns.training.Model.lastSelectedSkillCategoryTitle}else{_categoryContainer.activateFirstSkillListBySkillIdByExternal(nc.bns.training.Model.lastSelectedSkillListSkillId);skillCategoryTitle=_categoryContainer.getFirstSkillListCategoryTitle(nc.bns.training.Model.lastSelectedSkillListSkillId)}$(_this).trigger({type:nc.bns.training.category.Contents.TRIGGER_SELECT_SKILL_LIST,skillCategoryTitle:skillCategoryTitle,skillId:nc.bns.training.Model.lastSelectedSkillListSkillId});return}var firstSkillListSkillId=String(_firstSkillList.skill_id);_categoryContainer.activateFirstSkillListBySkillIdByExternal(firstSkillListSkillId);skillCategoryTitle=_categoryContainer.getFirstSkillListCategoryTitle(firstSkillListSkillId);$(_this).trigger({type:nc.bns.training.category.Contents.TRIGGER_SELECT_SKILL_LIST,skillCategoryTitle:skillCategoryTitle,skillId:firstSkillListSkillId})}else{$(_this).trigger({type:nc.bns.training.category.Contents.TRIGGER_SEARCH_NO_SKILL_LIST})}}function getFlagSortedListArrHasSkillList($sortedListArr,$skillId){var sortedSkillListArr=$sortedListArr;var tmpArr,_skillList;for(var i=0,max=sortedSkillListArr.length;i<max;i++){tmpArr=sortedSkillListArr[i];for(var j=0,length=tmpArr.length;j<length;j++){_skillList=tmpArr[j];if(!_skillList)continue;if(_skillList.skill_id==$skillId){return true}}}return false}function getFirstSkillList($sortedListArr){var sortedSkillListArr=$sortedListArr;var tmpArr,_firstSkillList;for(var i=0,max=sortedSkillListArr.length;i<max;i++){tmpArr=sortedSkillListArr[i];if(tmpArr.length>0){_firstSkillList=tmpArr[0];return _firstSkillList;break}}return null}function getCopySortedListArr($arr){var copyArr=[];var _tmpArr,tmpCopyArr;for(var i=0,max=$arr.length;i<max;i++){_tmpArr=$arr[i];tmpCopyArr=[];for(var j in _tmpArr){if(isNaN(parseInt(j))){tmpCopyArr[String(j)]=_tmpArr[j]}else{tmpCopyArr.push(_tmpArr[j])}}copyArr.push(tmpCopyArr)}return copyArr}function getSortedListArrBySearchStr($str,$sortOptionIndex){var arr=null;switch($sortOptionIndex){case 1:arr=sortedListArrByInputKey;break;case 2:arr=sortedListArrByLevel;break;case 3:arr=sortedListArrByStance;break;case 4:arr=sortedListArrByName;break}var copyListArr=getCopySortedListArr(arr);var _tmpArr,_tmpObj,tmpName;for(var i=copyListArr.length-1;i>=0;i--){_tmpArr=copyListArr[i];for(var j=_tmpArr.length-1;j>=0;j--){_tmpObj=_tmpArr[j];tmpName=_tmpObj["name2_refine"];if(tmpName.indexOf($str)<0){_tmpArr.splice(j,1)}}}return copyListArr}function categoryContainerEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case nc.bns.training.category.CategoryContainer.SELECT_SKILL_LIST:var skillCategoryTitle=$evt.skillCategoryTitle;var skillId=$evt.skillId;$(_this).trigger({type:nc.bns.training.category.Contents.TRIGGER_SELECT_SKILL_LIST,skillCategoryTitle:skillCategoryTitle,skillId:skillId});break}}function sortMenuEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case nc.bns.training.category.SortMenu.CLICK_SORT_MENU:var targetIndex=parseInt($evt.index);if(sortOptionIndex==targetIndex)return;_sortMenu.activateMenu(targetIndex);sortOptionIndex=targetIndex;sortedListArr=getSortedListArrBySearchStr(searchSkillListStr,sortOptionIndex);_categoryContainer.sortListBySearchStrByExternal(sortedListArr,sortOptionIndex);$(_this).trigger({type:nc.bns.training.category.Contents.TRIGGER_SELECT_SORT_MENU,sortOptionIndex:sortOptionIndex});break}}function getSortedListArr($sortOptionIndex){var arr=null;switch($sortOptionIndex){case 1:arr=sortedListArrByInputKey;break;case 2:arr=sortedListArrByLevel;break;case 3:arr=sortedListArrByStance;break;case 4:arr=sortedListArrByName;break}return arr}function sortArrByObjInput($objArr){var objArr=$objArr;objArr.sort(function numberOrder(a,b){return parseInt(b["sort_no"])-parseInt(a["sort_no"])});objArr.sort(function numberOrder(a,b){return parseInt(a["skill_id"])-parseInt(b["skill_id"])});return objArr}function getSortedListArrsByObjInputKey($objArr){var arrHasInputArrays=[];var _tmpArr;for(var i=0,max=nc.bns.training.Model.SORT_INPUT_ARR.length;i<max;i++){_tmpArr=[];_tmpArr["default_keycap"]=nc.bns.training.Model.SORT_INPUT_ARR[i];arrHasInputArrays.push(_tmpArr)}var _tmpObj,objArr=$objArr,_tmpKeyCapStr,tmpKeyCapStrArr,keyTrimStr;for(var i=0,max=objArr.length;i<max;i++){_tmpObj=objArr[i];for(var j=0,arrLength=arrHasInputArrays.length;j<arrLength;j++){_tmpArr=arrHasInputArrays[j];_tmpKeyCapStr=_tmpObj["default_keycap"];tmpKeyCapStrArr=_tmpKeyCapStr.split(",");for(var k=0,keyCapStrArrLength=tmpKeyCapStrArr.length;k<keyCapStrArrLength;k++){keyTrimStr=nc.bns.training.util.StringUtil.trim(tmpKeyCapStrArr[k]);if(keyTrimStr==_tmpArr["default_keycap"]){_tmpObj.default_keycap=keyTrimStr;_tmpArr.push(_tmpObj);break}}}}return arrHasInputArrays}function sortArrByObjLevel($objArr){var objArr=$objArr;objArr.sort(function numberOrder(a,b){return parseInt(a["pc_level"])-parseInt(b["pc_level"])});objArr.sort(function numberOrder(a,b){return parseInt(a["skill_id"])-parseInt(b["skill_id"])});return objArr}function getSortedListArrsByObjLevel($objArr){var arrHasLevelArrays=[];var _tmpArr;for(var i=0,max=nc.bns.training.Model.SORT_LEVEL_ARR.length;i<max;i++){_tmpArr=[];_tmpArr["pc_level"]=nc.bns.training.Model.SORT_LEVEL_ARR[i];arrHasLevelArrays.push(_tmpArr)}var _tmpObj,objArr=$objArr;for(var i=0,max=objArr.length;i<max;i++){_tmpObj=objArr[i];for(var j=0,arrLength=arrHasLevelArrays.length;j<arrLength;j++){_tmpArr=arrHasLevelArrays[j];if(parseInt(_tmpObj["pc_level"])<=parseInt(_tmpArr["pc_level"])){_tmpArr.push(_tmpObj);break}}}return arrHasLevelArrays}function sortArrByObjStance($objArr){}function getSortedListArrsByObjStance($objArr,$jobStr){var arrHasStanceArrays=[];var stanceStrArr=nc.bns.training.Model.SORT_POSE_OBJ[$jobStr];var _tmpArr;for(var i=0,max=stanceStrArr.length;i<max;i++){_tmpArr=[];_tmpArr["stance"]=stanceStrArr[i];arrHasStanceArrays.push(_tmpArr)}var _tmpObj,tmpStanceTypeArr,objArr=$objArr;for(var i=0,max=objArr.length;i<max;i++){_tmpObj=objArr[i];for(var j=0,arrLength=arrHasStanceArrays.length;j<arrLength;j++){_tmpArr=arrHasStanceArrays[j];tmpStanceTypeArr=nc.bns.training.util.ObjectUtil.getElementArr(_tmpObj["tooltip_stance_type"]);if(0<=nc.bns.training.util.ArrayUtil.indexOf(tmpStanceTypeArr,_tmpArr["stance"])){_tmpArr.push(_tmpObj)}}}return arrHasStanceArrays}function getSortedListArrsByObjName($objArr){var objArr=$objArr;var nameArr=[];var _tmpObj;for(var i=0,max=objArr.length;i<max;i++){_tmpObj=objArr[i];nameArr.push(_tmpObj["name2_refine"])}nameArr.sort();var sortedObjArr=[];var nameStr;for(var i=nameArr.length-1;i>=0;i--){nameStr=nameArr[i];for(var j=objArr.length-1;j>=0;j--){_tmpObj=objArr[j];if(nameStr==_tmpObj["name2_refine"]){sortedObjArr.unshift(_tmpObj)}}}var arrHasNameArrays=[];var _tmpArr;for(var i=0,max=nc.bns.training.Model.SORT_NAME_ARR.length;i<max;i++){_tmpArr=[];_tmpArr["initJamoStr"]=nc.bns.training.Model.SORT_NAME_ARR[i];arrHasNameArrays.push(_tmpArr)}var _tmpObj,_tmpArr;for(var i=0,max=sortedObjArr.length;i<max;i++){_tmpObj=sortedObjArr[i];for(var j=0,length=arrHasNameArrays.length;j<length;j++){_tmpArr=arrHasNameArrays[j];if(_tmpArr["initJamoStr"]==_tmpObj["initJamoStr"]){_tmpArr.push(_tmpObj);break}}}return arrHasNameArrays}return _this};nc.bns.training.category.Contents.TRIGGER_SELECT_SKILL_LIST="TRIGGER_SELECT_SKILL_LIST";nc.bns.training.category.Contents.TRIGGER_SELECT_SORT_MENU="TRIGGER_SELECT_SORT_MENU";nc.bns.training.category.Contents.TRIGGER_SEARCH_NO_SKILL_LIST="TRIGGER_SEARCH_NO_SKILL_LIST";nc.bns.training.category.SortMenu=function(_options){var _this=this;_this.destroy=function(){if(btnArr){var _tmpSortBtn;for(var i=0,max=btnArr.length;i<max;i++){_tmpSortBtn=btnArr[i];$(_tmpSortBtn).unbind("click",sortBtnMouseEventHandler)}btnArr=null}};_this.getContainer=function(){return _container};_this.activateMenu=function(_index){activateBtnList(_index)};var _container=_options.container;var sortingCmdKeyElementStr='<span class="sorting_cmdkey">発動順序</span>';var sortingLevelElementStr='<span class="sorting_level">レベル順</span>';var sortingStanceElementStr='<span class="sorting_stance">体勢順</span>';var sortingNameElementStr='<span class="sorting_name">名前</span>';$(_container).append(sortingCmdKeyElementStr+sortingLevelElementStr+sortingStanceElementStr+sortingNameElementStr);var btnArr=$("span",_container);var _tmpSortBtn;for(var i=0,max=btnArr.length;i<max;i++){_tmpSortBtn=btnArr[i];_tmpSortBtn.index=i+1;$(_tmpSortBtn).bind("click",sortBtnMouseEventHandler)}function sortBtnMouseEventHandler($evt){$evt.preventDefault();switch($evt.type){case"click":var _targetBtn=$evt.currentTarget;$(_this).trigger({type:nc.bns.training.category.SortMenu.CLICK_SORT_MENU,index:_targetBtn.index});break}}function activateBtnList(_index){var _btn;for(var i=0,max=btnArr.length;i<max;i++){_btn=btnArr[i];if(_btn.index!=_index){$(_btn).removeClass("selected")}else{$(_btn).addClass("selected")}}}return _this};nc.bns.training.category.SortMenu.CLICK_SORT_MENU="CLICK_SORT_MENU";nc.bns.training.category.SearchInput=function(_options){var _this=this;_this.destroy=function(){removeInputCheckTimer();if(_$input){_$input.blur();_$input.unbind("keydown",inputKeyHandler);_$input.unbind("keyup",inputKeyHandler);_$input=null}if(_deleteInputStrBtn){$(_deleteInputStrBtn).unbind("click",deleteInputStrBtnMouseEventHandler);_deleteInputStrBtn=null}};_this.setSearchStr=function($str){displayPlaceHolder(false);displayDeleteInputStrBtn(true);if(_$input)_$input.val($str)};var GAP_CHECK_INPUT_KEYUP_EVENT_ERROR=250;var _container=_options.container;var _$input;var _displayPlaceHolder;var _deleteInputStrBtn;var _inputCheckTimer;var checkInputStr="";init();function init(){_$input=$("#searchInputText",_container);_displayPlaceHolder=$(".placeholder",_container).get(0);_deleteInputStrBtn=$(".del",_container).get(0);_$input.focus(function(){displayPlaceHolder(false);displayDeleteInputStrBtn(true);startCheckInputByTimer()});_$input.blur(function(){removeInputCheckTimer();if(getFlagInputHasText()){}else{displayPlaceHolder(true);displayDeleteInputStrBtn(false)}});_$input.bind("keydown",inputKeyHandler);_$input.bind("keyup",inputKeyHandler);$(_deleteInputStrBtn).bind("click",deleteInputStrBtnMouseEventHandler);displayDeleteInputStrBtn(false)}function deleteInputStrBtnMouseEventHandler($evt){switch($evt.type){case"click":removeInputCheckTimer();_$input.val("");displayPlaceHolder(true);displayDeleteInputStrBtn(false);$(_this).trigger({type:nc.bns.training.category.SearchInput.TRIGGER_INPUT_TEXT,text:_$input.val()});break}}function displayDeleteInputStrBtn($flag){if($flag){_deleteInputStrBtn.style.display="inline"}else{_deleteInputStrBtn.style.display="none"}}function inputKeyHandler($evt){switch($evt.type){case"keydown":protectEnterKeyInput($evt);break;case"keyup":protectEnterKeyInput($evt);break}}function protectEnterKeyInput($evt){if(!$evt)return;if($evt.keyCode=="13"){$evt.preventDefault();$evt.stopPropagation()}}function startCheckInputByTimer(){removeInputCheckTimer();_inputCheckTimer=new nc.bns.training.util.ControlUtil.SimpleTimer(GAP_CHECK_INPUT_KEYUP_EVENT_ERROR,_this,checkInputStrByTimer);_inputCheckTimer.start()}function getFlagInputHasText(){if(_$input.val()=="")return false;return true}function displayPlaceHolder($flag){if($flag){_displayPlaceHolder.style.display="inline"}else{_displayPlaceHolder.style.display="none"}}function checkInputStrByTimer(){if(checkInputStr!=_$input.val()){checkInputStr=_$input.val();$(_this).trigger({type:nc.bns.training.category.SearchInput.TRIGGER_INPUT_TEXT,text:_$input.val()})}}function removeInputCheckTimer(){if(_inputCheckTimer){_inputCheckTimer.destroy();_inputCheckTimer=null}}return _this};nc.bns.training.category.SearchInput.TRIGGER_INPUT_TEXT="TRIGGER_INPUT_TEXT";nc.bns.training.category.CategoryContainer=function(_options){var _this=this;_this.destroy=function(){if(categorySkillListArr){var _tmpCategorySkillList;for(var i=0,max=categorySkillListArr.length;i<max;i++){_tmpCategorySkillList=categorySkillListArr[i];$(_tmpCategorySkillList).unbind(nc.bns.training.category.CategorySkillList.CLICK_CATEGORY_SKILL_LIST,categorySkillListEventHandler);_tmpCategorySkillList.destroy()}categorySkillListArr=[]}};_this.activateSkillListBySkillIdByExternal=function($skillId){activateSkillListBySkillId($skillId)};_this.activateFirstSkillListBySkillIdByExternal=function($skillId){activateFirstSkillListBySkillId($skillId)};_this.activateCategorySkillListBySkillIdAndCategoryTitleByExternal=function($skillId,$skillCategoryTitle){activateSkillListBySkillIdAndCategoryTitle($skillId,$skillCategoryTitle)};_this.getFirstSkillListCategoryTitle=function($skillId){return getFirstSkillListCategoryTitle($skillId)};function getFirstSkillListCategoryTitle($skillId){var _tmpCategorySkillList;for(var i=0,max=categorySkillListArr.length;i<max;i++){_tmpCategorySkillList=categorySkillListArr[i];if(_tmpCategorySkillList.getSkillId()==$skillId){return _tmpCategorySkillList.getCategoryTitle()}}return""}function activateFirstSkillListBySkillId($skillId){var skillListArr=[];var _tmpCategorySkillList;for(var i=0,max=categorySkillListArr.length;i<max;i++){_tmpCategorySkillList=categorySkillListArr[i];_tmpCategorySkillList.deactivate();if(_tmpCategorySkillList.getSkillId()==$skillId){skillListArr.push(_tmpCategorySkillList)}}if(skillListArr.length>0){var _firstSkillList=skillListArr[0];_firstSkillList.activate()}}function activateSkillListBySkillIdAndCategoryTitle($skillId,$skillCategoryTitle){var _tmpCategorySkillList;for(var i=0,max=categorySkillListArr.length;i<max;i++){_tmpCategorySkillList=categorySkillListArr[i];_tmpCategorySkillList.deactivate();if(_tmpCategorySkillList.getSkillId()==$skillId){if(_tmpCategorySkillList.getCategoryTitle()==$skillCategoryTitle){_tmpCategorySkillList.activate()}}}}_this.getSkillListPosYByExternal=function($skillId){var skillListOffsetYInContainer=0;var skillList,flag_exist=false;for(var i=0,max=categorySkillListArr.length;i<max;i++){skillList=categorySkillListArr[i];if(skillList.getSkillId()==$skillId){flag_exist=true;break}}if(flag_exist){var skillListElement=skillList.getContainer();var dlListArr=$("> dl",_container);var _dlElement,flag_contain=false;for(var i=0,max=dlListArr.length;i<max;i++){_dlElement=dlListArr[i];if($(_dlElement).has(skillListElement)){flag_contain=true;break}}if(flag_contain){var dlElementPosY=$(_dlElement).position().top;skillListOffsetYInContainer=dlElementPosY+$(skillListElement).position().top}}return skillListOffsetYInContainer};_this.sortListBySearchStrByExternal=function($sortedListArr,$sortOptionIndex){$(_container).empty();sortedListArr=$sortedListArr;sortOptionIndex=$sortOptionIndex;setContents();setContainerPosY(0);setMouseWheelScroll()};_this.sortListBySortOptionIndex=function($sortedListArr,$sortOptionIndex){$(_container).empty();sortedListArr=$sortedListArr;sortOptionIndex=$sortOptionIndex;setContents();setContainerPosY(0);setMouseWheelScroll()};_this.setSkillListThumbnail=function($skillId,$imgURL){setSkillListsThumbnail($skillId,$imgURL)};_this.setConsumePointToSkillList=function($skillId,$consumedSkillPoint){setConsumedPointToSkillLists($skillId,$consumedSkillPoint)};_this.setSkillListTypeStatus=function($skillId,$skillTypeStr){setSkillListsTypeStatus($skillId,$skillTypeStr)};_this.setContainerPosYByExternal=function($topPosition){var containerWrapHeight=parseInt($(_containerWrap).height());var containerHeight=parseInt($(_container).height());var containerScrollLimitPosY=containerWrapHeight-containerHeight;if($topPosition<containerScrollLimitPosY)$topPosition=containerScrollLimitPosY;if(containerScrollLimitPosY>0)$topPosition=0;setContainerPosY($topPosition)};var _containerWrap=_options.containerWrap;var _container=_options.container;var skillObjArr=_options.skillObjArr;var sortedListArr=_options.sortedListArr;var sortOptionIndex=_options.sortOptionIndex;var categoryTypeStr="";var categorySkillListArr=[];init();function init(){if(_container)_container.style.position="relative";setContents();setContainerPosY(0);setMouseWheelScroll()}function setContents(){function getLastTrainedSkillIconImgURL($skillListObj,$variationId){var url=$skillListObj.skill_icon[$variationId];if(url){return url}else{url="";var treeId=$skillListObj.tree_id;var lastLearnedSkillVariationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationId(treeId,$variationId);var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],lastLearnedSkillVariationObj.alias);var _variationObj,_skillList;for(var i=0,max=prevTrainSkillVariationObjArr.length;i<max;i++){_variationObj=prevTrainSkillVariationObjArr[i];_skillList=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(_variationObj.skill_id);if(!_skillList)continue;switch(_skillList.skillType){case"":if($skillListObj.skill_icon[_variationObj.variation_id]){url=$skillListObj.skill_icon[_variationObj.variation_id]}else{url=($skillListObj.skill_icon["1"])?$skillListObj.skill_icon["1"]:""}return url;break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:break}}}return url}function getLastTrainedSkillName2Refine($skillListObj,$variationId){var name2Refine="";var treeId=$skillListObj.tree_id;var lastLearnedSkillVariationObj=nc.bns.training.util.SearchDataUtil.getVariationObjHasVariationId(treeId,$variationId);var prevTrainSkillVariationObjArr=nc.bns.training.util.SearchDataUtil.getPrevTrainedSkillVariationObjs(nc.bns.training.Model.SLOT_OBJ_JSON[treeId],lastLearnedSkillVariationObj.alias);var _variationObj,_skillList;for(var i=0,max=prevTrainSkillVariationObjArr.length;i<max;i++){_variationObj=prevTrainSkillVariationObjArr[i];_skillList=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(_variationObj.skill_id);if(!_skillList)continue;switch(_skillList.skillType){case"":name2Refine=_variationObj.name2_refine;return name2Refine;break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:break}}if(name2Refine==""){var treeSkillListObj=nc.bns.training.util.SearchDataUtil.getSkillListObjFromCustomGlobalModelArr(treeId);if(treeSkillListObj)name2Refine=treeSkillListObj.initName2Refine}return name2Refine}categoryTypeStr=getCategroyTypeStr(sortOptionIndex);var objHasConsumedSkillArr=[];var tmpCategoryTitleStr,tmpKeyCapStr;var tmpCategoryElementStr,_tmpObjArr,_tmpDlElement,_tmpUlElement,_tmpLiElement,_tmpObj,tmpLiInnerStr,tmpImgURL,tmpSkillSlotObj;for(var i=0,max=sortedListArr.length;i<max;i++){_tmpObjArr=sortedListArr[i];if(_tmpObjArr){if(_tmpObjArr.length>0){_tmpDlElement=document.createElement('dl');$(_tmpDlElement).addClass="category_type";$(_container).append(_tmpDlElement);switch(categoryTypeStr){case"default_keycap":tmpCategoryTitleStr=nc.bns.training.Model.SORT_INPUT_OBJ[_tmpObjArr[categoryTypeStr]].category;break;case"pc_level":tmpCategoryTitleStr=_tmpObjArr[categoryTypeStr];break;case"stance":tmpCategoryTitleStr=_tmpObjArr[categoryTypeStr];break;case"initJamoStr":tmpCategoryTitleStr=_tmpObjArr[categoryTypeStr];break}tmpCategoryElementStr='<dt><strong>'+tmpCategoryTitleStr+'</strong></dt>'+'<dd><ul></ul></dd>';$(_tmpDlElement).append(tmpCategoryElementStr);for(var j=0,objArrLength=_tmpObjArr.length;j<objArrLength;j++){_tmpObj=_tmpObjArr[j];_tmpUlElement=$("ul",_tmpDlElement).get(0);_tmpLiElement=document.createElement('li');_tmpLiElement.data=_tmpObj;_tmpLiElement.skill_id=_tmpObj.skill_id;_tmpLiElement.categoryTitle=tmpCategoryTitleStr;$(_tmpUlElement).append(_tmpLiElement);tmpImgURL="";if(_tmpObj.skill_icon){var imgURL="";if(_tmpObj.learnedSkillVariationId!=""){var lastTrainedSkillIconImgURL=getLastTrainedSkillIconImgURL(_tmpObj,_tmpObj.learnedSkillVariationId);imgURL=lastTrainedSkillIconImgURL}else{imgURL=(_tmpObj.skill_icon["1"])?_tmpObj.skill_icon["1"]:""}tmpImgURL=nc.bns.training.Model.SKILL_IMG_URL_FRONT+imgURL}if(_tmpObj.learnedSkillVariationId!=""){_tmpObj.name2_refine=getLastTrainedSkillName2Refine(_tmpObj,_tmpObj.learnedSkillVariationId)}tmpKeyCapStr=nc.bns.training.Model.SORT_INPUT_OBJ[_tmpObj.default_keycap].value;tmpLiInnerStr='<span class="thumb"><img src="'+tmpImgURL+'"></span>'+'<em class="name">'+_tmpObj.name2_refine+'</em>'+'<span class="cmdkey">'+tmpKeyCapStr+'</span>'+'<span class="frame"></span>'+'<span class="point"></span>';$(_tmpLiElement).append(tmpLiInnerStr);if(tmpKeyCapStr!="")$(".cmdkey",_tmpLiElement).addClass("key_"+tmpKeyCapStr);if(nc.bns.training.Model.level<_tmpObj["pc_level"]){$(_tmpLiElement).addClass("lock")}else{switch(_tmpObj.skillType){case"":break;case nc.bns.training.Model.SKILL_TYPE_NONE:$("em.name",_tmpLiElement).addClass("single");break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:$(_tmpLiElement).addClass("disable");break;case nc.bns.training.Model.SKILL_TYPE_SHARE:break}}if(parseInt(_tmpObj.consumedSkillPoint)>0){objHasConsumedSkillArr.push(_tmpObj)}}}}}var liElementArr=$("li",_container);categorySkillListArr=[];var _tmpCategorySkillList;for(var i=0,max=liElementArr.length;i<max;i++){_tmpCategorySkillList=new nc.bns.training.category.CategorySkillList({container:liElementArr[i],data:liElementArr[i].data,categoryTitle:liElementArr[i].categoryTitle});$(_tmpCategorySkillList).bind(nc.bns.training.category.CategorySkillList.CLICK_CATEGORY_SKILL_LIST,categorySkillListEventHandler);categorySkillListArr.push(_tmpCategorySkillList)}var _tmpObj,_tmpSkillList;for(var i=0,max=objHasConsumedSkillArr.length;i<max;i++){_tmpObj=objHasConsumedSkillArr[i];for(var j=0,length=categorySkillListArr.length;j<length;j++){_tmpSkillList=categorySkillListArr[j];if(_tmpSkillList.getSkillId()==_tmpObj.skill_id){_tmpSkillList.setDisplayConsumedSkillPoint(parseInt(_tmpObj.consumedSkillPoint));switch(_tmpObj.skillType){case"":break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:if(_tmpObj.consumedSkillPoint>0){_tmpSkillList.setTypeStatus("")}else{_tmpSkillList.setTypeStatus(nc.bns.training.Model.SKILL_TYPE_ACQUISITION)}break;case nc.bns.training.Model.SKILL_TYPE_SHARE:break}}}}}function setSkillListsTypeStatus($skillId,$skillTypeStr){var skillListArr=getSkillListsBySkillId($skillId);if(skillListArr.length<=0)return;var _skillList;for(var i=0,max=skillListArr.length;i<max;i++){_skillList=skillListArr[i];_skillList.setTypeStatus($skillTypeStr)}}function categorySkillListEventHandler($evt){$evt.preventDefault();$evt.stopPropagation();switch($evt.type){case nc.bns.training.category.CategorySkillList.CLICK_CATEGORY_SKILL_LIST:activateSkillList($evt.target);var skillId=$evt.skillId;var skillCategoryTitle=$evt.categoryTitle;$(_this).trigger({type:nc.bns.training.category.CategoryContainer.SELECT_SKILL_LIST,skillCategoryTitle:skillCategoryTitle,skillId:skillId});break}}function activateSkillListBySkillId($skillId){var _tmpCategorySkillList;for(var i=0,max=categorySkillListArr.length;i<max;i++){_tmpCategorySkillList=categorySkillListArr[i];if(_tmpCategorySkillList.getSkillId()!=$skillId){_tmpCategorySkillList.deactivate()}else{_tmpCategorySkillList.activate()}}}function activateSkillList(_categorySkillListLi){var _tmpCategorySkillList;for(var i=0,max=categorySkillListArr.length;i<max;i++){_tmpCategorySkillList=categorySkillListArr[i];if(_tmpCategorySkillList.getContainer()!=_categorySkillListLi){_tmpCategorySkillList.deactivate()}else{_tmpCategorySkillList.activate()}}}function setMouseWheelScroll(){$(_container).unbind("mousewheel DOMMouseScroll",contentsMouseEventHandler);$(_container).bind("mousewheel DOMMouseScroll",contentsMouseEventHandler)}function contentsMouseEventHandler($evt){$evt.preventDefault();switch($evt.type){case"mousewheel":case"DOMMouseScroll":var delta=-$evt.originalEvent.wheelDelta||$evt.originalEvent.detail;var movePosYPerMouseWheel=(delta>0)?nc.bns.training.Model.CATEGORY_MOVE_POSY_PER_MOUSE_WHEEL:-nc.bns.training.Model.CATEGORY_MOVE_POSY_PER_MOUSE_WHEEL;var scrollEnableDistance=$(_container).height()-$(_containerWrap).height();var targetPosY=parseInt($(_container).css("top"))-movePosYPerMouseWheel;if(targetPosY<-scrollEnableDistance)targetPosY=-scrollEnableDistance;if(targetPosY>0)targetPosY=0;$(_container).css("top",targetPosY);nc.bns.training.Model.wheelScrollCategoryContainerPosY=targetPosY;break}}function setContainerPosY($topPosition){$(_container).css("top",$topPosition)}function getCategroyTypeStr($sortOptionIndex){var str="";switch($sortOptionIndex){case 1:str="default_keycap";break;case 2:str="pc_level";break;case 3:str="stance";break;case 4:str="initJamoStr";break}return str}function setConsumedPointToSkillLists($skillId,$consumedSkillPoint){var skillListArr=getSkillListsBySkillId($skillId);if(skillListArr.length<=0)return;var _skillList;for(var i=0,max=skillListArr.length;i<max;i++){_skillList=skillListArr[i];_skillList.setDisplayConsumedSkillPoint($consumedSkillPoint)}}function setSkillListsThumbnail($skillId,$thumbnailURL){var skillListArr=getSkillListsBySkillId($skillId);if(skillListArr.length<=0)return;var _skillList;for(var i=0,max=skillListArr.length;i<max;i++){_skillList=skillListArr[i];_skillList.setThumbnail($thumbnailURL)}}function getSkillListsBySkillId($skillId){var skillListArr=[];var _skillList=null;for(var i=0,max=categorySkillListArr.length;i<max;i++){_skillList=categorySkillListArr[i];if($skillId==_skillList.getSkillId()){skillListArr.push(_skillList)}}return skillListArr}return _this};nc.bns.training.category.CategoryContainer.SELECT_SKILL_LIST="SELECT_SKILL_LIST";nc.bns.training.category.CategorySkillList=function(_options){var _this=this;_this.destroy=function(){if(_container){$(_container).unbind("click",containerMouseEventHandler);_container=null}};_this.getContainer=function(){return _container};_this.activate=function(){$(_container).addClass("selected")};_this.deactivate=function(){$(_container).removeClass("selected")};_this.getConsumedSkillPoint=function(){return consumedSkillPoint};_this.getSkillId=function(){return skillId};_this.getCategoryTitle=function(){return categoryTitle};_this.setTypeStatus=function($skillTypeStr){var flag_lock=false;if($(_container).hasClass("lock"))flag_lock=true;if(flag_lock)return;$(_container).removeClass();switch($skillTypeStr){case"":break;case nc.bns.training.Model.SKILL_TYPE_ACQUISITION:$(_container).addClass("disable");break;case nc.bns.training.Model.SKILL_TYPE_SHARE:break}};_this.setDisplayConsumedSkillPoint=function($consumedSkillPoint){if($consumedSkillPoint<=0){_$consoumedPointDisplayElement.removeClass("point_able")}else{_$consoumedPointDisplayElement.addClass("point_able");_$consoumedPointDisplayElement.text(String($consumedSkillPoint))}consumedSkillPoint=$consumedSkillPoint};_this.setThumbnail=function($thumbnailPath){var str=($thumbnailPath)?$thumbnailPath:"";var _imgElement=$(".thumb > img",_container).get(0);_imgElement.src=str};var _container=_options.container;var _$consoumedPointDisplayElement;var dataObj=_options.data;var skillId=dataObj.skill_id;var categoryTitle=_options.categoryTitle;var consumedSkillPoint=0;init();function init(){_$consoumedPointDisplayElement=$(".point",_container);$(_container).bind("click",containerMouseEventHandler)}function containerMouseEventHandler($evt){$evt.preventDefault();switch($evt.type){case"click":$(_this).trigger({type:nc.bns.training.category.CategorySkillList.CLICK_CATEGORY_SKILL_LIST,target:_container,skillId:skillId,categoryTitle:categoryTitle});break}}return _this};nc.bns.training.category.CategorySkillList.CLICK_CATEGORY_SKILL_LIST="CLICK_CATEGORY_SKILL_LIST"})(jQuery);